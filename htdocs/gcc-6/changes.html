<html>

<head>
<title>GCC 6 Release Series &mdash; Changes, New Features, and Fixes</title>

<style type="text/css">
  .boldred { font-weight:bold; color:red; }
</style>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 6 Release Series<br />Changes, New Features, and Fixes</h1>

<!-- .................................................................. -->
<h2>Caveats</h2>
  <ul>
    <li>The default mode for C++ is now <code>-std=gnu++14</code> instead of
        <code>-std=gnu++98</code>.</li>

    <li><p>Support for a number of older systems and recently
    unmaintained or untested target ports of GCC has been declared
    obsolete in GCC 6.  Unless there is activity to revive them, the
    next release of GCC will have their sources permanently
    <strong>removed</strong>.</p>

    <p>The following ports for individual systems on
    particular architectures have been obsoleted:</p>

    <ul>
	  <li>SH5 / SH64 (sh64-*-*) as announced
	  <a href="https://gcc.gnu.org/ml/gcc/2015-08/msg00101.html">
	      here</a>.</li>
    </ul>
    </li>

  </ul>

<!-- .................................................................. -->
<h2 id="general">General Optimizer Improvements</h2>
  <ul>
    <li>UndefinedBehaviorSanitizer gained a new sanitization option,
	<code>-fsanitize=bounds-strict</code>, which enables strict checking
	of array bounds.  In particular, it enables
	<code>-fsanitize=bounds</code> as well as instrumentation of
	flexible array member-like arrays.</li>
  </ul>

<!-- .................................................................. -->
<h2 id="languages">New Languages and Language specific improvements</h2>

<!-- <h3 id="ada">Ada</h3> -->

<h3 id="c-family">C family</h3>
  <ul>
    <li>Version 4.5 of the <a href="http://openmp.org/wp/openmp-specifications/"
	>OpenMP specification</a> is now supported in the C and C++ compilers.</li>

    <li>The C and C++ compilers now support attributes on enumerators.  For instance,
	it is now possible to mark enumerators as deprecated:
<blockquote><pre>
enum {
  newval,
  oldval __attribute__ ((deprecated ("too old")))
};
</pre></blockquote></li>
<li>Source locations for the C and C++ compilers are now tracked as ranges,
  rather than just points, making it easier to identify the subexpression
  of interest within a complicated expression.
  For example:
<blockquote><pre>
<b>test.cc:</b> In function <b>'int test(int, int, foo, int, int)'</b>:
<b>test.cc:5:16:</b> <span class="boldred">error:</span> no match for <b>'operator*'</b> (operand types are <b>'int'</b> and <b>'foo'</b>)
   return p + <span class="boldred">q * r</span> * s + t;
              <span class="boldred">~~^~~</span>
</pre></blockquote>
In addition, there is now initial support for precise diagnostic locations
within strings:
<blockquote><pre>
<b>format-strings.c:3:14:</b> <b style='color:magenta'>warning:</b> field width specifier <b>'*'</b> expects a matching <b>'int'</b> argument [<b style='color:magenta'>-Wformat=</b>]
   printf("%*d");
            <b style='color:magenta'>^</b>
</pre></blockquote></li>
    <li>Diagnostics can now contain "fix-it hints", which are displayed
      in context underneath the relevant source code.  For example:
      <!-- this is currently the only example in the tree; various others are pending  -->
<blockquote><pre>
<b>fixits.c:</b> In function <b>'bad_deref'</b>:
<b>fixits.c:11:13:</b> <span class="boldred">error:</span> <b>'ptr'</b> is a pointer; did you mean to use <b>'->'</b>?
   return ptr<span class="boldred">.</span>x;
             <span class="boldred">^</span>
             <span class="boldred">-&gt;</span>
</pre></blockquote></li>
    <li>The C and C++ compilers now offer suggestions for misspelled field names:
<blockquote><pre>
<b>spellcheck-fields.cc:52:13:</b> <span class="boldred">error:</span> <b>'struct s'</b> has no member named <b>'colour'</b>; did you mean <b>'color'</b>?
   return ptr-&gt;<span class="boldred">colour</span>;
               <span class="boldred">^~~~~~</span>
</pre></blockquote></li>
    <!-- also, pending patch to add fix-it hints to the above -->
    <li>New command-line options have been added for the C and C++ compilers:
      <ul>
        <li><code>-Wshift-negative-value</code> warns about left shifting a
          negative value.</li>
        <li><code>-Wshift-overflow</code> warns about left shift overflows.
          This warning is enabled by default.
          <code>-Wshift-overflow=2</code> also warns about left-shifting 1 into
          the sign bit.</li>
        <li><code>-Wtautological-compare</code> warns if a self-comparison
          always evaluates to true or false.  This warning is enabled by
          <code>-Wall</code>.</li>
        <li><code>-Wnull-dereference</code> warns if the compiler detects paths
          that trigger erroneous or undefined behavior due to dereferencing a
          null pointer. This option is only active when
          <code>-fdelete-null-pointer-checks</code> is active, which is enabled
          by optimizations in most targets. The precision of the warnings
          depends on the optimization options used.</li>
        <li><code>-Wduplicated-cond</code> warns about duplicated conditions
	  in an if-else-if chain.</li>
        <li><code>-Wmisleading-indentation</code> warns about places where the
          indentation of the code gives a misleading idea of the block
          structure of the code to a human reader.  For example, given
          <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1266">CVE-2014-1266</a>:
<blockquote><pre>
<b>sslKeyExchange.c:</b> In function <b>'SSLVerifySignedServerKeyExchange'</b>:
<b>sslKeyExchange.c:631:8:</b> <b style='color:magenta'>warning:</b> statement is indented as if it were guarded by... [<b style='color:magenta'>-Wmisleading-indentation</b>]
        <b style='color:magenta'>goto</b> fail;
        <b style='color:magenta'>^~~~</b>
<b>sslKeyExchange.c:629:4:</b> <b style='color:cyan'>note:</b> ...this 'if' clause, but it is not
    <b style='color:cyan'>if</b> ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;signedParams)) != 0)
    <b style='color:cyan'>^~</b>
</pre></blockquote>
          This warning is enabled by <code>-Wall</code>.</li>
      </ul>
    </li>
    <li>The C and C++ compilers now emit saner error messages if
      merge-conflict markers are present in a source file.
<blockquote><pre>
<b>test.c:3:1:</b> <span class="boldred">error:</span> version control conflict marker in file
 <span class="boldred">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> HEAD
 <span class="boldred">^~~~~~~</span>
</pre></blockquote></li>
  </ul>

<h3 id="c">C</h3>
  <ul>
    <li>It is possible to disable warnings when an initialized field of
	a structure or a union with side effects is being overridden when
	using designated initializers via a new warning option
	<code>-Woverride-init-side-effects</code>.</li>
  </ul>

<h3 id="cxx">C++</h3>
  <ul>
    <li>The default mode has been changed to <code>-std=gnu++14</code>.</li>
    <li>C++ Concepts are now supported when compiling with
        <code>-std=gnu++1z</code> or <code>-std=c++1z</code>.</li>
  </ul>

<h4 id="libstdcxx">Runtime Library (libstdc++)</h4>
  <ul>
    <li>Extensions to the C++ Library to support mathematical special
        functions (ISO/IEC 29124:2010), thanks to Edward Smith-Rowland. </li>
    <li>Experimental support for C++17, including the following
      new features:
      <ul>
        <li><code>std::uncaught_exceptions</code> function (this is also
            available for <tt>-std=gnu++NN</tt> modes); </li>
        <li>new member functions <code>try_emplace</code> and
            <code>insert_or_assign</code> for unique_key maps;</li>
        <li>non-member functions <code>std::size</code>,
            <code>std::empty</code>, and <code>std::data</code> for
            accessing containers and arrays;</li>
        <li><code>std::invoke</code>;</li>
        <li><code>std::shared_mutex</code>;</li>
        <li><code>std::void_t</code> and <code>std::bool_constant</code>
            metaprogramming utilities. </li>
      </ul>
      Thanks to Ville Voutilainen for contributing many of the C++17 features.
    </li>
    <li>An experimental implementation of the File System TS.</li>
    <li>Experimental support for most features of the second version of the
        Library Fundamentals TS. This includes polymorphic memory resources
        and array support in <code>shared_ptr</code>, thanks to Fan You.</li>
    <li>Some assertions checked by Debug Mode can now also be enabled by
        <code>_GLIBCXX_ASSERTIONS</code>. The subset of checks enabled by
        the new macro have less run-time overhead than the full
        <code>_GLIBCXX_DEBUG</code> checks and don't affect the library
        ABI, so can be enabled per-translation unit.
    </li>
    <li>Timed mutex types are supported on more targets, including Darwin.
    </li>
    <li>Improved <code>std::locale</code> support for DragonFly and FreeBSD,
        thanks to John Marino and Andreas Tobler.
    </li>
  </ul>


<h3 id="fortran">Fortran</h3>
  <ul>
    <li>The <code>MATMUL</code> intrinsic is now inlined for straightforward
      cases if front-end optimization is active.  The maximum size for
      inlining can be set to <code>n</code> with the
      <code>-finline-matmul-limit=n</code> option and turned off
      with <code>-finline-matmul-llimit=0</code>.</li>
    <li>The <code>-Wconversion-extra</code> option will warn about
      <code>REAL</code> constants which have excess precision for
      their kind.</li>
    <li>The <code>-Winteger-division</code> option has been added, which
      warns about divisions of integer constants which are truncated.
      This option is included in <code>-Wall</code> by default.</li>
  </ul>

<!-- <h3 id="go">Go</h3> -->

<!-- <h3 id="java">Java (GCJ)</h3> -->


<!-- .................................................................. -->
<h2 id="jit">libgccjit</h2>
  <ul>
    <li>The driver code is now run in-process within libgccjit,
      providing a small speed-up of the compilation process.</li>
    <li>The API has gained entrypoints for
      <ul>
        <li><a href="https://gcc.gnu.org/onlinedocs/jit/topics/performance.html">timing how long was spent in different parts of code</a>,</li>
        <li><a href="https://gcc.gnu.org/onlinedocs/jit/topics/functions.html#gcc_jit_block_end_with_switch">creating switch statements</a>,</li>
        <li><a href="https://gcc.gnu.org/onlinedocs/jit/topics/contexts.html#gcc_jit_context_set_bool_allow_unreachable_blocks">allowing unreachable basic blocks in a function</a>, and</li>
        <li><a href="https://gcc.gnu.org/onlinedocs/jit/topics/contexts.html#gcc_jit_context_add_command_line_option">adding arbitrary command-line options to a compilation</a>.</li>
      </ul>
    </li>
  </ul>

<!-- .................................................................. -->
<h2 id="targets">New Targets and Target Specific Improvements</h2>

<h3 id="aarch64">AArch64</h3>
   <ul>
     <li>
       The new command line options <code>-march=native</code>,
       <code>-mcpu=native</code> and <code>-mtune=native</code> are now
       available on native AArch64 GNU/Linux systems.  Specifying
       these options will cause GCC to auto-detect the host CPU and
       rewrite these options to the optimal setting for that system.
       If GCC is unable to detect the host CPU these options have no effect.
     </li>
     <li>
       <code>-fpic</code> is now supported by the AArch64 target when generating
       code for the small code model (<code>-mcmodel=small</code>).  The size of
       the global offset table (GOT) is limited to 28KiB under the LP64 SysV ABI
       , and 15KiB under the ILP32 SysV ABI.
     </li>
     <li>
       The AArch64 port now supports target attributes and pragmas.  Please
       refer to the <a href="https://gcc.gnu.org/onlinedocs/gcc/AArch64-Function-Attributes.html#AArch64-Function-Attributes">
       documentation</a> for details of available attributes and
       pragmas as well as usage instructions.
     </li>
     <li>
       Link-time optimization across translation units with different
       target-specific options is now supported.
     </li>
   </ul>

<h3 id="arm">ARM</h3>
   <ul>
     <li>
       The arm port now supports target attributes and pragmas.  Please
       refer to the <a href="https://gcc.gnu.org/onlinedocs/gcc/ARM-Function-Attributes.html#ARM-Function-Attributes">
       documentation</a> for details of available attributes and
       pragmas as well as usage instructions.
     </li>
   </ul>
<!-- <h3 id="avr">AVR</h3> -->

<h3 id="x86">IA-32/x86-64</h3>
   <ul>
     <li>GCC now supports the Intel CPU named Skylake with AVX-512 extensions
      through <code>-march=skylake-avx512</code>. The switch enables the following
      ISA extensions: AVX-512F, AVX512VL, AVX-512CD, AVX-512BW, AVX-512DQ.
     </li>
     <li>
       Support for new AMD instructions <code>monitorx</code> and
       <code>mwaitx</code> has been added. This includes new intrinsic
       and built-in support. It is enabled through option <code>-mmwaitx</code>.
       The instructions <code>monitorx</code> and <code>mwaitx</code>
       implement the same functionality as the old <code>monitor</code>
       and <code>mwait</code> instructions. In addition <code>mwaitx</code>
       adds a configurable timer. The timer value is received as third
       argument and stored in register <code>%ebx</code>.
     </li>
     <li>
       x86-64 targets now allow stack realignment from a word-aligned stack
       pointer using the command-line option <code>-fstackrealign</code> or
       <code>__attribute__ ((force_align_arg_pointer))</code>.  This allows
       functions compiled with a vector-aligned stack to be invoked from
       objects that keep only word-alignment.
     </li>
     <li>
       Support for address spaces <code>__seg_fs</code>, <code>__seg_gs</code>,
       and <code>__seg_tls</code>.  These can be used to access data via the
       <code>%fs</code> and <code>%gs</code> segments without having to
       resort to inline assembly.
       Please refer to the <a href="https://gcc.gnu.org/onlinedocs/gcc/Named-Address-Spaces.html#Named-Address-Spaces">
       documentation</a> for usage instructions.
     </li>
     <li>
      Support for AMD Zen (family 17h) processors is now available through
      the <code>-march=znver1</code> and <code>-mtune=znver1</code> options.
     </li>
   </ul>
<!-- <h3 id="mips">MIPS</h3> -->

<h3 id="msp430">MSP430</h3>
  <ul>
    <li><p>The MSP430 compiler now has the ability to automatically distribute code
      and data between low memory (addresses below 64K) and high memory.  This only
      applies to parts that actually have both memory regions and only if the
      linker script for the part has been specifically set up to support this
      feature.</p>

      <p>A new attribute of <code>either</code> can be applied to both functions
      and data, and this tells the compiler to place the object into low memory
      if there is room and into high memory otherwise.  Two other new attributes
      - <code>lower</code> and <code>upper</code> - can be used to explicitly
      state that an object should be placed in the specified memory region.  If
      there is not enough left in that region the compilation will fail.</p>

      <p>Two new command-line options - <code>-mcode-region=[lower|upper|either]</code>
      and <code>-mdata-region=[lower|upper|either]</code> - can be used to tell
      the compiler what to do with objects that do not have one of these new
      attributes.</p></li>
  </ul>

<!-- <h3 id="nds32">NDS32</h3> -->

<h3 id="powerpc">PowerPC / PowerPC64 / RS6000</h3>
  <ul>
    <li><p>A new configuration option -<code>--with-advance-toolchain=at</code>
    was added for PowerPC 64-bit GNU/Linux systems to use the header files, library
    files, and the dynamic linker from a specific Advance Toolchain release
    instead of the default versions that are provided by the GNU/Linux
    distribution.  In general, this option is intended for the developers of
    GCC, and it is not intended for general use.</p></li>
  </ul>

<h3 id="s390">S/390, System z, IBM z Systems</h3>
  <ul>
    <li>Support for the IBM z13 processor has been added.  When using
      the <code>-march=z13</code> option, the compiler will generate
      code making use of the new instructions and registers introduced
      with the vector extension facility.  The <code>-mtune=z13</code>
      option enables z13 specific instruction scheduling without
      making use of new instructions.<br/>

      Compiling code with <code>-march=z13</code> reduces the default
      alignment of vector types bigger than 8 bytes to 8.  This is an
      ABI change and care must be taken when linking modules compiled
      with different arch levels which interchange variables
      containing vector type values.  For newly compiled code the GNU
      linker will emit a warning.</li>

    <li>The <code>-mzvector</code> option enables a C/C++ language
      extension.  This extension provides a new
      keyword <code>vector</code> which can be used to define vector
      type variables.  (Note: This is not available when
      enforcing strict standard compliance
      e.g. with <code>-std=c99</code>.  Either enable GNU extensions
      with e.g. <code>-std=gnu99</code> or use
      <code>__vector</code> instead of <code>vector</code>.)<br/>

      Additionally a set of overloaded builtins is provided which is
      partially compatible to the PowerPC Altivec builtins.  In order
      to make use of these builtins the <code>vecintrin.h</code>
      header file needs to be included.</li>

    <li>The new command line options <code>-march=native</code>,
      and <code>-mtune=native</code> are now available on native IBM
      z Systems.  Specifying these options will cause GCC to
      auto-detect the host CPU and rewrite these options to the
      optimal setting for that system.  If GCC is unable to detect
      the host CPU these options have no effect.</li>

    <li>The IBM z Systems port now supports target attributes and
      pragmas.  Please refer to the
      <a href="https://gcc.gnu.org/onlinedocs/gcc/S_002f390-Function-Attributes.html#S_002f390-Function-Attributes">
	documentation</a> for details of available attributes and
      pragmas as well as usage instructions.
    </li>

    <li>Support for the <code>g5</code> and <code>g6
      -march=/-mtune=</code> CPU level switches has been deprecated
      and will be removed in a future GCC release. <code>-m31</code>
      from now on defaults to <code>-march=z900</code> if not
      specified otherwise.  <code>-march=native</code> on a g5/g6
      machine will default to <code>-march=z900</code>.</li>
  </ul>

<!-- <h3 id="rx">RX</h3> -->

<h3 id="sh">SH</h3>
  <ul>
    <li>Support for SH5 / SH64 has been declared obsolete and will be removed
    in future releases.</li>

    <li>Support for the FDPIC ABI has been added.  It can be enabled using the
    new <code>-mfdpic</code> target option and <code>--enable-fdpic</code>
    configure option.</li>
  </ul>

<!-- .................................................................. -->
<h2 id="os">Operating Systems</h2>

<!-- <h3 id="dragonfly">DragonFly BSD</h3> -->

<!-- <h3 id="freebsd">FreeBSD</h3> -->

<h3 id="rtems">RTEMS</h3>
  <ul>
    <li>The RTEMS thread model implementation changed.  Mutexes now
    use self-contained objects defined in Newlib &lt;sys/lock.h&gt;
    instead of Classic API semaphores.  The keys for thread specific data and
    the <code>once</code> function are directly defined via &lt;pthread.h&gt;.
    Self-contained condition variables are provided via Newlib
    &lt;sys/lock.h&gt;.  The RTEMS thread model also supports C++11
    threads.</li>

    <li>OpenMP support now uses self-contained objects provided by Newlib
    &lt;sys/lock.h&gt; and offers a significantly better performance compared
    to the POSIX configuration of <code>libgomp</code>.  It is possible to
    configure thread pools for each scheduler instance via the environment
    variable <code>GOMP_RTEMS_THREAD_POOLS</code>.</li>
  </ul>

<h3 id="aix">AIX</h3>
  <ul>
    <li>DWARF debugging support for AIX 7.1 has been enabled as an optional
    debugging format.  A more recent Technology Level (TL) and GCC built
    with that level are required for full exploitation of DWARF debugging
    capabilities.</li>
  </ul>

<!-- <h3 id="vxmils">VxWorks MILS</h3> -->


<!-- .................................................................. -->
<!-- <h2>Documentation improvements</h2> -->


<!-- .................................................................. -->
<h2>Other significant improvements</h2>

  <ul>
    <li>The <code>gcc</code> and <code>g++</code> driver programs will now
      provide suggestions for misspelled command line options.
<blockquote><pre>
$ gcc -static-libfortran test.f95
gcc: <span class="boldred">error:</span> unrecognized command line option <b>'-static-libfortran'</b>; did you mean <b>'-static-libgfortran'</b>?
</pre></blockquote></li>
    <li>The <code>--enable-default-pie</code> configure option enables
	generation of PIE by default.</li>
  </ul>

</body>
</html>
