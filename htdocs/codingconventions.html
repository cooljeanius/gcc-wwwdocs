<html>

<head>
<title>GCC Coding Conventions</title>
</head>

<body>
<h1>GCC Coding Conventions</h1>

<p>There are some additional coding conventions for code in GCC,
beyond those in the <a
href="http://www.gnu.org/prep/standards_toc.html">GNU Coding
Standards</a>.  Some existing code may not follow these conventions,
but they must be used for new code.  If changing existing
code to follow these conventions, it is best to send changes to follow
the conventions separately from any other changes to the code.</p>


<h2>Documentation</h2>

<p>Documentation, both of user interfaces and of internals, must be
maintained and kept up to date.  In particular:</p>

<ul>

  <li>All command-line options (including all <code>--param</code>
  arguments) must be documented in the GCC manual.</li>

  <li>Any change to documented behavior (for example, the behavior of
  a command-line option or a GNU language extension) must include the
  necessary changes to the manual.</li>

  <li>All target macros must be documented in the GCC manual.</li>

  <li>The documentation of the <code>tree</code> and RTL data
  structures and interfaces must be kept complete and up to date.</li>

  <li>In general, the documentation of all documented aspects of the
  front-end and back-end interfaces must be kept up to date, and the
  opportunity should be taken where possible to remedy gaps in or
  limitations of the documentation.</li>

</ul>


<h2>ChangeLogs</h2>

<p>GCC requires ChangeLog entries for documentation changes; for the web
pages (apart from <code>java/</code> and <code>libstdc++/</code>) the CVS
commit logs are sufficient.</p>

<p>See also what the <a
href="http://www.gnu.org/prep/standards_toc.html">GNU Coding
Standards</a> have to say about what goes in ChangeLogs; in
particular, descriptions of the purpose of code and changes should go
in comments rather than the ChangeLog, though a single line overall
description of the changes may be useful above the ChangeLog entry for
a large batch of changes.</p>

<p>For changes that are ported from another branch, we recommend to
use a single entry whose body contains a verbatim copy of the original
entries describing the changes on that branch, possibly preceded by a
single-line overall description of the changes.</p>

<p>There is no established convention on when ChangeLog entries are to
be made for testsuite changes; see messages <a
href="http://gcc.gnu.org/ml/gcc/2000-09/msg00287.html">1</a> and <a
href="http://gcc.gnu.org/ml/gcc/2000-09/msg00290.html">2</a>.</p>

<p>If your change fixes a PR, put <code>PR java/58</code> (where
<code>java/58</code> is the actual number of the PR) at the top
of the ChangeLog entry.</p>

<h2>Portability</h2>

<p>There are strict requirements for portability of code in GCC to
older systems whose compilers do not implement all of the ISO C standard.
GCC requires at least an ANSI C89 or ISO C90 host compiler, and code
should avoid pre-standard style function definitions, unnecessary
function prototypes and use of the now deprecated @code{PARAMS} macro.
See <a
href="http://gcc.gnu.org/cgi-bin/cvsweb.cgi/~checkout~/gcc/gcc/README.Portability?content-type=text/plain&amp;only_with_tag=HEAD">README.Portability</a>
for details of some of the portability problems that may arise.  Some
of these problems are warned about by <code>gcc -Wtraditional</code>,
which is included in the default warning options in a bootstrap.
(Code outside the C front end is only compiled by GCC, so such
requirements do not apply to it.)</p>

<p>The programs included in GCC are linked with the
libiberty library, which will replace some standard
library functions if not present on the system used, so those
functions may be freely used in GCC.  In particular, the ISO C string
functions <code>memcmp</code>, <code>memcpy</code>,
<code>memmove</code>, <code>memset</code>, <code>strchr</code> and
<code>strrchr</code> are preferred to the old functions
<code>bcmp</code>, <code>bcopy</code>, <code>bzero</code>,
<code>index</code> and <code>rindex</code>; see messages <a
href="http://gcc.gnu.org/ml/gcc/1998-09/msg01000.html">1</a> and <a
href="http://gcc.gnu.org/ml/gcc/1998-09/msg01127.html">2</a>.  The
older functions must no longer be used in GCC; apart from
<code>index</code>, these identifiers are poisoned to prevent their
use.</p>

<p>Machine-independent files may contain conditionals on features of a
particular system, but should never contain conditionals such as
<code>#ifdef __hpux__</code> on the name or version of a particular
system.  Exceptions may be made to this on a release branch late in
the release cycle, to reduce the risk involved in fixing a problem
that only shows up on one particular system.</p>

<p>Avoid the use of identifiers or idioms that would prevent code
compiling with a C++ compiler.  Identifiers such as <code>new</code>
or <code>class</code>, that are reserved words in C++, should not be
used as variables or field names.  Explicit casts should be used to
convert between <code>void*</code> and other pointer types.</p>

<p>Function prototypes for extern functions should only occur in
header files.  Functions should be ordered within source files to
minimize the number of function prototypes, by defining them before
their first use.  Function prototypes should only be used when
necessary, to break mutually recursive cycles.</p>


<h2>Makefiles</h2>

<p><code>touch</code> should never be used in GCC Makefiles.  Instead
of <code>touch foo</code> always use <code>$(STAMP) foo</code>.</p>


<h2>Testsuite Conventions</h2>

<p>Every language or library feature, whether standard or a GNU
extension, and every warning GCC can give, should have testcases
thoroughly covering both its specification and its implementation.
Every bug fixed should have a testcase to detect if the bug
recurs.</p>

<p>The testsuite READMEs discuss the requirement to use <code>abort
()</code> for runtime failures and <code>exit (0)</code> for success.
For compile-time tests, a trick taken from autoconf may be used to evaluate
expressions: a declaration <code>extern char x[(EXPR) ? 1 :
-1];</code> will compile successfully if and only if <code>EXPR</code>
is nonzero.</p>

<p>Where appropriate, testsuite entries should include comments giving
their origin: the people who added them or submitted the bug report
they relate to, possibly with a reference to a PR in our bug tracking
system.  There are <a
href="http://gcc.gnu.org/ml/gcc/2000-01/msg00593.html">some copyright
guidelines</a> on what can be included in the testsuite.</p>

<p>If a testcase itself is incorrect, but there's a possibility that an
improved testcase might fail on some platform where the incorrect
testcase passed, the old testcase should be removed and a new testcase
(with a different name) should be added.  This helps automated
regression-checkers distinguish a true regression from an improvement
to the test suite.</p>


<h2>Miscellaneous Conventions</h2>

<p>Code should use <code>gcc_assert(EXPR)</code> to check invariants.
Use <code>gcc_unreachable()</code> to mark places that should never be
reachable (such as an unreachable <code>default</code> case of a
switch).  Do not use <code>gcc_assert(0)</code> for such purposes, as
<code>gcc_unreachable</code> gives the compiler more information.  The
assertions are enabled unless explicitly configured off with
<code>--enable-checking=none</code>.  Do not use <code>abort</code>.
User input should never be validated by either <code>gcc_assert</code>
or <code>gcc_unreachable</code>.  If the checks are expensive or the
compiler can reasonably carry on after the error, they may be
conditioned on <code>--enable-checking</code>.</p>

<p>Code testing properties of characters from user source code should
use macros such as <code>ISALPHA</code> from <code>safe-ctype.h</code>
instead of the standard functions such as <code>isalpha</code> from
<code>&lt;ctype.h&gt;</code> to avoid any locale-dependency of the
language accepted.</p>

<p>Code in GCC should use the following formatting conventions:</p>

<table cellpadding="4">
<tr>
  <th align="right">Use...</th><th align="left">...instead of</th>
</tr><tr>
  <td align="right"><code>!x</code></td><td><code>! x</code></td>
</tr><tr>
  <td align="right"><code>~x</code></td><td><code>~ x</code></td>
</tr><tr>
  <td align="right"><code>-x</code> (unary minus)</td><td><code>- x</code></td>
</tr><tr>
  <td align="right"><code>(foo) x</code> (cast)</td>
  <td><code>(foo)x</code></td>
</tr><tr>
  <td align="right"><code>*x</code> (pointer dereference)</td>
  <td><code>* x</code></td>
</tr>
</table>


<p>Macros names should be in <code>ALL_CAPS</code> when it's important
to be aware that it's a macro (e.g. accessors and simple predicates),
but in lowercase (e.g., <code>size_int</code>) where the macro is a
wrapper for efficiency that should be considered as a function; see
messages <a
href="http://gcc.gnu.org/ml/gcc-patches/2000-09/msg00901.html">1</a>
and <a
href="http://gcc.gnu.org/ml/gcc-patches/2000-09/msg00912.html">2</a>.</p>

<p>Testing for <code>ERROR_MARK</code>s should be done by comparing
against <code>error_mark_node</code> rather than by comparing the
<code>TREE_CODE</code> against <code>ERROR_MARK</code>; see <a
href="http://gcc.gnu.org/ml/gcc-patches/2000-10/msg00792.html">message</a>.</p>

<p>Internal numeric parameters that may affect generated code should
be controlled by <code>--param</code> rather than being hardcoded.</p>


<h2>Spelling, terminology and markup</h2>

<p>The following conventions of spelling and terminology apply
throughout GCC, including the manuals, web pages, diagnostics,
comments, and (except where they require spaces or hyphens to be used)
function and variable names, although consistency in user-visible
documentation and diagnostics is more important than that in comments
and code.  The following table lists some simple cases:</p>

<table cellpadding="4">
  <tr>
    <th>Use...</th><th>...instead of</th><th>Rationale</th>
  </tr>
  <tr>
    <td>American spelling (in particular -ize, -or)</td>
    <td>British spelling (in particular -ise, -our)</td>
    <td></td>
  </tr>
  <tr>
    <td>"32-bit" (adjective)</td>
    <td>"32 bit"</td>
    <td></td>
  </tr>
  <tr>
    <td>"back end" (noun)</td>
    <td>"back-end" or "backend"</td>
    <td></td>
  </tr>
  <tr>
    <td>"back-end" (adjective)</td>
    <td>"back end" or "backend"</td>
    <td></td>
  </tr>
  <tr>
    <td>"bit-field"</td>
    <td>"bit field" or "bitfield"</td>
    <td>Spelling used in C and C++ standards</td>
  </tr>
  <tr>
    <td>"built-in" as an adjective ("built-in function") or "built in"</td>
    <td>"builtin"</td>
    <td>"builtin" isn't a word</td>
  </tr>
  <tr>
    <td>"ColdFire"</td>
    <td>"coldfire" or "Coldfire"</td>
    <td></td>
  </tr>
  <tr>
    <td>"dependent" (adjective), "dependence", "dependency"</td>
    <td>"dependant", "dependance", "dependancy"</td>
    <td></td>
  </tr>
  <tr>
    <td>"enumerated"</td>
    <td>"enumeral"</td>
    <td>Terminology used in C and C++ standards</td>
  </tr>
  <tr>
    <td>"epilogue"</td>
    <td>"epilog"</td>
    <td>Established convention</td>
  </tr>
  <tr>
    <td>"front end" (noun)</td>
    <td>"front-end" or "frontend"</td>
    <td></td>
  </tr>
  <tr>
    <td>"front-end" (adjective)</td>
    <td>"front end" or "frontend"</td>
    <td></td>
  </tr>
  <tr>
    <td>"GNU/Linux" (except in reference to the kernel)</td>
    <td>"Linux" or "linux" or "Linux/GNU"</td>
    <td></td>
  </tr>
  <tr>
    <td>"lowercase"</td>
    <td>"lower case" or "lower-case"</td>
    <td></td>
  </tr>
  <tr>
    <td>"H8S"</td>
    <td>"H8/S"</td>
    <td></td>
  </tr>
  <tr>
    <td>"Microsoft Windows"</td>
    <td>"Windows"</td>
    <td></td>
  </tr>
  <tr>
    <td>"MIPS"</td>
    <td>"Mips" or "mips"</td>
    <td></td>
  </tr>
  <tr>
    <td>"nonzero"</td>
    <td>"non-zero" or "non zero"</td>
    <td></td>
  </tr>
  <tr>
    <td>"Objective-C"</td>
    <td>"Objective C"</td>
  </tr>
  <tr>
    <td>"prologue"</td>
    <td>"prolog"</td>
    <td>Established convention</td>
  </tr>
  <tr>
    <td>"PowerPC"</td>
    <td>"powerpc", "powerPC" or "PowerPc"</td>
  </tr>
  <tr>
    <td>"Red Hat"</td>
    <td>"RedHat" or "Redhat"</td>
    <td></td>
  </tr>
  <tr>
    <td>"SPARC"</td>
    <td>"Sparc" or "sparc"</td>
  </tr>
  <tr>
    <td>"testcase", "testsuite"</td>
    <td>"test-case" or "test case", "test-suite" or "test suite"</td>
  </tr>
  <tr>
    <td>"uppercase"</td>
    <td>"upper case" or "upper-case"</td>
    <td></td>
  </tr>
  <tr>
    <td>"VAX", "VAXen", "MicroVAX"</td>
    <td>"vax" or "Vax", "vaxen" or "vaxes", "microvax" or "microVAX"</td>
  </tr>
</table>

<p>"GCC" should be used for the GNU Compiler Collection, both
generally and as the GNU C Compiler in the context of compiling C;
"G++" for the C++ compiler; "gcc" and "g++" (lowercase), marked up
with <code>@command</code> when in Texinfo, for the commands for
compilation when the emphasis is on those; "GNU C" and "GNU C++" for
language dialects; and try to avoid the older term "GNU CC".</p>

<p>Use a comma after "e.g." or "i.e." if and only if it is appropriate
in the context and the slight pause a comma means helps the reader; do
not add them automatically in all cases just because some style guides
say so.  (In Texinfo manuals, <code>@:</code> should to be used after
"e.g." and "i.e." when a comma isn't used.)</p>

<p>In Texinfo manuals, Texinfo 4.0 features may be used, and should be
used where appropriate.  URLs should be marked up with
<code>@uref</code>; email addresses with <code>@email</code>;
command-line options with <code>@option</code>; names of commands with
<code>@command</code>; environment variables with <code>@env</code>.
NULL should be written as <code>@code{NULL}</code>.  Tables of
contents should come just after the title page; printed manuals will
be formatted (for example, by <code>make dvi</code>) using
<code>texi2dvi</code> which reruns TeX until cross-references
stabilize, so there is no need for a table of contents to go at the
end for it to have correct page numbers.  The <code>@refill</code>
feature is obsolete and should not be used.  All manuals should use
<code>@dircategory</code> and <code>@direntry</code> to provide Info
directory information for <code>install-info</code>.</p>

<p>It is useful to read the <a
href="http://www.gnu.org/software/texinfo/manual/texinfo/">Texinfo manual</a>.
Some general Texinfo style issues discussed in that manual should be
noted:</p>

<ul>

  <li>For proper formatting of the printed manual, TeX quotes (matched
  <code>`</code> or <code>``</code> and <code>'</code> or
  <code>''</code>) should be used; neutral ASCII double quotes
  (<code>"..."</code>) should not be.  Similarly, TeX dashes
  (<code>--</code> (two hyphens) for an en dash and <code>---</code>
  (three hyphens) for an em dash) should be used; normally these
  dashes should not have whitespace on either side.  Minus signs
  should be written as <code>@minus{}</code>.</li>

  <li>For an ellipsis, <code>@dots{}</code> should be used; for a
  literal sequence of three dots in a programming language, the dots
  should be written as such (<code>...</code>) rather than as
  <code>@dots{}</code>.</li>

  <li>English text in programming language comments in examples should
  be enclosed in <code>@r{}</code> so that it is printed in a
  non-fixed-width font.</li>

  <li>Full stops that end sentences should be
  followed by two spaces or by end of line.  Full
  stops that are preceded by a lower-case letter but do not end a
  sentence should be followed by <code>@:</code> if they are not
  followed by other punctuation such as a comma; full stops, question
  marks and exclamation marks that end a sentence but are preceded by
  an upper-case letter should be written as "<code>@.</code>",
  "<code>@?</code>" and "<code>@!</code>", respectively.  (This is not
  required if the capital letter is within <code>@code</code> or
  <code>@samp</code>.)</li>

</ul>


<h2 id="upstream">Upstream packages</h2>

<p>Some files and packages in the GCC source tree are imported from
elsewhere, and we want to minimize divergence from their upstream sources.
The following files should be updated only according to the rules set
below:</p>

<ul>

<li>config.guess, config.sub: The master copy of these files is at <a
href="ftp://ftp.gnu.org/pub/gnu/config/">ftp://ftp.gnu.org/pub/gnu/config</a>.
Proposed changes should be e-mailed to <a
href="mailto:config-patches@gnu.org">config-patches@gnu.org</a>.  Only
after the change makes it to the FTP site should the new files be
installed in the GCC source tree, so that their version numbers remain
meaningful and unique.  Don't install the patch, install the whole
file.</li>

<li>ltconfig, ltmain.sh, libtool.m4, ltcf-c.sh, ltcf-cxx.sh,
ltcf-gcj.sh: The master copy of these files is the CVS repository of
<a href="http://www.gnu.org/software/libtool/libtool.html">GNU
libtool</a>.  Patches should be posted to <a
href="mailto:libtool-patches@gnu.org">libtool-patches@gnu.org</a>.
Only after the change makes it to the libtool CVS tree should the new
files be installed in the GCC source tree.  ltconfig and ltmain.sh are
generated files from ltconfig.in and ltmain.in, respectively, so, when
you post the patch, make sure you're patching the source file, not the
generated one.  When you update these generated files in the GCC
repository, make sure they report the same timestamp and version number,
and note this version number in the ChangeLog.</li>

<li>Top-level configure.in, configure, Makefile.in, config-ml.in,
config.if and most other top-level shell-scripts: Please try to keep
these files in sync with the corresponding files in the src repository
at sourceware.org.  Some people hope to eventually merge these
trees into a single repository; keeping them in sync helps this goal.
When you check in a patch to one of these files, please check it in
the src tree too, or ask someone else with write access there to
do so.</li>

<li>Top-level compile, depcomp, install-sh, missing, mkinstalldirs,
symlink-tree and ylwrap:  These are copied from mainline automake, using
<code>automake --add-missing --copy --force-missing</code>.</li>

<li>gcc/config/soft-fp: The master sources (except for
<code>t-softfp</code>) are in CVS glibc, and changes should go into
CVS glibc before going into GCC.</li>

<li>fastjar: The master sources were at <a
href="http://fastjar.sourceforge.net/">fastjar.sourceforge.net</a>.
However, the upstream source seems to be dead, so fastjar is
essentially maintained in the GCC source tree.</li>

<li>boehm-gc: The master sources are at <a
href="http://www.hpl.hp.com/personal/Hans_Boehm/gc/">www.hpl.hp.com/personal/Hans_Boehm/gc/</a>.
Patches should be sent to <a href="mailto:boehm@acm.org">boehm@acm.org</a>,
but it's acceptable to check them in the GCC source tree before getting
them installed in the master tree.</li>

<li>libjava/classpath: The master sources come from
<a href="http://www.gnu.org/software/classpath/">GNU Classpath</a>.  
New versions of Classpath are periodically imported into the GCC source
tree.  In general local modifications are prohibited, but they can be
checked in for emergencies, such as fixing bootstrap.  </li>

<li>zlib: The master sources come from
<a href="http://www.zlib.net/">zlib.net</a>.  However, the
autoconf-based configury is a local GCC invention.  Changes to zlib
outside the build system are discouraged, and should be sent upstream
first. </li>

<li>libstdc++-v3:  In docs/doxygen, comments in *.cfg.in are
partially autogenerated from <a href="http://www.doxygen.org/">the
Doxygen tool</a>.  In docs/html, the ext/lwg-* files are copied from <a
href="http://www.open-std.org/jtc1/sc22/wg21/">the C++ committee homepage</a>,
the 27_io/binary_iostream_* files are copies of Usenet postings, and most
of the files in 17_intro are either copied from elsewhere in GCC or the
FSF website, or are autogenerated.  These files should not be changed
without prior permission, if at all.</li>

</ul>

</body>
</html>
