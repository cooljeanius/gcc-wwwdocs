<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>GCC 11 Release Series &mdash; Changes, New Features, and Fixes</title>
<link rel="stylesheet" type="text/css" href="https://gcc.gnu.org/gcc.css" />
</head>

<!-- GCC maintainers, please do not hesitate to contribute/update
     entries concerning those part of GCC you maintain!
-->

<body>
<h1>GCC 11 Release Series<br/>Changes, New Features, and Fixes</h1>

<p>
This page is a "brief" summary of some of the huge number of improvements
in GCC 11.
You may also want to check out our
<a href="porting_to.html">Porting to GCC 11</a> page and the
<a href="../onlinedocs/index.html#current">full GCC documentation</a>.
</p>

<p>Note: GCC 11 has not been released yet, so this document is
a work-in-progress.</p>

<!-- .................................................................. -->
<h2>Caveats</h2>
<ul>
  <li>The default mode for C++ is now <code>-std=gnu++17</code> instead of
    <code>-std=gnu++14</code>.  Note
      that <a href="http://wg21.link/p0522r0">C++17 changes to template
      template parameter matching</a> can be disabled independently of other
      features with <code>-fno-new-ttp-matching</code>.
  </li>

  <li>When building GCC itself, the host compiler must now support C++11,
    rather than C++98.  In particular bootstrapping GCC 11 using an older
    version of GCC requires a binary of GCC 4.8 or later, rather than of
    GCC 3.4 or later as was the case for bootstrapping GCC 10.</li>

  <li>Naming and location of auxiliary and dump output files changed.
      If you compile multiple input files in a single command, if you
      enable Link Time Optimization, or if you use <code>-dumpbase</code>,
      <code>-dumpdir</code>, <code>-save-temps=*</code>, and you expect
      any file other than the
      primary output file(s) to be created as a side effect, watch out
      for improvements and a few surprises.
      See <a href="https://gcc.gnu.org/pipermail/gcc-patches/2020-May/546494.html">the
      patch</a>, particularly its textual description, for more
      details about the changes.</li>

  <li><code>-gsplit-dwarf</code> no longer enables debug info generation
      on its own but requires a separate <code>-g</code> for this.</li>

  <li>The libstdc++ configure option <code>--enable-cheaders=c_std</code>
      is deprecated and will be removed in a future release. It should be
      possible to use <code>--enable-cheaders=c_global</code> (the default)
      with no change in behaviour. </li>
</ul>


<!-- .................................................................. -->
<h2 id="general">General Improvements</h2>

<ul>
  <li>
    <a href="https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual">
    ThreadSanitizer</a> improvements to support alternative runtimes and
    environments. The <a href="https://www.kernel.org/doc/html/latest/dev-tools/kcsan.html">
    Linux Kernel Concurrency Sanitizer (KCSAN)</a> is now supported.
    <ul>
      <li>Add <code>--param tsan-distinguish-volatile</code> to optionally emit
          instrumentation distinguishing volatile accesses.</li>
      <li>Add <code>--param tsan-instrument-func-entry-exit</code> to optionally
          control if function entries and exits should be instrumented.</li>
    </ul>
  </li>
  <li>
    <p>
      In previous releases of GCC, the "column numbers" emitted in diagnostics
      were actually a count of bytes from the start of the source line.  This
      could be problematic, both because of:
    </p>
    <ul>
      <li>multibyte characters (requiring more than one byte to encode), and</li>
      <li>multicolumn characters (requiring more than one column to display in a monospace font)</li>
    </ul>
    <p>
      For example, the character &#x3c0; ("GREEK SMALL LETTER PI (U+03C0)")
      occupies one column, and its UTF-8 encoding requires two bytes; the
      character &#x1F642; ("SLIGHTLY SMILING FACE (U+1F642)") occupies two
      columns, and its UTF-8 encoding requires four bytes.
    </p>
    <p>
      In GCC 11 the column numbers default to being column numbers, respecting
      multi-column characters.  The old behavior can be restored using a new
      option
      <a href="https://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Message-Formatting-Options.html#index-fdiagnostics-column-unit">-fdiagnostics-column-unit=byte</a>.
      There is also a new option
      <a href="https://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Message-Formatting-Options.html#index-fdiagnostics-column-origin">-fdiagnostics-column-origin=</a>,
      allowing the pre-existing default of the left-hand column being column
      1 to be overridden if desired (e.g. for 0-based columns).  The output
      of
      <a href="https://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Message-Formatting-Options.html#index-fdiagnostics-format">-fdiagnostics-format=json</a>
      has been extended to supply both byte counts and column numbers for all source locations.
    </p>
    <p>
      Additionally, in previous releases of GCC, tab characters in the source
      would be emitted verbatim when quoting source code, but be prefixed
      with whitespace or line number information, leading to misalignments
      in the resulting output when compared with the actual source.  Tab
      characters are now printed as an appropriate number of spaces, using the
      <a href="https://gcc.gnu.org/onlinedocs/gcc/Preprocessor-Options.html#index-ftabstop">-ftabstop</a>
      option (which defaults to 8 spaces per tab stop).
    </p>
  </li>
</ul>

<!-- .................................................................. -->
<h2 id="languages">New Languages and Language specific improvements</h2>

<ul>
  <li>GCC 11 adds support for non-rectangular loop nests in OpenMP
      constructs and the allocator routines of
      <a href="https://www.openmp.org/specifications/">OpenMP 5.0</a>,
      including initial <code>allocate</code> clause support in C/C++.
      The <code>OMP_TARGET_OFFLOAD</code> environment variable and the
      active-levels routines are now supported.
      For C/C++, the <code>declare variant</code> and <code>map</code>
      support has been extended.
      For Fortran, OpenMP 4.5 is now fully supported and OpenMP 5.0
      support has been extended, including the following features which were
      before only available in C and C++: <code>order(concurrent)</code>,
      <code>device_type</code>, memorder-clauses for <code>flush</code>,
      <code>lastprivate</code> with <code>conditional</code> modifier,
      <code>atomic</code> construct and <code>reduction</code> clause
      extensions of OpenMP 5.0,
      <code>if</code> clause with <code>simd</code> and <code>cancel</code>
      modifiers, <code>target data</code> without <code>map</code> clause,
      and limited support for the <code>requires</code> construct.
  </li>
</ul>

<!-- <h3 id="ada">Ada</h3> -->

<!-- <h3 id="brig">BRIG (HSAIL)</h3> -->

<h3 id="c-family">C family</h3>
<ul>
  <li>New warnings:
    <ul>
      <li><code>-Wsizeof-array-div</code>, enabled by <code>-Wall</code>, warns
	  about divisions of two sizeof operators when the first one is applied
	  to an array and the divisor does not equal the size of the array
	  element.
      </li>
    </ul>
  </li>
  <li>
    For ELF targets that support the GNU or FreeBSD OSABIs, the
    <code>used</code> attribute will now save the symbol declaration it is
    applied to from linker garbage collection.
    <br>
    To support this behavior, <code>used</code> symbols that have not
    been placed in specific sections (e.g. with the <code>section</code>
    attribute, or the <code>-f{function,data}-sections</code> options) will
    be placed in new, unique sections.
    <br>
    This functionality requires Binutils version 2.36 or later.
  </li>
</ul>

<h3 id="cxx">C++</h3>
<ul>
  <li>The default mode has been changed to <code>-std=gnu++17</code>.</li>
  <li>Several C++20 features have been implemented:
    <ul>
      <li>the compiler now supports <code>consteval virtual</code> functions</li>
      <li>P2082R1, Fixing CTAD for aggregates</li>
      <li>P0593R6, Pseudo-destructors end object lifetimes</li>
      <li>P1907R1, Inconsistencies with non-type template parameters (complete
	  implementation)</li>
      <li>P1975R0, Fixing the wording of parenthesized aggregate-initialization</li>
      <li>P1009R2, Array size deduction in <i>new-expression</i>s</li>
      <li>P1099R5, <code>using enum</code></li>
    </ul>
  </li>
  <li>Several C++ Defect Reports have been resolved, e.g.:
    <ul>
      <li>DR 625, Use of <code>auto</code> as a <em>template-argument</em></li>
      <li>DR 1512, Pointer comparison vs qualification conversions</li>
      <li>DR 1722, Should lambda to function pointer conversion function be
	  <code>noexcept</code>?</li>
      <li>DR 1914, Duplicate standard attributes</li>
      <li>DR 2032, Default <i>template-arguments</i> of variable templates</li>
      <li>DR 2289, Uniqueness of decomposition declaration names</li>
      <li>DR 2237, Can a <i>template-id</i> name a constructor?</li>
      <li>DR 2303, Partial ordering and recursive variadic inheritance</li>
      <li>DR 2369, Ordering between constraints and substitution</li>
      <li>DR 2450, <i>braced-init-list</i> as a <i>template-argument</i></li>
    </ul>
  </li>
  <li>G++ now performs better access checking in templates
      (<a href="https://gcc.gnu.org/PR41437">PR41437</a>).</li>
  <li><code>reinterpret_cast</code>s in constexpr evaluation are now checked
      more completely (<a href="https://gcc.gnu.org/PR95307">PR95307</a>).</li>
  <li>The diagnostic for <code>static_assert</code> has been improved: the
      compiler now shows the expression including its template arguments (if
      there were any), and can point to the failing clause if the condition
      comprised of any logical AND operators
      (<a href="https://gcc.gnu.org/PR97518">PR97518</a>).</li>
  <li>New warnings:
    <ul>
      <li><code>-Wctad-maybe-unsupported</code>, disabled by default, warns
	  about performing class template argument deduction on a type with no
	  deduction guides.
      </li>
      <li><code>-Wrange-loop-construct</code>, enabled by <code>-Wall</code>,
	  warns when a range-based for-loop is creating unnecessary and
	  expensive copies.
      </li>
      <li><code>-Wdeprecated-enum-enum-conversion</code>, enabled by default in
	  C++20, warns about deprecated arithmetic conversions on operands of
	  enumeration types, as outlined in <em>[depr.arith.conv.enum]</em>.
      </li>
      <li><code>-Wdeprecated-enum-float-conversion</code>, enabled by default in
	  C++20, warns about deprecated arithmetic conversions on operands where
	  one is of enumeration type and the other is of a floating-point type,
	  as outlined in <em>[depr.arith.conv.enum]</em>.
      </li>
      <li><code>-Wvexing-parse</code>, enabled by default, warns about the most
	  vexing parse rule: the cases when a declaration looks like a variable
	  definition, but the C++ language requires it to be interpreted as a
	  function declaration.
      </li>
    </ul>
  </li>
</ul>

<!-- <h4 id="libstdcxx">Runtime Library (libstdc++)</h4> -->

<h3 id="fortran">Fortran</h3>

<ul>
  <li>Added <code>DEPRECATED</code> to <code>!GCC$</code>'s
      <code>attributes</code> directive.
  </li>
</ul>

<!-- <h3 id="go">Go</h3> -->

<!-- .................................................................. -->
<h2 id="jit">libgccjit</h2>
<ul>
  <li>libgccjit can now be built for MinGW</li>
  <li>
    The libgccjit API gained 10 new entry points:
    <ul>
      <li>
	<a href="https://gcc.gnu.org/onlinedocs/jit/topics/expressions.html#c.gcc_jit_global_set_initializer">gcc_jit_global_set_initializer</a>
      </li>
      <li>9 entrypoints for <a href="https://gcc.gnu.org/onlinedocs/jit/topics/asm.html">directly embedding asm statements into a compile</a>, analogous to inline <code>asm</code> in the C front end</li>
    </ul>
  </li>
</ul>

<!-- .................................................................. -->
<h2 id="targets">New Targets and Target Specific Improvements</h2>

<!-- <h3 id="aarch64">AArch64</h3> -->

<!-- <h3 id="arc">ARC</h3> -->

<!-- <h3 id="arm">ARM</h3> -->

<!-- <h3 id="avr">AVR</h3> -->

<!-- <h3 id="hsa">Heterogeneous Systems Architecture</h3> -->

<h3 id="x86">IA-32/x86-64</h3>
<ul>
  <li>New ISA extension support for Intel TSXLDTRK was added to GCC.
      TSXLDTRK intrinsics are available via the <code>-mtsxldtrk</code>
      compiler switch.
  </li>
  <li>New ISA extension support for Intel SERIALIZE was added to GCC.
      SERIALIZE intrinsics are available via the <code>-mserialize</code>
      compiler switch.
  </li>
  <li>New ISA extension support for Intel HRESET was added to GCC.
      HRESET intrinsics are available via the <code>-mhreset</code>
      compiler switch.
  </li>
  <li>New ISA extension support for Intel UINTR was added to GCC.
      UINTR intrinsics are available via the <code>-muintr</code>
      compiler switch.
  </li>
  <li>New ISA extension support for Intel KEYLOCKER was added to GCC.
      KEYLOCKER intrinsics are available via the <code>-mkeylocker</code>
      compiler switch.
  </li>
  <li>New ISA extension support for Intel AMX-TILE, AMX-INT8, AMX-BF16 was
      added to GCC. AMX-TILE, AMX-INT8, AMX-BF16 intrinsics are available
      via the <code>-mamx-tile, -mamx-int8, -mamx-bf16</code> compiler
      switches.
  </li>
  <li>New ISA extension support for Intel AVX-VNNI was added to GCC.
      AVX-VNNI intrinsics are available via the <code>-mavxvnni</code>
      compiler switch.
  </li>
  <li>GCC now supports the Intel CPU named Sapphire Rapids through
    <code>-march=sapphirerapids</code>.
    The switch enables the MOVDIRI, MOVDIR64B, AVX512VP2INTERSECT, ENQCMD,
    CLDEMOTE, SERIALIZE, PTWRITE, WAITPKG, TSXLDTRK, AMT-TILE, AMX-INT8,
    AMX-BF16, and AVX-VNNI ISA extensions.
  </li>
  <li>GCC now supports the Intel CPU named Alderlake through
    <code>-march=alderlake</code>.
    The switch enables the CLDEMOTE, PTWRITE, WAITPKG, SERIALIZE, KEYLOCKER,
    AVX-VNNI, and HRESET ISA extensions.
  </li>
</ul>


<!-- <h3 id="mips">MIPS</h3> -->

<!-- <h3 id="mep">MeP</h3> -->

<!-- <h3 id="msp430">MSP430</h3> -->

<!-- <h3 id="nds32">NDS32</h3> -->

<!-- <h3 id="nios2">Nios II</h3> -->

<h3 id="nvptx">NVPTX</h3>
<ul>
  <li>The <code>-misa</code> default has changed from <code>sm_30</code>
      to <code>sm_35</code>.
  </li>
  <li>The <code>-m32</code> compiler switch has been removed.
  </li>
  <li>The <code>-msoft-stack-reserve-local</code> format has been fixed.
      Previously, it accepted <code>-msoft-stack-reserve-local&lt;n&gt;</code>.
      It now accepts <code>-msoft-stack-reserve-local=&lt;n&gt;</code>.
  </li>
</ul>


<!-- <h3 id="hppa">PA-RISC</h3> -->

<!-- <h3 id="powerpc">PowerPC / PowerPC64 / RS6000</h3> -->

<h3 id="s390">S/390, System z, IBM Z Systems</h3>
<ul>
  <li>The behavior when compiling with <code>-fexcess-precision=standard</code>
      (e.g., implied by <code>-std=c99</code>) on s390(x) targets can now be
      controlled at configure time with the flag
      <code>--enable-s390-excess-float-precision</code>. When enabled, GCC will
      maintain previous behavior and evaluate float expressions in double
      precision, which aligns with the definition of <code>float_t</code> as
      <code>double</code>. With the flag disabled, GCC will always evaluate
      float expressions in single precision. In native builds, GCC will by
      default match the definition of <code>float_t</code> in the installed
      glibc.
  </li>
</ul>

<!-- <h3 id="riscv">RISC-V</h3> -->

<!-- <h3 id="rx">RX</h3> -->

<!-- <h3 id="sh">SH</h3> -->

<!-- <h3 id="sparc">SPARC</h3> -->

<!-- <h3 id="Tile">Tile</h3> -->

<!-- .................................................................. -->
<h2 id="os">Operating Systems</h2>

<!-- <h3 id="aix">AIX</h3> -->

<!-- <h3 id="fuchsia">Fuchsia</h3> -->

<!-- <h3 id="dragonfly">DragonFly BSD</h3> -->

<!-- <h3 id="freebsd">FreeBSD</h3> -->

<!-- <h3 id="gnulinux">GNU/Linux</h3> -->

<!-- <h3 id="rtems">RTEMS</h3> -->

<!-- <h3 id="solaris">Solaris</h3> -->

<!-- <h3 id="vxmils">VxWorks MILS</h3> -->

<!-- <h3 id="windows">Windows</h3> -->


<!-- .................................................................. -->
<!-- <h2>Documentation improvements</h2> -->


<!-- .................................................................. -->
<h2 id="analyzer">Improvements to Static Analyzer</h2>
<ul>
  <li>The implementation of how program state is tracked within
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html">-fanalyzer</a>
    has been completely rewritten for GCC 11, fixing numerous bugs, and
    allowing for the analyzer to scale to larger C source files.
  </li>
  <li>As preliminary work towards eventually supporting C++, the
    <code>malloc</code>/<code>free</code> checking within
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html">-fanalyzer</a>
    has been generalized to also check <code>new</code>/<code>delete</code>
    and <code>new[]</code>/<code>delete[]</code>, adding a new
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-Wanalyzer-mismatching-deallocation">-Wanalyzer-mismatching-deallocation</a>
    warning.  However, C++ is not yet properly supported by
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html">-fanalyzer</a>
    (for example, exception-handling is unimplemented).</li>
  <li>The analyzer has gained warnings
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-Wanalyzer-shift-count-negative">-Wanalyzer-shift-count-negative</a>,
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-Wanalyzer-shift-count-overflow">-Wanalyzer-shift-count-overflow</a>,
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-Wanalyzer-write-to-const">-Wanalyzer-write-to-const</a>, and
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-Wanalyzer-write-to-string-literal">-Wanalyzer-write-to-string-literal</a>,
    all enabled by default when
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html">-fanalyzer</a>
    is enabled.
  </li>
  <li>The analyzer has gained new debugging options
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-fdump-analyzer-json">-fdump-analyzer-json</a> and
    <a href="https://gcc.gnu.org/onlinedocs/gcc/Static-Analyzer-Options.html#index-fno-analyzer-feasibility">-fno-analyzer-feasibility</a>.
  </li>
</ul>

<!-- .................................................................. -->
<!-- <h2 id="plugins">Improvements for plugin authors</h2> -->

<!-- .................................................................. -->
<!-- <h2>Other significant improvements</h2> -->


<!-- .................................................................. -->
<!-- <h2><a id="GCC11.1">GCC 11.1</a></h2> -->

</body>
</html>
