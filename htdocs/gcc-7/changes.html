<html>

<head>
<title>GCC 7 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 7 Release Series<br />Changes, New Features, and Fixes</h1>

<p>
This page is a brief summary of some of the huge number of improvements in GCC 7.
For more information, see the
<!-- <a href="porting_to.html">Porting to GCC 7</a> page and the -->
<a href="../onlinedocs/index.html#current">full GCC documentation</a>.
</p>

<!-- .................................................................. -->
<h2>Caveats</h2>
<ul>
  <li>GCC now uses <a href="https://gcc.gnu.org/wiki/LRAIsDefault">LRA by
      default</a> for new targets.</li>

  <li>The non-standard C++0x type traits
      <code>has_trivial_default_constructor</code>,
      <code>has_trivial_copy_constructor</code> and
      <code>has_trivial_copy_assign</code> have been removed.</li>
  <li>The libstdc++
      <a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/profile_mode.html">Profile
      Mode</a> has been deprecated and will be removed in a future version.
  </li>
</ul>

<!-- .................................................................. -->
<h2 id="general">General Optimizer Improvements</h2>
<!--
<ul>
  <li></li>
</ul>
-->

<!-- .................................................................. -->
<h2 id="languages">New Languages and Language specific improvements</h2>
<!--
<ul>
  <li></li>
</ul>
-->

<!-- <h3 id="ada">Ada</h3> -->

<h3 id="c-family">C family</h3>
<ul>
  <li>GCC 6's C and C++ frontends were able to offer suggestions for
      misspelled field names:
      <blockquote><pre>
<b>spellcheck-fields.cc:52:13:</b> <span class="boldred">error:</span> <b>'struct s'</b> has no member named <b>'colour'</b>; did you mean <b>'color'</b>?
   return ptr-&gt;<span class="boldred">colour</span>;
               <span class="boldred">^~~~~~</span>
</pre></blockquote>
      GCC 7 greatly expands the scope of these suggestions.  Firstly, it
      adds fix-it hints to such suggestions:
<blockquote><pre>
<b>spellcheck-fields.cc:52:13:</b> <span class="boldred">error:</span> <b>'struct s'</b> has no member named <b>'colour'</b>; did you mean <b>'color'</b>?
   return ptr-&gt;<span class="boldred">colour</span>;
               <span class="boldred">^~~~~~</span>
               <span class="green">color</span>
</pre></blockquote>
      The suggestions now cover many other things, such as misspelled
      function names:
<blockquote><pre>
<b>spellcheck-identifiers.c:11:3:</b> <span class="boldmagenta">warning:</span> implicit declaration of function <b>'gtk_widget_showall'</b>; did you mean <b>'gtk_widget_show_all'</b>? [<span class="boldmagenta">-Wimplicit-function-declaration</span>]
   <span class="boldmagenta">gtk_widget_showall</span> (w);
   <span class="boldmagenta">^~~~~~~~~~~~~~~~~~</span>
   <span class="green">gtk_widget_show_all</span>
</pre></blockquote>
      misspelled macro names and enum values:
<blockquote><pre>
<b>spellcheck-identifiers.cc:85:11:</b> <span class="boldred">error:</span> <b>'MAX_ITEM'</b> undeclared here (not in a function); did you mean <b>'MAX_ITEMS'</b>?
 int array[<span class="boldred">MAX_ITEM</span>];
           <span class="boldred">^~~~~~~~</span>
           <span class="green">MAX_ITEMS</span>
</pre></blockquote>
      misspelled type names:
<blockquote><pre>
<b>spellcheck-typenames.c:7:14:</b> <span class="boldred">error:</span> unknown type name <b>'singed'</b>; did you mean <b>'signed'</b>?
 void test (<span class="boldred">singed</span> char e);
            <span class="boldred">^~~~~~</span>
            <span class="green">signed</span>
</pre></blockquote>
      and, in the C frontend, named initializers:
<blockquote><pre>
<b>test.c:7:20:</b> <span class="boldred">error:</span> <b>'struct s'</b> has no member named <b>'colour'</b>; did you mean <b>'color'</b>?
 struct s test = { .<span class="boldred">colour</span> = 3 };
                    <span class="boldred">^~~~~~</span>
                    <span class="green">color</span>
</pre></blockquote></li>
  <li>The preprocessor can now offer suggestions for misspelled
      directives, e.g.: 
<blockquote><pre>
<b>test.c:5:2:</b> <span class="boldred">error:</span>invalid preprocessing directive #endfi; did you mean #endif?
 #<span class="boldred">endfi</span>
  <span class="boldred">^~~~~</span>
  <span class="green">endif</span>
</pre></blockquote></li>
  <li>Warnings about format strings now underline the pertinent part of
    the string, and can offer suggested fixes.  In some cases, the
    pertinent argument is underlined.
<blockquote><pre>
<b>test.c:51:29:</b> <span class="boldmagenta">warning:</span> format <b>'%s'</b> expects argument of type <b>'char *'</b>, but argument 3 has type <b>'int'</b> [<span class="boldmagenta">-Wformat=</span>]
   printf ("foo: %d  bar: <span class="boldmagenta">%s</span> baz: %d", 100, <span class="boldmagenta">i + j</span>, 102);
                          <span class="boldmagenta">~^</span>                <span class="boldmagenta">~~~~~</span>
                          <span class="green">%d</span>
</pre></blockquote></li>
</ul>

<h3 id="c">C</h3>
<ul>
  <li><p>The C front end now supports type
  names <code>_Float<i>N</i></code> for floating-point types with IEEE
  interchange formats and <code>_Float<i>N</i>x</code> for
  floating-point types with IEEE extended formats.  These type names
  come from ISO/IEC TS 18661-3:2015.</p>
  <p>The set of types supported depends on the target for which GCC is
  configured.  Most targets
  support <code>_Float32</code>, <code>_Float32x</code>
  and <code>_Float64</code>.  <code>_Float128</code> is supported on
  targets where IEEE binary128 encoding was already supported
  as <code>long double</code>
  or <code>__float128</code>.  <code>_Float64x</code> is supported on
  targets where a type with either binary128 or Intel extended
  precision format is available.</p>
  <p>Constants with these types are supported using
  suffixes <code>f<i>N</i></code>, <code>F<i>N</i></code>,
  <code>f<i>N</i>x</code> and <code>F<i>N</i>x</code>
  (e.g., <code>1.2f128</code> or <code>2.3F64x</code>).  Macros such
  as <code>FLT128_MAX</code> are defined
  in <code>&lt;float.h&gt;</code>
  if <code>__STDC_WANT_IEC_60559_TYPES_EXT__</code> is defined before
  it is included.</p>
  <p>These new types are always distinct from each other and
  from <code>float</code>, <code>double</code> and <code>long
  double</code>, even if they have the same encoding.  Complex types
  such as <code>_Complex _Float128</code> are also supported.</p>
  <p>Type-generic built-in functions such
  as <code>__builtin_isinf</code> support the new types, and the
  following type-specific built-in functions have versions
  (suffixed <code>f<i>N</i></code> or <code>f<i>N</i>x</code>) for the
  new
  types: <code>__builtin_copysign</code>, <code>__builtin_fabs</code>, <code>__builtin_huge_val</code>, <code>__builtin_inf</code>, <code>__builtin_nan</code>, <code>__builtin_nans</code>.</p></li>
</ul>

<h3 id="cxx">C++</h3>
<ul>
  <li>The C++ frontend will now provide fix-it hints for some missing
    semicolons, allowing for automatic fixes by IDEs:
<blockquote><pre>
<b>test.cc:4:11:</b> <span class="boldred">error:</span> expected <b>';'</b> after class definition
 class a {} 
           <span class="boldred">^</span>
           <span class="green">;</span>
</pre></blockquote></li>
</ul>

<h4 id="libstdcxx">Runtime Library (libstdc++)</h4>
<ul>
  <li>Experimental support for C++17, including the following new features:
  <ul>
    <li>
      <code>std::string_view</code>;
    </li>
    <li>
      <code>std::any</code>, <code>std::optional</code>,
      and <code>std::variant</code>;
    </li>
    <li>
      <code>std::invoke</code>, <code>std::is_callable</code>,
      and <code>std::is_nothrow_callable</code>;
    </li>
    <li>
      <code>std::is_swappable</code>,
      and <code>std::is_nothrow_swappable</code>;
    </li>
    <li>
      <code>std::apply</code>,
      and <code>std::make_from_tuple</code>;
    </li>
    <li>
      <code>std::void_t</code>, <code>std::bool_constant</code>,
      <code>std::conjunction</code>, <code>std::disjunction</code>,
      and <code>std::negation</code>;
    </li>
    <li>Mathematical Special Functions;</li>
    <li>
      <code>std::chrono::floor</code>, <code>std::chrono::ceil</code>,
      <code>std::chrono::round</code>, and <code>std::chrono::abs</code>;
    </li>
    <li>
      <code>std::clamp</code>;
    </li>
    <li>
      <code>std::shared_ptr&lt;T&gt;::weak_type</code>,
      <code>std::enable_shared_from_this&lt;T&gt;::weak_from_this()</code>,
      and <code>std::owner_less&lt;void&gt;</code>;
    </li>
  </ul>
  Thanks to Daniel Kr&uuml;gler, Tim Shen, Edward Smith-Rowland, and Ville Voutilainen for
  work on the C++17 support.
  </li>
  <li>
    A new power-of-two rehashing policy for use with the
    <code>_Hashtable</code> internals, thanks to Fran&ccedil;ois Dumont.
  </li>
</ul>

<h3 id="fortran">Fortran</h3>
<ul>
  <li>Support for a number of legacy vendor extensions with new flags:</li>
  <li><ul>
    <li><code>-fdec-structure</code> - Support for DEC <code>STRUCTURE</code>
    and <code>UNION</code>.</li>
    <li><code>-fdec-intrinsic-ints</code> - Support for new integer intrinsics
    such as degree-valued trig functions (like <code>TAND</code>) and
    <code>COTAN</code>.</li>
    <li><code>-fdec</code> - Enable the <code>-fdec</code> family of
    extensions.</li>
  </ul></li>

  <li>New flag <code>-finit-derived</code> to control default initialization of
  derived-type variables.</li>

</ul>

<!-- <h3 id="go">Go</h3> -->

<!-- <h3 id="java">Java (GCJ)</h3> -->

<!-- .................................................................. -->
<h2 id="jit">libgccjit</h2>
<p>The libgccjit API gained support for marking calls as requiring
tail-call optimization via a new entrypoint:
<a href="https://gcc.gnu.org/onlinedocs/jit/topics/expressions.html#gcc_jit_rvalue_set_bool_require_tail_call">gcc_jit_rvalue_set_bool_require_tail_call</a>.</p>

<p>libgccjit performs numerous checks at the API boundary, but
if these succeed, it previously ignored errors and other diagnostics emitted
within the core of GCC, and treated the compile of a gcc_jit_context
as having succeeded.  As of GCC 7 it now ensures that if any diagnostics are
emitted, they are visible from the libgccjit API, and that the the context is
flagged as having failed.</p>

<!-- .................................................................. -->
<h2 id="targets">New Targets and Target Specific Improvements</h2>

<!-- <h3 id="aarch64">AArch64</h3> -->

<!-- <h3 id="arm">ARM</h3> -->

<h3 id="avr">AVR</h3>
<ul>
  <li>On the reduced Tiny cores, the <code>progmem</code>
    <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Variable-Attributes.html">variable
      attribute</a>
    is now properly supported.  Respective read-only variables are located
    in flash memory in section <code>.progmem.data</code>.  No special
    code is needed to access such variables; the compiler automatically
    adds an offset of <code>0x4000</code> to all addresses which is needed
    to access variables in flash memory.  As opposed to ordinary cores
    where it is sufficient to specify the <code>progmem</code> attribute
    with definitions, on the reduced Tiny cores the attribute has also to
    be specified with (external) declarations:
    <blockquote><pre>
extern const int array[] __attribute__((__progmem__));

int get_value2 (void)
{
  /* Access via addresses array + 0x4004 and array + 0x4005. */
  return array[2];
}

const int* get_address (unsigned idx)
{
  /* Returns array + 0x4000 + 2 * idx. */
  return &amp;array[idx];
}</pre></blockquote></li>
  <li>A new command line option <code>-Wmisspelled-isr</code> has been added.
    It can be used to turn off &mdash; or turn into errors &mdash;
    warnings that are reported for interrupt service routines (ISRs)
    which don't follow AVR-LibC's naming convention of prefixing
    ISR names with <code>__vector</code>.</li>
  <li><code>__builtin_avr_nops(n_nops)</code> is a new
    <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Built-in-Functions.html">built-in
      function</a>
    that inserts <code>n_nops</code> <code>NOP</code> instructions into
    the instruction stream. <code>n_nops</code> must be a value known at
    compile time.</li>
</ul>

<!-- <h3 id="hsa">Heterogeneous Systems Architecture</h3> -->

<!-- <h3 id="x86">IA-32/x86-64</h3> -->

<!-- <h3 id="mips">MIPS</h3> -->

<!-- <h3 id="mep">MeP</h3> -->

<!-- <h3 id="msp430">MSP430</h3> -->

<!-- <h3 id="nds32">NDS32</h3> -->

<h3 id="powerpc">PowerPC / PowerPC64 / RS6000</h3>
<ul>
  <li>The PowerPC port now uses LRA by default.</li>
</ul>

<!-- <h3 id="s390">S/390, System z, IBM z Systems</h3> -->

<!-- <h3 id="rx">RX</h3> -->

<!-- <h3 id="sh">SH</h3> -->

<!-- <h3 id="sparc">SPARC</h3> -->

<!-- .................................................................. -->
<h2 id="os">Operating Systems</h2>

<!-- <h3 id="aix">AIX</h3> -->

<!-- <h3 id="dragonfly">DragonFly BSD</h3> -->

<!-- <h3 id="freebsd">FreeBSD</h3> -->

<!-- <h3 id="linux">Linux</h3> -->

<!-- <h3 id="rtems">RTEMS</h3> -->

<!-- <h3 id="solaris">Solaris</h3> -->

<!-- <h3 id="vxmils">VxWorks MILS</h3> -->

<!-- <h3 id="windows">Windows</h3> -->

<!-- .................................................................. -->
<!-- <h2>Documentation improvements</h2> -->

<!-- .................................................................. -->
<h2>Other significant improvements</h2>
<ul>
  <li><code>-fverbose-asm</code> previously emitted information on the
    meanings of assembly expressions.  This has been extended so that
    it now also prints comments showing the source lines that correspond
    to the assembly, making it easier to read the generated assembly
    (especially with larger functions).
    For example, given this C source file:
<blockquote><pre>
int test (int n)
{
  int i;
  int total = 0;

  for (i = 0; i &lt; n; i++)
    total += i * i;
  return total;
}
</pre></blockquote>
      <code>-fverbose-asm</code> now gives output similar to this for
      the function body (when compiling for x86_64, with
      <code>-Os</code>):
<blockquote><pre>
       .text
       .globl  test
       .type   test, @@function
test:
.LFB0:
       .cfi_startproc
# example.c:4:   int total = 0;
       xorl    %eax, %eax      # &lt;retval&gt;
# example.c:6:   for (i = 0; i &lt; n; i++)
       xorl    %edx, %edx      # i
.L2:
# example.c:6:   for (i = 0; i &lt; n; i++)
       cmpl    %edi, %edx      # n, i
       jge     .L5     #,
# example.c:7:     total += i * i;
       movl    %edx, %ecx      # i, tmp92
       imull   %edx, %ecx      # i, tmp92
# example.c:6:   for (i = 0; i &lt; n; i++)
       incl    %edx    # i
# example.c:7:     total += i * i;
       addl    %ecx, %eax      # tmp92, &lt;retval&gt;
       jmp     .L2     #
.L5:
# example.c:10: }
       ret
       .cfi_endproc
</pre></blockquote></li>
  <li>A new option <code>-fdiagnostics-parseable-fixits</code> allows for
    fix-it hints to be emitted in a machine-readable form, suitable for
    consumption by IDEs.  For example, given:
<blockquote><pre>
<b>spellcheck-fields.cc:52:13:</b> <span class="boldred">error:</span> <b>'struct s'</b> has no member named <b>'colour'</b>; did you mean <b>'color'</b>?
   return ptr-&gt;<span class="boldred">colour</span>;
               <span class="boldred">^~~~~~</span>
               <span class="green">color</span>
</pre></blockquote>
it will emit:
<blockquote><pre>
fix-it:"spellcheck-fields.cc":{52:13-52:19}:"color"
</pre></blockquote></li>
  <li>The <code>gcc</code> and <code>g++</code> driver programs will now
    provide suggestions for misspelled arguments to command-line options.
<blockquote><pre>
$ gcc -c test.c -ftls-model=global-dinamic
gcc: <span class="boldred">error:</span> unknown TLS model <b>'global-dinamic'</b>
gcc: <span class="boldcyan">note:</span> valid arguments to <b>'-ftls-model='</b> are: global-dynamic initial-exec local-dynamic local-exec; did you mean <b>'global-dynamic'</b>?
</pre></blockquote></li>
  <li>The compiler will now provide suggestions for misspelled parameters.
<blockquote><pre>
$ gcc -c test.c --param max-early-inliner-iteration=3 
cc1: <span class="boldred">error:</span> invalid --param name <b>'max-early-inliner-iteration'</b>; did you mean <b>'max-early-inliner-iterations'</b>?
</pre></blockquote></li>

  <li>GCC has gained an internal unit-testing framework, allowing for
    more detailed testing of its implementation details.</li>
</ul>

<!-- <h2><a name="7.1">GCC 7.1</a></h2>

<p>This is the <a href="https://gcc.gnu.org/bugzilla/buglist.cgi?bug_status=RESOLVED&amp;resolution=FIXED&amp;target_milestone=7.1">list
of problem reports (PRs)</a> from GCC's bug tracking system that are
known to be fixed in the 7.1 release. This list might not be
complete (that is, it is possible that some PRs that have been fixed
are not listed here).</p>
-->

</body>
</html>
