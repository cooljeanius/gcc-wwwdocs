<html>

<head>
<title>GCC 5 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 5 Release Series<br />Changes, New Features, and Fixes</h1>


<h2>Caveats</h2>
  <ul>
    <li>The default mode for C is now <code>-std=gnu11</code> instead of
        <code>-std=gnu89</code>.</li>
    <li>The Graphite framework for loop optimizations no longer requires the
	CLooG library, only ISL version 0.14 (recommended) or 0.12.2.  The
        installation manual contains more information about requirements to
        build GCC.</li>
  </ul>

<h2 id="general">General Optimizer Improvements</h2>

  <ul>
    <li>Inter-procedural optimization improvements:
    <ul>
     <li>Devirtualization pass was significantly improved by adding
	 better support for speculative devirtualization and dynamic type
	 detection. About 50% of virtual calls in Firefox are speculatively
	 devirtualized during link-time optimization.</li>
     <li>New comdat localization pass lets linker to eliminate more dead code
	 in presence of C++ inline functions.</li>
     <li>Virtual tables are now optimized. Local aliases are used to reduce
	 dynamic linking time of C++ virtual tables on ELF targets and
	 data alignment has been reduced to limit data segment bloat.</li>
     <li>New <code>-fno-semantic-interposition</code> flag can be used
	 to improve code quality of shared libraries where interposition of
	 exported symbols is not allowed.</li>
     <li>Write-only variables are now detected and optimized out.</li>
     <li>With profile feedback the function inliner can now bypass
	 <code>--param inline-insns-auto</code> and <code>--param
	 inline-insns-single</code> limits for hot calls.</li>
     <li>IPA reference pass was significantly sped up making it feasible
	 to enable <code>-fipa-reference</code> with
	 <code>-fprofile-generate</code>. This also solves a bottleneck
	 seen when building Chromium with link time optimization.</li>
     <li>Symbol table and call-graph API was reworked to C++ and
	 simplified.</li>
    </ul></li>
    <li>Link-time optimization improvements:
    <ul>
      <li>New One Definition Rule based merging of C++ types implemented.
	  Type merging enables better devirtualization and alias analysis.
	  Streaming extra information needed to merge types adds about 2-6% of
	  memory size and object size increase. This can be controlled by
	  <code>-flto-odr-type-merging</code>.</li>
      <li>GCC bootstrap now use slim LTO object files.</li>
      <li>Memory usage and link times was improved.  Tree merging was sped up,
	  memory usage of GIMPLE declarations and types was reduced, and,
	  support for on-demand streaming of variable constructors was added.</li>
    </ul></li>
    <li>Feedback directed optimization improvements:
    <ul>
      <li>Profile precision was improved in presence of C++ inline and extern
	  inline functions.</li>
      <li>New <code>gcov-tool</code> to manipulate profiles.</li>
      <li>Profile is now more tolerant to source file changes (this can be
	  controlled by <code>--param profile-func-internal-id</code>).</li>
    </ul></li>
    <li>UndefinedBehaviorSanitizer gained a few new sanitization options:
    <ul>
      <li><code>-fsanitize=float-divide-by-zero</code>: detect floating-point
	   division by zero;</li>
      <li><code>-fsanitize=float-cast-overflow</code>: check that the result
	   of floating-point type to integer conversions do not overflow;</li>
      <li><code>-fsanitize=bounds</code>: enable instrumentation of array
	  bounds and detect out-of-bounds accesses;</li>
      <li><code>-fsanitize=alignment</code>: enable alignment checking, detect
	  various misaligned objects;</li>
      <li><code>-fsanitize=object-size</code>: enable object size checking, detect
	  various out-of-bounds accesses.</li>
    </ul>
    </li>
  </ul>

<h2 id="languages">New Languages and Language specific improvements</h2>

<!-- h3 id="ada">Ada</h3 -->

<h3 id="c-family">C family</h3>
  <ul>
    <li>The default setting of the <code>-fdiagnostics-color=</code>
        option is now
        configurable <a href="https://gcc.gnu.org/install/configure.html">when
        building GCC</a> using configuration
        option <code>--with-diagnostics-color=</code>. The possible
        values
        are: <code>never</code>, <code>always</code>, <code>auto</code>
        and <code>auto-if-env</code>.  The new
        default <code>auto</code> means to use color only when the
        standard error is a terminal.  The default in GCC 4.9
        was <code>auto-if-env</code>, which defaults to
        <code>auto</code> if there is a
        non-empty <code>GCC_COLORS</code> environment variable,
        and <code>never</code> otherwise.  As in GCC 4.9, an empty
        <code>GCC_COLORS</code> variable in the environment will
        always disable colors, no matter what the default is or what
        command line options are used.</li>
    <li>A new command-line option <code>-Wswitch-bool</code> has been added for
	the C and C++ compilers, which warns whenever a <code>switch</code>
	statement has an index of boolean type.</li>
    <li>A new command-line option <code>-Wlogical-not-parentheses</code> has
	been added for the C and C++ compilers, which warns about "logical not"
	used on the left hand side operand of a comparison.</li>
    <li>A new command-line option <code>-Wsizeof-array-argument</code> has been
	added for the C and C++ compilers, which warns when the
	<code>sizeof</code> operator is applied to a parameter that has been
	declared as an array in a function definition.</li>
    <li>A new command-line option <code>-Wbool-compare</code> has been added
	for the C and C++ compilers, which warns about boolean expressions
	compared with an integer value different from
	<code>true</code>/<code>false</code>.</li>
    <li>Full support for <a href="https://www.cilkplus.org/">Cilk Plus</a>
	has been added to the GCC compiler. Cilk Plus is an extension to
	the C and C++ languages to support data and task parallelism.</li>
    <li>New attribute <code>no_reorder</code> prevents reordering of selected symbols
	against other such symbols or inline assembler.
	This enables to link-time optimize Linux kernel without need to use
	<code>-fno-toplevel-reorder</code> that disable several optimizations.</li>
    <li>New preprocessor constructs, <code>__has_include</code>
        and <code>__has_include_next</code>, to test the availability of headers
        have been added.<br/>
        This demonstrates a way to include the header <code>&lt;optional&gt;</code>
        only if it is available:<br/>
<blockquote><pre>
#ifdef __has_include
#  if __has_include(&lt;optional&gt;)
#    include &lt;optional&gt;
#    define have_optional 1
#  elif __has_include(&lt;experimental/optional&gt;)
#    include &lt;experimental/optional&gt;
#    define have_optional 1
#    define experimental_optional
#  else
#    define have_optional 0
#  endif
#endif
</pre></blockquote>
        The header search paths for <code>__has_include_next</code>
        and <code>__has_include_next</code> are equivalent to those
        of the standard directive <code>#include</code>
        and the extension <code>#include_next</code> respectively.
    </li>
    <li>A new set of built-in functions for arithmetics with overflow checking
	has been added: <code>__builtin_add_overflow</code>,
	<code>__builtin_sub_overflow</code> and <code>__builtin_mul_overflow</code>
	and for compatibility with clang also other variants.
	These builtins have two integral arguments (which don't need to have
	the same type), the arguments are extended to infinite precision
	signed type, <code>+</code>, <code>-</code> or <code>*</code>
	is performed on those, and the result is stored in an integer
	variable pointed to by the last argument.  If the stored value is
	equal to the infinite precision result, the built-in functions return
	<code>false</code>, otherwise <code>true</code>.  The type of
	the integer variable that will hold the result can be different from
	the types of the first two arguments.  The following snippet
	demonstrates how this can be used in computing the size for the
	<code>calloc</code> function:
<blockquote><pre>
void *
calloc (size_t x, size_t y)
{
  size_t sz;
  if (__builtin_mul_overflow (x, y, &amp;sz))
    return NULL;
  void *ret = malloc (sz);
  if (ret) memset (res, 0, sz);
  return ret;
}
</pre></blockquote>
	On e.g. i?86 or x86-64 the above will result in a <code>mul</code>
	instruction followed by a jump on overflow.
    </li>
    <li>The option <code>-fextended-identifiers</code> is now enabled
	by default for C++, and for C99 and later C versions.  Various
	bugs in the implementation of extended identifiers have been
	fixed.</li>
  </ul>

<h3 id="c">C</h3>
  <ul>
    <li>The default mode has been changed to <code>-std=gnu11</code>.</li>
    <li>A new command-line option <code>-Wc90-c99-compat</code> has been added
	to warn about features not present in ISO C90, but present in ISO
	C99.</li>
    <li>A new command-line option <code>-Wc99-c11-compat</code> has been added
	to warn about features not present in ISO C99, but present in ISO
	C11.</li>
    <li>It is possible to disable warnings about conversions between pointers
	that have incompatible types via a new warning option
	<code>-Wno-incompatible-pointer-types</code>; warnings about implicit
	incompatible integer to pointer and pointer to integer conversions via
	a new warning option <code>-Wno-int-conversion</code>; and warnings
	about qualifiers on pointers being discarded via a new warning option
	<code>-Wno-discarded-qualifiers</code>.</li>
    <li>The C front end now generates more precise caret diagnostics.</li>
    <li>The -pg option now only affects the current file in a LTO build.</li>
  </ul>

<h3 id="cxx">C++</h3>
<ul>
  <li>G++ now supports <a href="../projects/cxx1y.html">C++14</a> variable
  templates.</li>
  <li><code>-Wnon-virtual-dtor</code> doesn't warn anymore
  for <code>final</code> classes.</li>
  <li>Excessive template instantiation depth is now a fatal error. This
  prevents excessive diagnostics that usually do not help to identify the
  problem.</li>
  <li>G++ and libstdc++ now implement the feature-testing macros from
    <a href="http://isocpp.org/std/standing-documents/sd-6-sg10-feature-test-recommendations">Feature-testing
    recommendations for C++</a>.</li>
  <li>G++ now allows <code>typename</code> in a template template parameter.
    <blockquote><pre>
template&lt;template&lt;typename&gt; <b>typename</b> X&gt; struct D; // OK</pre></blockquote>
  </li>
  <li>G++ now supports <a href="../projects/cxx1y.html">C++14</a> aggregates with non-static data member initializers.
    <blockquote><pre>
struct A { int i, j = i; };
A a = { 42 }; // a.j is also 42</pre></blockquote>
  </li>
  <li>G++ now supports <a href="../projects/cxx1y.html">C++14</a> extended <code>constexpr</code>.
    <blockquote><pre>
constexpr int f (int i)
{
  int j = 0;
  for (; i > 0; --i)
    ++j;
  return j;
}

constexpr int i = f(42); // i is 42</pre></blockquote>
  </li>
  <li>G++ now supports the <a href="../projects/cxx1y.html">C++14</a> sized
  deallocation functions.
    <blockquote><pre>
void operator delete (void *, std::size_t) noexcept;
void operator delete[] (void *, std::size_t) noexcept;</pre></blockquote>
  </li>
  <li>New One Definition Rule violation warning (controlled by <code>-Wodr</code>)
      detects mismatches in type definitions and virtual table contents
      during link-time optimization.</li>
  <li>New warnings <code>-Wsuggest-final-types</code> and
      <code>-Wsuggest-final-methods</code> helps developers
      to annotate programs by <code>final</code> specifiers (or anonymous
      namespaces) in the cases where code generation improves.
      These warnings can be used at compile time, but they are more
      useful in combination with link-time optimization.</li>
<li>G++ no longer supports
  <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3639.html">N3639</a>
  variable length arrays, as they were removed from the C++14 working paper
  prior to ratification.  GNU VLAs are still supported, so VLA support is
  now the same in C++14 mode as in C++98 and C++11 modes.</li>
</ul>

  <h4 id="libstdcxx">Runtime Library (libstdc++)</h4>
  <ul>
    <li> A new implementation of <code>std::list</code> is enabled by default,
        with an O(1) <code>size()</code> function; </li>
    <li><a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/status.html#status.iso.2011">
      Improved support for C++11</a>, including:
      <ul>
        <li> <code>std::deque</code> and <code>std::vector&lt;bool&gt;</code>
             meet the allocator-aware container requirements;</li>
        <li> movable and swappable iostream classes;</li>
        <li> support for <code>std::align</code> and
             <code>std::aligned_union</code>;</li>
        <li> type traits <code>std::is_trivially_copyable</code>,
             <code>std::is_trivially_constructible</code>,
             <code>std::is_trivially_assignable</code> etc.;
        </li>
        <li> I/O manipulators <code>std::put_time</code>,
             <code>std::hexfloat</code> and <code>std::defaultfloat</code>;
        </li>
        <li> generic locale-aware <code>std::isblank</code>; </li>
        <li> atomic operations for <code>std::shared_ptr</code>; </li>
        <li> <code>std::notify_all_at_thread_exit()</code> and functions
          for making futures ready at thread exit; </li>
      </ul>
    </li>
    <li> Support for the C++11 <code>hexfloat</code> manipulator changes how
      the <code>num_put</code> facet formats floating point types when
      <code>ios_base::fixed|ios_base::scientific</code> is set in a stream's
      <code>fmtflags</code>. This change affects all language modes, even
      though the C++98 standard gave no special meaning to that combination
      of flags. To prevent the use of hexadecimal notation for floating point
      types use <code>str.unsetf(std::ios_base::floatfield)</code> to clear
      the relevant bits in <code>str.flags()</code>.
    </li>
    <li><a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/status.html#status.iso.2014">
      Improved experimental support for C++14</a>, including:
      <ul>
        <li> <code>std::is_final</code> type trait; </li>
      </ul>
    </li>
    <li><a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/status.html#status.iso.2014">
      Improved experimental support for the Library Fundamentals TS</a>, including:
      <ul>
        <li> class <code>std::experimental::any</code>; </li>
        <li> function template <code>std::experimental::apply</code>; </li>
        <li> function template <code>std::experimental::sample</code>; </li>
        <li> function template <code>std::experimental::search</code> and
          related searcher types; </li>
        <li> variable templates for type traits; </li>
        <li> function template <code>std::experimental::not_fn</code>; </li>
      </ul>
    </li>
    <li>New random number distributions <code>logistic_distribution</code> and
      <code>uniform_on_sphere_distribution</code> as extensions.</li>
    <li><a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Xmethods-In-Python.html">GDB
      Xmethods</a> for Sequence Containers and <code>std::unique_ptr</code>;</li>
  </ul>

<h3 id="fortran">Fortran</h3>
  <ul>
    <li>Incomplete support for colorizing diagnostics emitted by
      gfortran has been added. The
      option <code><a href="https://gcc.gnu.org/onlinedocs/gcc/Language-Independent-Options.html"
      >-fdiagnostics-color</a></code> controls when color is used in
      diagnostics. The default value of this option can
      be <a href="https://gcc.gnu.org/install/configure.html">configured
      when building GCC</a>. The <code>GCC_COLORS</code> environment
      variable can be used to customize the colors or disable coloring
      completely. Sample diagnostics output:<br/>
      <pre>
      $ gfortran -fdiagnostics-color=always -Wuse-without-only test.f90
      <b>test.f90:6:1:</b>

       0 continue
       <b style='color:lime'>1</b>
      <b style='color:red'>Error:</b> Zero is not a valid statement label at (1)    
      <b>test.f90:9:6:</b>

         USE foo
            <b style='color:lime'>1</b>
      <b style='color:magenta'>Warning:</b> USE statement at (1) has no ONLY qualifier [-Wuse-without-only]
    </pre></li>

    <li>The <code>-Wuse-without-only</code> option has been added to warn when a
      <code>USE</code> statement has no <code>ONLY</code> qualifier and, thus,
      implicitly imports all public entities of the used module.</li>
    <li><a href="https://gcc.gnu.org/wiki/Fortran2003Status">Fortran 2003</a>:
    <ul>
      <li>The intrinsic IEEE modules (<code>IEEE_FEATURES</code>,
	<code>IEEE_EXCEPTIONS</code> and <code>IEEE_ARITHMETIC</code>) are
	now supported.</li>
    </ul></li>
    <li><a href="https://gcc.gnu.org/wiki/Fortran2008Status">Fortran 2008</a>:
    <ul>
      <li><a href="https://gcc.gnu.org/wiki/Coarray">Coarrays</a>: Full
	experimental support of Fortran 2008's coarrays with
	<code>-fcoarray=lib</code> except for locking and allocatable/pointer
	components of derived-type coarrays.  GCC currently only ships with a
	single-image library (<code>libcaf_single</code>), but
	multi-image support based on MPI and GASNet is provided by the libraries
	of the <a href="http://www.opencoarrays.org/">OpenCoarrays project</a>. 
	</li>
    </ul></li>
    <li>TS18508 Additional Parallel Features in Fortran:
    <ul>
      <li>Support for the collective intrinsic subroutines <code>CO_MAX</code>,
	<code>CO_MIN</code>, <code>CO_SUM</code>, <code>CO_BROADCAST</code> and
	<code>CO_REDUCE</code>has been added, including
	including <code>-fcoarray=lib</code> support.</li>
      <li>Support for the new atomic intrinsics has been added, including
	<code>-fcoarray=lib</code> support.</li>
    </ul></li>
    <li>Fortran 2015:
    <ul>
      <li>Support for <code>IMPLICIT NONE (external, type)</code>.</li>
      <li><code>ERROR STOP</code> is now permitted in pure procedures.</li>
    </ul></li>
  </ul>

<!-- h3 id="go">Go</h3 -->
<!--h3 id="java">Java (GCJ)</h3-->

<h2 id="targets">New Targets and Target Specific Improvements</h2>

<h3 id="aarch64">AArch64</h3>
   <ul>
     <li> A workaround for the ARM Cortex-A53 erratum 835769 has been
       added and can be enabled by giving the
       <code>-mfix-cortex-a53-835769</code> option.
       Alternatively it can be enabled by default by configuring GCC with the
       <code>--enable-fix-cortex-a53-835769</code> option.
     </li>
     <li> The optional cryptographic extensions to the ARMv8-A architecture
       are no longer enabled by default when specifying the
       <code>-mcpu=cortex-a53</code>, <code>-mcpu=cortex-a57</code> or
       <code>-mcpu=cortex-a57.cortex-a53</code> options.  To enable these
       extensions add <code>+crypto</code> to the value of
       <code>-mcpu</code> or <code>-march</code> e.g.
       <code>-mcpu=cortex-a53+crypto</code>.
     </li>
     <li>Support for the Cavium ThunderX processor is now available through the
    <code>-mcpu=thunderx</code> and <code>-mtune=thunderx</code> options.
     </li>

   </ul>

<h3 id="arm">ARM</h3>
     <ul>
      <li> The Thumb-1 assembly code is now generated in unified syntax. The new option
        <code>-masm-syntax-unified</code> can be used to specify whether inline assembly
        code is using unified syntax. By default the option is off which means
        non-unified syntax is used. However this is subject to change in future releases.
        Eventually the non-unified syntax will be deprecated.
      </li>
      <li> It is now a configure-time error to use the <code>--with-cpu</code>
      configure option with either of <code>--with-tune</code> or
      <code>--with-arch</code>.
      </li>
      <li> Support for the Cortex-A17 processor has been added through the
      <code>-mcpu=cortex-a17</code> and <code>-mtune=cortex-a17</code> options.
      </li>
      <li> Support for the Cortex-M7 processor has been added through the
      <code>-mcpu=cortex-m7</code> and <code>-mtune=cortex-m7</code> options.
      </li>
      <li> Initial big.LITTLE tuning support for the combination of Cortex-A17
       and Cortex-A7 has been added through the
       <code>-mcpu=cortex-a17.cortex-a7 </code> and
       <code>-mtune=cortex-a17.cortex-a7</code> options.
      </li>
      <li> The deprecated option <code>-mwords-little-endian</code>
       has been removed.
      </li>

     </ul>

<h3 id="x86">IA-32/x86-64</h3>
  <ul>
	<li>The new <code>-mrecord-mcount</code> option for <code>-pg</code>
	generates a Linux kernel style table of pointers to mcount or
	__fentry__ calls at the beginning of functions. The new
	<code>-mnop-mcount</code> option in addition also generates nops in
	place of the __fentry__ or mcount call, so that a call per function
	can be later patched in. This can be used for low overhead tracing or
	hot code patching.</li>
	<li> The new <code>-malign-data=</code> option controls to how
	GCC aligns variables.  <code>-malign-data=compat</code> uses
	increased alignment value compatible with GCC 4.8 and earlier,
	<code>-malign-data=abi</code> uses alignment value as specified by
	the psABI, and <code>-malign-data=cacheline</code> uses increased
	alignment value to match the cache line size.
	<code>-malign-data=compat</code> is the default.</li>
	<li>The new <code>-mskip-rax-setup</code> option skips setting
	up the RAX register when SSE is disabled and there are no variable
	arguments passed in vector registers.  This can be used to
	optimize the Linux kernel.</li>
  </ul>

<h3 id="sh">SH</h3>
  <ul>
    <li>The compiler will now pass the appropriate <code>--isa=</code> option
    to the assembler.</li>

    <li>The default handling for the <code>GBR</code> has been changed from
    call clobbered to call preserved.  The old behavior can be reinstated by
    specifying the option <code>-fcall-used-gbr</code>.</li>

    <li>Support for the SH4A <code>fpchg</code> instruction has been added which
    will be utilized when switching between single and double precision FPU
    modes.</li>

    <li>The compiler no longer uses the <code>__fpscr_values</code> array for
    switching between single and double FPU precision modes on non-SH4A targets.
    Instead mode switching will now be performed by storing, modifying and
    reloading the <code>FPSCR</code>, so that other <code>FPSCR</code> bits are
    preserved across mode switches.   The <code>__fpscr_values</code> array that
    is defined in libgcc is still present for backwards compatibility, but it
    will not be referenced by compiler generated code anymore.</li>

    <li>New builtin functions <code>__builtin_sh_get_fpscr</code> and
    <code>__builtin_sh_set_fpscr</code> have been added.  The
    <code>__builtin_sh_set_fpscr</code> function will mask the specified bits
    in such a way that the <code>SZ</code>, <code>PR</code> and <code>FR</code>
    mode bits will be preserved, while changing the other bits.  These new
    functions do not reference the <code>__fpscr_values</code> array.  The old
    functions <code>__set_fpscr</code> and <code>__get_fpscr</code> in libgcc
    which access the <code>__fpscr_values</code> array are still present for
    backwards compatibility, but their usage is highly discouraged.</li>
  </ul>

<h2 id="os">Operating Systems</h2>

  <h3 id="dragonfly">DragonFly BSD</h3>

  <ul>
    <li>GCC now supports the DragonFly BSD operating system.</li>
  </ul>

<!-- h2>Documentation improvements</h2-->
<h2>Other significant improvements</h2>
  <h3 id="gcc-ar"></h3>
  <ul>
    <li>The <code>gcc-ar, gcc-nm, gcc-ranlib</code> wrappers now
	understand a <code>-B</code> option to set the compiler to use.</li>
  </ul>
</body>
</html>
