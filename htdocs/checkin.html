<html>
<head>
<title>Checking in changes to egcs </title>
</head>
<body bgcolor="white">
<h1 align="center">Checking in changes to egcs </h1>

<p>This page is meant to give a very brief outline of the policies and
procedures for checking in files to egcs for those folks with write
access to the repository.

<hr>
<h2>Write access policies</h2>
<p>The egcs project grants some developers various levels of write access
to the egcs master sources.  CVS doesn't provide fine grained control over
access to the repository; therefore, we depend on each developer to follow
follow the appropriate policies.

<p> Also note that the glibc project also has its sources on egcs.cygnus.com;
under no circumstances should people commit changes into glibc.  Similarly
for the guile project which keeps a mirror of their cvs repository on the
egcs machine.

<ul>
  <li>Global write permission.  A very limited number of developers have
  global write permission over the entire repostiory.  This is unfortunately
  necessary because we don't have explicit maintainers for every little
  piece of the compiler.

  <li>Localized write permission.  This is for people who own ports, front
  ends, or significant hunks of code in the compiler.  These folks are
  allowed to make changes in code they maintain without going through any
  kind of approval process.

  <li>Write after approval.  This is folks that make regular contributions,
  but who do not "own" any particular piece of code.  People with write after
  approval need to submit their patches to the list; once the patches have
  been approved by the appropriate maintainers the patches may be checked into
  the egcs sources.
</ul>

<p>The list of folks with write access to the repository can be found in the
<tt>MAINTAINERS</tt> file in the egcs distribution.
<hr>

<p>Also note that fixes for obvious typos in ChangeLog files, docs, web
pages, comments and similar stuff need not be approved.  Just check in the
fix.  We don't want to get overly anal about checkin policies.

<h2>Checking in a change</h2>

<p>This is meant to provide a very quick overview of how to check in a
change.  It is not meant to be a replacement for the CVS manual but 
instead a supplement.  The CVS manual is distributed as part of the CVS
sources as a texinfo file.
<a href="http://www.cyclic.com/cvs/doc-blandy.html"> 
http://www.cyclic.com/cvs/doc-blandy.html</a> contains
a link to an reasonably simple introduction to CVS.

<p> In all the commands listed below, you can give an explicit list of
filenames to the cvs command.  We recommend you list files explicitly
when performing checkins to avoid accidental checkins of local code.

<p> Sync your sources with the master repository via "<tt>cvs update</tt>"
before attempting a checkin; this will save you a little time if someone
else has modified that file since the last time you sync'd your sources.
It will also identify any files in your local tree that you have modified.

<p>Apply the patch to your local tree and update the <tt>ChangeLog</tt>
file.  Use the current date/time for the <tt>ChangeLog</tt> entry, not
the time that the patch was submitted.  Note in the "<tt>gcc/f</tt>" and
"<tt>libf2c</tt>" directories you should modifify <tt>ChangeLog.egcs</tt>
instead of <tt>ChangeLog</tt>.

<p>Make sure to rebuild any generated files that would be effected by
the patch.  Make sure to check them in along with the files explicitly
modified by the patch.

<p>We recommend using "<tt>cvs diff</tt>" after applying a patch to
a local tree.  Review the output to make sure that only the changes
you wanted to check in will be checked in.  Also check to see if the
copyright dates need to be updated.

<p>Use "<tt>cvs commit</tt>" to check in the patch.  You can enter the
log message via the "<tt>-m</tt>" argument to commit, or wait for the
editor window to appear and enter the log message in the editor window.

<p>After exiting the editor, CVS will connect to the egcs cvs server and
check in your changes.  When your prompt returns the checkin is finished.
A message will be sent to the "<tt>egcs-cvs</tt>" mailing list (when
set up) indicating that a change was made.  CVS will provide a message
if an error occurs and it will not check in any files.

<hr>
<h2> Example check-in session </h2>

<p>Here's an actual check-in session for a patch John Carr recently sent
to the egcs list.  This was the <tt>ChangeLog</tt> for his change:

<blockquote>
<pre>
Sun Feb  8 08:02:13 1998  John Carr  &lt;jfc@mit.edu>

   * bitmap.c (bitmap_debug_file): HOST_PTR_PRINTF converts a pointer,
   not a HOST_WIDE_INT.

   * calls.c (expand_call): Change test of expand_inline_function
   return value to stop compiler warning.

   * genattrtab.c (RTL_HASH): Cast pointer to long, not HOST_WIDE_INT.
</pre>
</blockquote>

<h3>First, I sync my local respository.</h3>

<blockquote>
<pre>
[/law/egcs/egcs] cvs update
? libobjc
? gcc/.ada
? gcc/jump.c.SAVE
? gcc/loop.c.SAVE
M MAINTAINERS
M Makefile.in
M gcc/loop.c
M gcc/cp/parse.c
M gcc/objc/Make-lang.in
M gcc/objc/Makefile.in
</pre>
</blockquote>

<p>The question marks indicate files in my local repository that are not
part of the official sources.  The "M" indicates files I've changed locally
for some unrelated work -- thus I have to be careful to avoid checking
them in.  A "U" would have indicated a file that CVS updated because my
local copy was out of date relative to the master sources.

<p>The local repository is now up to date.

<h3>Apply the patch to the local source</h3>

<blockquote>
<pre>
[/law/egcs/egcs/gcc] patch < ~/Mail/gcc/pendingpatches/42 
Hmm...  Looks like a new-style context diff to me...
The text leading up to this was:
<i>[ uninteresting text deleted ]</i>
|*** bitmap.c.egcs      Sat Dec 20 06:31:11 1997
|--- bitmap.c   Sun Feb  8 08:01:32 1998
--------------------------
Patching file bitmap.c using Plan A...
Hunk #1 succeeded at 563.
Hunk #2 succeeded at 573.
Hmm...  The next patch looks like a new-style context diff to me...
The text leading up to this was:
--------------------------
|*** calls.c.egcs       Sun Feb  8 07:44:02 1998
|--- calls.c    Sun Feb  8 08:00:08 1998
--------------------------
Patching file calls.c using Plan A...
Hunk #1 succeeded at 730.
Hmm...  The next patch looks like a new-style context diff to me...
The text leading up to this was:
--------------------------
|*** genattrtab.c.egcs  Sun Feb  8 07:44:04 1998
|--- genattrtab.c       Sun Feb  8 08:05:36 1998
--------------------------
Patching file genattrtab.c using Plan A...
Hunk #1 succeeded at 506.
done
</pre>
</blockquote>

<h3>Add ChangeLog entry by hand</h3>

<p><tt>ChangeLog</tt> entries should be handled as straight text;
patches against <tt>ChangeLog</tt>s rarely apply correctly.

<blockquote>
<pre>
[/law/egcs/egcs/gcc] vi ChangeLog
</pre>
</blockquote>

<h3>Review changes for correctness</h3>

<p>The patch and its associated <tt>ChangeLog</tt> entry are in my
local tree; now I run <tt>cvs diff</tt> on the modified files and review
the output.

<blockquote>
<pre>
[/law/egcs/egcs/gcc] cvs diff -c3p bitmap.c calls.c genattrtab.c > /tmp/FOO
</pre>
</blockquote>

<p>Look at <tt>/tmp/FOO</tt> and verify that only the changes we want
are in the diff file.

<h3>Update Copyrights</h3>

<p>Review the changed files to see if any copyrights need updating,
in this particular case all three needed their copyrights updated.

<blockquote>
<pre>
[/law/egcs/egcs/gcc] vi bitmap.c calls.c genattrtab.c
</pre>
</blockquote>

<h3>Commit the changes to the central repository</h3>

<blockquote>
<pre>
[/law/egcs/egcs/gcc] cvs commit ChangeLog bitmap.c calls.c genattrtab.c
</pre>
</blockquote>

<p>My editor starts and I enter the log message; the lines starting with
<TT>CVS:</TT> are automatically added by CVS and will be automatically
removed:

<blockquote>
<pre>
        * bitmap.c (bitmap_debug_file): HOST_PTR_PRINTF converts a pointer,
        not a HOST_WIDE_INT.

        * calls.c (expand_call): Change test of expand_inline_function
        return value to stop compiler warning.

        * genattrtab.c (RTL_HASH): Cast pointer to long, not HOST_WIDE_INT.

CVS: ----------------------------------------------------------------------
CVS: Enter Log.  Lines beginning with `CVS:' are removed automatically
CVS:
CVS: Committing in .
CVS:
CVS: Modified Files:
CVS:    ChangeLog bitmap.c calls.c genattrtab.c
CVS: ----------------------------------------------------------------------
</pre>
</blockquote>

<p>Now write &amp; quit from the editor, and CVS will start the actual
checkin process....

<blockquote>
<pre>
Checking in ChangeLog;
/egcs/carton/cvsfiles/egcs/./gcc/ChangeLog,v  <--  ChangeLog
new revision: 1.746; previous revision: 1.745
done
Checking in bitmap.c;
/egcs/carton/cvsfiles/egcs/./gcc/bitmap.c,v  <--  bitmap.c
new revision: 1.6; previous revision: 1.5
done
Checking in calls.c;
/egcs/carton/cvsfiles/egcs/./gcc/calls.c,v  <--  calls.c
new revision: 1.12; previous revision: 1.11
done
Checking in genattrtab.c;
/egcs/carton/cvsfiles/egcs/./gcc/genattrtab.c,v  <--  genattrtab.c
new revision: 1.15; previous revision: 1.14
done
[/law/egcs/egcs/gcc] 
</pre>
</blockquote>

<p>Note that only a single CVS log message was used for all the files;
this is the normal and expected behavior.  It is not necessary to perform
multiple commits and split up the CVS log entry on a file by file basis.
Note this implies that each checkin is for a single logical change
that may effect multiple files.  If you have several unrelated changes,
you should check them in with separate cvs commit commands.

<p>And that's it!

<hr>
<i>Last modified on July 2, 1998.</i>

</body>
</html>
