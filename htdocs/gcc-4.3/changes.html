<html>

<head>
<title>GCC 4.3 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.3 Release Series<br />Changes, New Features, and Fixes</h1>

<h2>Caveats</h2>

  <ul>
    <li id="mpfrcaveats">GCC requires the <a
    href="http://gmplib.org/">GMP</a> and <a
    href="http://www.mpfr.org/">MPFR</a> libraries for building all
    the various front-end languages it supports.  See the <a
    href="http://gcc.gnu.org/install/prerequisites.html">prerequisites
    page</a> for version requirements.</li>

    <li>ColdFire targets now treat <code>long double</code> as having
    the same format as <code>double</code>.  In earlier versions of GCC,
    they used the 68881 <code>long double</code> format instead.</li>

    <li>The <code>m68k-uclinux</code> target now uses the same
    calling conventions as <code>m68k-linux-gnu</code>.  You can
    select the original calling conventions by configuring for
    <code>m68k-uclinuxoldabi</code> instead.  Note that
    <code>m68k-uclinuxoldabi</code> also retains the original
    80-bit <code>long double</code> on ColdFire targets.</li>

    <li>The <code>-fforce-mem</code> option has been removed
    because it has had no effect in the last few GCC releases.</li>

    <li>The i386 <code>-msvr3-shlib</code> option has been removed
    since it is no longer used.</li>

    <li>Support for the AOF assembler has been removed from the ARM
    back end; this affects only the targets <code>arm-semi-aof</code>
    and <code>armel-semi-aof</code>, which are no longer recognized.
    We removed these targets without a deprecation period because we
    discovered that they have been unusable since GCC 4.0.0.</li>

    <li>The <code><a
    href="http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#Warning-Options"
    >-Wconversion</a></code> option has been modified. Its purpose now
    is to warn for implicit conversions that may alter a value. This
    new behavior is available for both C and C++. Warnings about
    conversions between signed and unsigned integers can be disabled
    by using <code>-Wno-sign-conversion</code>. In C++, they are
    disabled by default unless <code>-Wsign-conversion</code> is
    explicitly requested. The old behavior of
    <code>-Wconversion</code>, that is, warn for prototypes causing a
    type conversion that is different from what would happen to the
    same argument in the absence of a prototype, has been moved to a
    new option <code>-Wtraditional-conversion</code>, which is only
    available for C.</li>

    <li>The C++ preprocessor now emits errors by default for certain
    non-conformant code and for <code>-pedantic</code>, following the
    default behaviour of the C++ front-end. As a result, some
    warnings, such as <code>"extra tokens at end of #endif
    directive"</code>, are now hard errors.  The
    <code>-fpermissive</code> option can be used to downgrade these
    diagnostics from errors to warnings.</li>

    <li>The <code>-m386, -m486, -mpentium</code> and
    <code>-mpentiumpro</code> tuning options have been removed because
    they were deprecated for more than 3 GCC major releases. Use
    <code>-mtune=i386</code>, <code>-mtune=i486</code>, 
    <code>-mtune=pentium</code> or <code>-mtune=pentiumpro</code> as a
    replacement.</li>

  </ul>

<h2>General Optimizer Improvements</h2>

  <ul>
    <li id="mpfropts">The GCC middle-end has been integrated with the
    <a href="http://www.mpfr.org/">MPFR</a> library.  This allows GCC
    to evaluate and replace at compile-time calls to built-in math
    functions having constant arguments with their mathematically
    equivalent results.  In making use of <a
    href="http://www.mpfr.org/">MPFR</a>, GCC can generate correct
    results regardless of the math library implementation or floating
    point precision of the host platform.  This also allows GCC to
    generate identical results regardless of whether one compiles in
    native or cross-compile configurations to a particular target.
    The following built-in functions take advantage of this new
    capability: <code>acos</code>, <code>acosh</code>,
    <code>asin</code>, <code>asinh</code>, <code>atan2</code>,
    <code>atan</code>, <code>atanh</code>, <code>cbrt</code>,
    <code>cos</code>, <code>cosh</code>, <code>drem</code>,
    <code>erf</code>, <code>erfc</code>, <code>exp10</code>,
    <code>exp2</code>, <code>exp</code>, <code>expm1</code>,
    <code>fdim</code>, <code>fma</code>, <code>fmax</code>,
    <code>fmin</code>, <code>gamma_r</code>, <code>hypot</code>,
    <code>j0</code>, <code>j1</code>, <code>jn</code>,
    <code>lgamma_r</code>, <code>log10</code>, <code>log1p</code>,
    <code>log2</code>, <code>log</code>, <code>pow10</code>,
    <code>pow</code>, <code>remainder</code>, <code>remquo</code>,
    <code>sin</code>, <code>sincos</code>, <code>sinh</code>,
    <code>tan</code>, <code>tanh</code>, <code>tgamma</code>,
    <code>y0</code>, <code>y1</code> and <code>yn</code>.  The
    <code>float</code> and <code>long double</code> variants of these
    functions (e.g. <code>sinf</code> and <code>sinl</code>) are also
    handled.  The <code>sqrt</code> and <code>cabs</code> functions
    with constant arguments were already optimized in prior GCC
    releases.  Now they also use <a href="http://www.mpfr.org/">MPFR</a>. </li>

    <li>A new <em>forward propagation</em> pass on RTL was added.  The new pass
      replaces several slower transformations, resulting in compile-time
      improvements as well as better code generation in some cases.</li>

    <li> A new command line switch <code>-frecord-gcc-switches</code> has been
    added to GCC, although it is only enabled for some targets.  The switch
    causes the command line that was used to invoke the compiler to be recorded
    into the object file that is being created.  The exact format of this
    recording is target and binary file format dependent, but it usually takes
    the form of a note section containing ASCII text.  The switch is related to
    the <code>-fverbose-asm</code> switch, but that one only records the
    information in the assembler output file as comments, so the information
    never reaches the object file.
    </li>

    <li>The inliner heuristic is now aware of stack frame consumption.  New
    command line parameters <code>--param large-stack-frame</code>
    and <code>--param large-stack-frame-growth</code>
    can be used to limit stack frame size growth caused by inlining.</li>

    <li>During feedback directed optimizations, the expected block size
    the <code>memcpy</code>, <code>memset</code> and <code>bzero</code>
    functions operate on is discovered and for cases of commonly used small
    sizes, specialized inline code is generated.</li>

    <li><code>__builtin_expect</code> no longer requires its argument to be
    a compile time constant.</li>

    <li id="ipa">Interprocedural optimization was reorganized to work on
	functions in SSA form.  This enables more precise and cheaper dataflow
	analysis and makes writing interprocedural optimizations easier.  The
	following improvements have been implemented on top of this
	framework:
	<ul>
	 <li>Pre-inline optimization: Selected local optimization passes are
	     run before the inliner (and other interprocedural passes) are
	     executed.  This significantly improves the accuracy of code growth
	     estimates used by the inliner and reduces the overall memory
	     footprint for large compilation units.</li>
	 <li>Early inlining (a simple bottom-up inliner pass inlining only
	     functions whose body is smaller than the expected call overhead)
	     is now executed with the early optimization passes, thus inlining
	     already optimized function bodies into an unoptimized function
	     that is subsequently optimized by early optimizers.  This enables
	     the compiler to quickly eliminate abstraction penalty in C++
	     programs.</li>
	 <li>Interprocedural constant propagation now operate on SSA form
	     increasing accuracy of the analysis.</li>
	</ul>
    </li>

    <li>A new internal representation for GIMPLE statements has been
      contributed, resulting in compile-time memory savings.</li>
  </ul>

<h2>New Languages and Language specific improvements</h2>

<ul>
  <li>We have added new command line options
  <code>-finstrument-functions-exclude-function-list</code> and
  <code>-finstrument-functions-exclude-file-list</code>.  They provide
  more control over which functions are annotated
  by the <code>-finstrument-functions</code> option.</li>
</ul>

<h3>C family</h3>

  <ul>
    <li>
    Implicit conversions between generic vector types are now
    only permitted when the two vectors in question have the same number
    of elements and compatible element types.  (Note that the restriction
    involves <em>compatible</em> element types, not
    implicitly-convertible element types: thus, a vector type with element
    type <code>int</code> may not be implicitly converted to a vector
    type with element type <code>unsigned int</code>.)
    This restriction, which is in line with specifications for SIMD
    architectures such as AltiVec, may be relaxed using the
    flag <code>-flax-vector-conversions</code>.
    This flag is intended only as a compatibility measure and should not
    be used for new code.
    </li>
    <li>
      <code>-Warray-bounds</code> has been added and is now enabled by
      default for <code>-Wall</code> . It produces warnings for array
      subscripts that can be determined at compile time to be always
      out of bounds. <code>-Wno-array-bounds</code> will disable the
      warning.
    </li>
    <li>
     The <code>constructor</code> and <code>destructor</code> function
     attributes now accept optional priority arguments which control
     the order in which the constructor and destructor functions are
     run.
    </li>

    <li>
    New command line options <code>-Wold-style-declaration</code>,
    <code>-Wmissing-parameter-type</code>, <code>-Wempty-body</code>
    and <code>-Wclobbered</code> have been added for finer control of
    the diverse warnings enabled by <code>-Wextra</code>.
    </li>

    <li>
    A new function attribute <code>alloc_size</code> has been added to
    mark up <code>malloc</code> style functions. For constant sized
    allocations this can be used to find out the size of the returned
    pointer using the <code>__builtin_object_size()</code> function
    for buffer overflow checking and similar.
    This supplements the already built-in <code>malloc</code> and
    <code>calloc</code> constant size handling.
    </li>

    <li>
    Integer constants written in binary are now supported as a GCC
    extension.  They consist of a prefix <code>0b</code> or
    <code>0B</code>, followed by a sequence of 0 and 1 digits.
    </li>

    <li>
    A new predefined macro <code>__COUNTER__</code> has been added.
    It expands to sequential integral values starting from 0.  In
    conjunction with the <code>##</code> operator, this provides a
    convenient means to generate unique identifiers.
    </li>

    <li>
    A new command line option <code>-fdirectives-only</code> has been
    added.  It enables a special preprocessing mode which improves the
    performance of applications like distcc and ccache.
    </li>

  </ul>

<h3>C++</h3>
  <ul>
  <li><a href="cxx0x_status.html">Experimental support for the upcoming
  ISO C++ standard, C++0x</a>.</li>

  <li><code>-Wc++0x-compat</code> has been added and is now enabled by
  default for <code>-Wall</code>. It produces warnings for constructs
  whose meaning differs between ISO C++ 1998 and C++0x.</li>

  <li>The <code>-Wparentheses</code> option now works for C++ as it
  does for C.  It warns if parentheses are omitted when operators with
  confusing precedence are nested.  It also warns about ambiguous else
  statements.  Since <code>-Wparentheses</code> is enabled by
  <code>-Wall</code>, this may cause additional warnings with existing
  C++ code which uses <code>-Wall</code>.  These new warnings may be
  disabled by using <code>-Wall -Wno-parentheses</code>.</li>

  <li>The <code>-Wmissing-declarations</code> now works for C++ as it
  does for C.</li>

  <li>The <code>-fvisibility-ms-compat</code> flag was added, to make it
  easier to port larger projects using shared libraries from Microsoft's
  Visual Studio to ELF and Mach-O systems.</li>

  </ul>

  <h4>Runtime Library (libstdc++)</h4>
  <ul>
    <li> Support for TR1 mathematical special functions and regular
    expressions. The implementation status for TR1 can be tracked in
    <a href="http://gcc.gnu.org/onlinedocs/libstdc++/ext/tr1.html">
    tr1.html </a> </li>
    <li> Default <code>what</code> implementations give more elaborate
    exception strings for <code>bad_cast</code>,
    <code>bad_typeid</code>, <code>bad_exception</code>, and
    <code>bad_alloc</code>. </li>
    <li> Header dependencies have been streamlined, reducing
    unnecessary includes and pre-processed bloat. </li>
    <li> Variadic template implementations of items in &lt;tuple&gt; and
    &lt;functional&gt;.  </li>
  </ul>


<h3>Fortran</h3>
  <ul>

    <li>Due to the fact that the <a
    href="http://gmplib.org/">GMP</a> and <a
    href="http://www.mpfr.org/">MPFR</a> libraries are required for
    all languages, Fortran is no longer special in this regard and is
    available by default.</li>

    <li>The <code>
    <a href="http://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html#Code-Gen-Options"
    >-fexternal-blas</a></code> option has been added, which
    generates calls to BLAS routines for intrinsic matrix operations such
    as <code>matmul</code> rather than using the built-in algorithms.</li>
    <li>Support to give a backtrace (compiler flag <code>-fbacktrace</code>
    or environment variable <code>GFORTRAN_ERROR_BACKTRACE</code>; on glibc
    systems only) or a core dump (<code>-fdump-core</code>,
    <code>GFORTRAN_ERROR_DUMPCORE</code>) when a run-time error occured.</li>
    <li>GNU Fortran now defines <code>__GFORTRAN__</code> when it runs the C
    preprocessor (CPP).</li>
    <li>Fortran 2003 support has been extended:
    <ul>
      <li>Intrinsic statements IMPORT, PROTECTED, VALUE and VOLATILE</li>
      <li>Pointer intent</li>
      <li>Intrinsic module <code>ISO_ENV_FORTRAN</code></li>
      <li>Interoperability with C (ISO C Bindings)</li>
    </ul></li>
  </ul>

<h3>Java (GCJ)</h3>

  <ul>

     <li> gcj now uses the Eclipse Java compiler for its Java parsing
     needs.  This enables the use of all 1.5 language features, and
     fixes most existing front end bugs. </li>

     <li> libgcj now supports all 1.5 language features which require
     runtime support: foreach, enum, annotations, generics, and
     auto-boxing.  </li>

     <li id="gcjtools"> We've made many changes to the tools shipped
     with gcj.
     <ul>

     <li> The old <code>jv-scan</code> tool has been removed.  This
     tool never really worked properly.  There is no replacement.
     </li>

     <li> <code>gcjh</code> has been rewritten.  Some of its more
     obscure options no longer work, but are still recognized in an
     attempt at compatibility.  <code>gjavah</code> is a new program
     with similar functionality but different command line options.
     </li>

     <li> <code>grmic</code> and <code>grmiregistry</code> have been
     rewritten.  <code>grmid</code> has been added.  </li>

     <li> <code>gjar</code> replaces the old <code>fastjar</code>.  </li>

     <li> <code>gjarsigner</code> (used for signing jars),
     <code>gkeytool</code> (used for key management),
     <code>gorbd</code> (for CORBA), <code>gserialver</code> (computes
     serialization UIDs), and <code>gtnameserv</code> (also for CORBA)
     are now installed. </li>
     </ul>
     </li>

     <li> The ability to dump the contents of the java run time heap to
     a file for off-line analysis has been added.  The heap dumps may
     be analyzed with the new <code>gc-analyze</code> tool.  They may
     be generated on out-of-memory conditions or on demand and are
     controlled by the new run time class
     <code>gnu.gcj.util.GCInfo</code>.  </li>

     <li> <code>java.util.TimeZone</code> can now read files from
     <code>/usr/share/zoneinfo</code> to provide correct, updated,
     timezone information.  This means that packagers no longer have
     to update libgcj when a time zone change is published. </li>

  </ul>

<h2>New Targets and Target Specific Improvements</h2>

<h3>IA-32/x86-64</h3>
  <ul>
    <li>Tuning for Intel Core 2 processors is available via
        <code>-mtune=core2</code> and <code>-march=core2</code>.</li>
    <li>Tuning for AMD Geode processors is available via
        <code>-mtune=geode</code> and <code>-march=geode</code>.</li>
    <li>Code generation of block move (<code>memcpy</code>) and block set
	(<code>memset</code>) was rewritten.  GCC can now pick the best
        algorithm (loop, unrolled loop, instruction with <code>rep</code>
        prefix or a library call) based on the size of the block being
        copied and the CPU being optimized for.  A new option
        <code>-minline-stringops-dynamically</code> has been added.  With
        this option string operations of unknown size are expanded such
        that small blocks are copied by in-line code, while for
	large blocks a library call is used.  This results in faster code than
	<code>-minline-all-stringops</code> when the library implementation is
	capable of using cache hierarchy hints.  The heuristic choosing
	the particular algorithm can be overwritten via
	<code>-mstringop-strategy</code>.  Newly also <code>memset</code> of
	values different from 0 is inlined.</li>
    <li>GCC no longer places the <code>cld</code> instruction before string
	operations.  Both i386 and x86-64 ABI documents mandate the direction
	flag to be clear at the entry of a function.  It is now invalid to
	set the flag in <code>asm</code> statement without reseting it
	afterward.</li>
    <li>Support for SSSE3 built-in functions and code generation are
	available via <code>-mssse3</code>.</li>
    <li>Support for SSE4.1 built-in functions and code generation are
	available via <code>-msse4.1</code>.</li>
    <li>Support for SSE4.2 built-in functions and code generation are
	available via <code>-msse4.2</code>.</li> 
    <li>Both SSE4.1 and SSE4.2 support can be enabled via
	<code>-msse4</code>.</li>
    <li>A new set of options <code>-mpc32</code>, <code>-mpc64</code>
        and <code>-mpc80</code> have been added to allow explicit control
        of x87 floating point precision.</li>
    <li>Support for <code>__float128</code> (TFmode) IEEE quad type and
	corresponding TCmode IEEE complex quad type is available
	via the soft-fp library on <code>x86_64</code> targets.
	This includes basic arithmetic operations (addition, subtraction,
	negation, multiplication and division) on <code>__float128</code>
	real and TCmode complex values, the full set of IEEE comparisons
	between <code>__float128</code> values, conversions to and from
	<code>float</code>, <code>double</code> and <code>long double</code>
	floating point types, as well as conversions to and from
	<code>signed</code> or <code>unsigned</code> integer,
	<code>signed</code> or <code>unsigned long</code> integer and
	<code>signed</code> or <code>unsigned</code> quad (TImode) integer
	types.  Additionally, all operations generate the full set of IEEE
	exceptions and support the full set of IEEE rounding modes.</li>
    <li>GCC can now utilize the ACML library for vectorizing calls to
	a set of C99 functions on x86_64 if <code>-mveclibabi=acml</code>
	is specified and you link to an ACML ABI compatible library.</li>
  </ul>

<h3>ARM</h3>
  <ul>
    <li>Compiler and Library support for Thumb-2 and the ARMv7
        architecture has been added.</li>
  </ul>

<h3 id="m68k">m68k and ColdFire</h3>
  <h4>New features</h4>
    <ul>
      <li>Support for several new ColdFire processors has been added.
	  You can generate code for them using the new <code>-mcpu</code>
	  option.</li>
      <li>All targets now support ColdFire processors.</li>
      <li><code>m68k-uclinux</code> targets have improved support for
	  C++ constructors and destructors, and for shared libraries.</li>
      <li>It is now possible to set breakpoints on the first or last line
	  of a function, even if there are no statements on that line.</li>
    </ul>
  <h4>Optimizations</h4>
    <ul>
      <li>Support for sibling calls has been added.</li>
      <li>More use is now made of the ColdFire <code>mov3q</code>
	  instruction.</li>
      <li><code>__builtin_clz</code> is now implemented using the
	  <code>ff1</code> ColdFire instruction, when available.</li>
      <li>GCC now honors the <code>-m68010</code> option.  68010 code
	  now uses <code>clr</code> rather than <code>move</code> to
	  zero volatile memory.</li>
      <li>68020 targets and above can now use
	  <code>symbol(index.size*scale)</code> addresses for
	  indexed array accesses.  Earlier compilers would always
	  load the symbol into a base register first.</li>
    </ul>
  <h4>Configuration changes</h4>
    <ul>
      <li>All m68k and ColdFire targets now allow the default processor
	  to be set at configure time using <code>--with-cpu</code>.</li>
      <li>A <code>--with-arch</code> configuration option has been added.
	  This option allows you to restrict a target to ColdFire or
	  non-ColdFire processors.</li>
    </ul>
  <h4>Preprocessor macros</h4>
    <ul>
      <li>An <code>__mcfv*__</code> macro is now defined for all ColdFire
	  targets.  (Earlier versions of GCC only defined
	  <code>__mcfv4e__</code>.)</li>
      <li><code>__mcf_cpu_*</code>, <code>__mcf_family_*</code> and
	  <code>__mcffpu__</code> macros have been added.</li>
      <li>All targets now define <code>__mc68010</code> and
	  <code>__mc68010__</code> when generating 68010 code.</li>
    </ul>
  <h4>Command-line changes</h4>
    <ul>
      <li>New command-line options <code>-march</code>, <code>-mcpu</code>,
	  <code>-mtune</code> and <code>-mhard-float</code> have been added.
	  These options apply to both m68k and ColdFire targets.</li>
      <li><code>-mno-short</code>, <code>-mno-bitfield</code> and
	  <code>-mno-rtd</code> are now accepted as negative versions
	  of <code>-mshort</code>, etc.</li>
    </ul>
  <h4>Other improvements</h4>
    <ul>
      <li>ColdFire targets now try to maintain a 4-byte-aligned
	  stack where possible.</li>
      <li><code>m68k-uclinux</code> targets now try to avoid
	  situations that lead to the load-time error:
	  <code>BINFMT_FLAT: reloc outside program</code>.</li>
    </ul>

<h3>MIPS</h3>
  <ul>
    <li>Support for 74K family processors has been added, with
	associated <code>-march</code> and <code>-mtune</code>
	options.</li>
  </ul>

<h3>SPU (Synergistic Processor Unit) of the Cell Broadband Engine
    Architecture (BEA)</h3>
  <ul>
    <li>Support has been added for this new architecture.</li>
  </ul>


<h2>Documentation improvements</h2>

<h2>Other significant improvements</h2>

  <ul>
    <li><p>The compiler's <code>--help</code> command line option has
    been extended so that it now takes an optional set of arguments.
    These arguments restrict the information displayed to specific
    classes of command line options, and possibly only a subset of
    those options.  It is also now possible to replace the descriptive
    text associated with each displayed option with an indication of
    its current value, or for binary options, whether it has been
    enabled or disabled.</p>

    <p>Here are some examples.  The following will display all the
    options controlling warning messages:</p>
    <pre>
      --help=warnings
    </pre>

    <p>Whereas this will display all the undocumented, target specific
    options:</p>
    <pre>
      --help=target,undocumented
    </pre>

    <p>This sequence of commands will display the binary
    optimizations that are enabled by <code>-O3</code>:</p>
    <pre>
      gcc -c -Q -O3 --help=optimizers &gt; /tmp/O3-opts
      gcc -c -Q -O2 --help=optimizers &gt; /tmp/O2-opts
      diff /tmp/O2-opts /tmp/O3-opts | grep enabled
    </pre>
    </li>

    <li>The configure options <code>--with-pkgversion</code> and
    <code>--with-bugurl</code> have been added.  These allow
    distributors of GCC to include a distributor-specific string in
    manuals and <code>--version</code> output and to specify the URL
    for reporting bugs in their versions of GCC.</li>
  </ul>

</body>
</html>
