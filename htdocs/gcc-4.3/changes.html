<html>

<head>
<title>GCC 4.3 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.3 Release Series<br />Changes, New Features, and Fixes</h1>

<h2>Caveats</h2>

  <ul>
    <li id="mpfrcaveats">GCC requires the <a
    href="http://www.swox.com/gmp/">GMP</a> and <a
    href="http://www.mpfr.org/">MPFR</a> libraries for building all
    the various front-end languages it supports.  See the <a
    href="http://gcc.gnu.org/install/prerequisites.html">prerequisites
    page</a> for version requirements.</li>

    <li>ColdFire targets now treat <code>long double</code> as having
    the same format as <code>double</code>.  In earlier versions of GCC,
    they used the 68881 <code>long double</code> format instead.</li>

    <li>The <code>m68k-uclinux</code> target now uses the same
    calling conventions as <code>m68k-linux-gnu</code>.  You can
    select the original calling conventions by configuring for
    <code>m68k-uclinuxoldabi</code> instead.  Note that
    <code>m68k-uclinuxoldabi</code> also retains the original
    80-bit <code>long double</code> on ColdFire targets.</li>

    <li>The <code>-fforce-mem</code> option has been removed
    because it had no effect in the last few GCC releases.</li>
  </ul>

<h2>General Optimizer Improvements</h2>

  <ul>
    <li id="mpfropts">The GCC middle-end has been integrated with the
    <a href="http://www.mpfr.org/">MPFR</a> library.  This allows GCC
    to evaluate and replace at compile-time calls to built-in math
    functions having constant arguments with their mathematically
    equivalent results.  In making use of <a
    href="http://www.mpfr.org/">MPFR</a>, GCC can generate correct
    results regardless of the math library implementation or floating
    point precision of the host platform.  This also allows GCC to
    generate identical results regardless of whether one compiles in
    native or cross-compile configurations to a particular target.
    The following built-in functions take advantage of this new
    capability: <code>acos</code>, <code>acosh</code>,
    <code>asin</code>, <code>asinh</code>, <code>atan</code>,
    <code>atan2</code>, <code>atanh</code>, <code>cbrt</code>,
    <code>cos</code>, <code>cosh</code>, <code>erf</code>,
    <code>erfc</code>, <code>exp</code>, <code>exp10</code>,
    <code>exp2</code>, <code>expm1</code>, <code>fdim</code>,
    <code>fma</code>, <code>fmax</code>, <code>fmin</code>,
    <code>hypot</code>, <code>log</code>, <code>log10</code>,
    <code>log1p</code>, <code>log2</code>, <code>pow</code>,
    <code>pow10</code>, <code>sin</code>, <code>sincos</code>,
    <code>sinh</code>, <code>tan</code>, <code>tanh</code> and
    <code>tgamma</code>.  The <code>float</code> and <code>long
    double</code> variants of these functions (e.g. <code>sinf</code>
    and <code>sinl</code>) are also handled.  The <code>sqrt</code>
    and <code>cabs</code> functions with constant arguments were
    already optimized in prior GCC releases.  Now they also use <a
    href="http://www.mpfr.org/">MPFR</a>. </li>

    <li>A new <em>forward propagation</em> pass on RTL was added.  The new pass
      replaces several slower transformations, resulting in compile-time
      improvements as well as better code generation in some cases.</li>

    <li> A new command line switch <code>-frecord-gcc-switches</code> has been
    added to GCC, although it is only enabled for some targets.  The switch
    causes the command line that was used to invoke the compiler to be recorded
    into the object file that is being created.  The exact format of this
    recording is target and binary file format dependent, but it usually takes
    the form of a note section containing ASCII text.  The switch is related to
    the <code>-fverbose-asm</code> switch, but that one only records the
    information in the assembler output file as comments, so the information
    never reaches the object file.
    </li>

    <li>The inliner heuristic is now aware of stack frame consumption.  New
    command line parameters <code>--param large-stack-frame</code>
    and <code>--param large-stack-frame-growth</code>
    can be used to limit stack frame size growth caused by inlining.</li>

    <li>During feedback directed optimizations, the expected block size
    the <code>memcpy</code>, <code>memset</code> and <code>bzero</code>
    functions operate on is discovered and for cases of commonly used small
    sizes, specialized inline code is generated.</li>

    <li><code>__builtin_expect</code> no longer requires its argument to be
    a compile time constant.</li>

    <li id="ipa">Interprocedural optimization was reorganized to work on
	functions in SSA form.  This enables more precise and cheaper dataflow
	analysis and makes writing interprocedural optimizations easier.  The
	following improvements have been implemented on top of this
	framework:
	<ul>
	 <li>Pre-inline optimization: Selected local optimization passes are
	     run before the inliner (and other interprocedural passes) are
	     executed.  This significantly improves the accuracy of code growth
	     estimates used by the inliner and reduces the overall memory
	     footprint for large compilation units.</li>
	 <li>Early inlining (a simple bottom-up inliner pass inlining only
	     functions whose body is smaller than the expected call overhead)
	     is now executed with the early optimization passes, thus inlining
	     already optimized function bodies into an unoptimized function
	     that is subsequently optimized by early optimizers.  This enables
	     the compiler to quickly eliminate abstraction penalty in C++
	     programs.</li>
	 <li>Interprocedural constant propagation now operate on SSA form
	     increasing accuracy of the analysis.</li>
	</ul>
    </li>

    <li>A new internal representation for GIMPLE statements has been
      contributed, resulting in compile-time memory savings.</li>
  </ul>

<h2>New Languages and Language specific improvements</h2>

<h3>C family</h3>

  <ul>
    <li>
    Implicit conversions between generic vector types are now
    only permitted when the two vectors in question have the same number
    of elements and compatible element types.  (Note that the restriction
    involves <em>compatible</em> element types, not
    implicitly-convertible element types: thus, a vector type with element
    type <code>int</code> may not be implicitly converted to a vector
    type with element type <code>unsigned int</code>.)
    This restriction, which is in line with specifications for SIMD
    architectures such as AltiVec, may be relaxed using the
    flag <code>-flax-vector-conversions</code>.
    This flag is intended only as a compatibility measure and should not
    be used for new code.
    </li>
    <li>
      <code>-Warray-bounds</code> has been added and is now enabled by
      default for <code>-Wall</code> . It produces warnings for array
      subscripts that can be determined at compile time to be always
      out of bounds. <code>-Wno-array-bounds</code> will disable the
      warning.
    </li>
    <li>
     The <code>constructor</code> and <code>destructor</code> function
     attributes now accept optional priority arguments which control
     the order in which the constructor and destructor functions are
     run.
    </li>
  </ul>

<h3>C++</h3>
  <ul>
    <li>Experimental support for the upcoming ISO C++ standard, C++0x,
  has been added. This support can be enabled with the
  <code>-std=c++0x</code> or <code>-std=gnu++0x</code> compiler
  options; the former disables GNU extensions. The following C++0x
  features are enabled by this experimental mode:
  <ul>
    <li><a
  href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2004/n1720.html">Static
  assertions</a></li>
    <li><a
  href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2004/n1653.htm">C99
  preprocessor</a></li>
    <li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1757.html">Right angle brackets</a></li>
    <li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#226">Default template arguments for function templates</a></li>
    <li><a
    href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2152.pdf">Variadic
    templates</a> (only enabled by <code>-std=gnu++0x</code>)</li>
    <li> Headers &lt;array&gt;, &lt;random&gt;, &lt;regex&gt;,
    &lt;tuple&gt;, &lt;type_traits&gt;, &lt;unordered_map&gt;, and
    &lt;unordered_set&gt;. Plus, headers for C compatibility:
    &lt;ccomplex&gt;, &lt;cfenv&gt;, &lt;cinttypes&gt;,
    &lt;cstdbool&gt;, &lt;cstdint&gt;, and &lt;ctgmath&gt;. </li>
    </ul> 
  </li>

  <li><code>-Wc++0x-compat</code> has been added and is now enabled by
  default for <code>-Wall</code>. It produces warnings for constructs
  whose meaning differs between ISO C++ 1998 and C++0x.</li>

  <li>The <code>-Wparentheses</code> option now works for C++ as it
  does for C.  It warns if parentheses are omitted when operators with
  confusing precedence are nested.  It also warns about ambiguous else
  statements.  Since <code>-Wparentheses</code> is enabled by
  <code>-Wall</code>, this may cause additional warnings with existing
  C++ code which uses <code>-Wall</code>.  These new warnings may be
  disabled by using <code>-Wall -Wno-parentheses</code>.</li>

  <li>The <code>-Wmissing-declarations</code> now works for C++ as it
  does for C.</li>

  </ul>

  <h4>Runtime Library (libstdc++)</h4>
  <ul>
    <li> Support for TR1 mathematical special functions and regular
    expressions. The implementation status for TR1 can be tracked in
    <a href="http://gcc.gnu.org/onlinedocs/libstdc++/ext/tr1.html">
    tr1.html </a> </li>
    <li> Default <code>what</code> implementations give more elaborate
    exception strings for <code>bad_cast</code>,
    <code>bad_typeid</code>, <code>bad_exception</code>, and
    <code>bad_alloc</code>.</a> </li>
    <li> Header dependencies have been streamlined, reducing
    unnecessary includes and pre-processed bloat. </li>
    <li> Variadic template implementations of items in &lt;tuple&gt; and
    &lt;functional&gt;.  </li>
  </ul>


<h3>Fortran</h3>
  <ul>

    <li>Due to the fact that the <a
    href="http://www.swox.com/gmp/">GMP</a> and <a
    href="http://www.mpfr.org/">MPFR</a> libraries are required for
    all languages, Fortran is no longer special in this regard and is
    available by default.</li>

    <li>The <code>
    <a href="http://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html#Code-Gen-Options"
    >-fexternal-blas</a></code> option has been added, which
    generates calls to BLAS routines for intrinsic matrix operations such
    as <code>matmul</code> rather than using the built-in algorithms.</li>
    <li>Fortran 2003 support has been extended:
    <ul>
      <li>Intrinsic statements <code>VOLATILE</code> and <code>IMPORT</code></li>
      <li>Intrinsic module <code>ISO_ENV_FORTRAN</code></li>
    </ul></li>
  </ul>

<h3>Java (GCJ)</h3>

  <ul>

     <li> gcj now uses the Eclipse Java compiler for its Java parsing
     needs.  This enables the use of all 1.5 language features, and
     fixes most existing front end bugs. </li>

     <li> libgcj now supports all 1.5 language features which require
     runtime support: foreach, enum, annotations, generics, and
     auto-boxing.  </li>

     <li id="gcjtools"> We've made many changes to the tools shipped
     with gcj.
     <ul>

     <li> The old <code>jv-scan</code> tool has been removed.  This
     tool never really worked properly.  There is no replacement.
     </li>

     <li> <code>gcjh</code> has been rewritten.  Some of its more
     obscure options no longer work, but are still recognized in an
     attempt at compatibility.  <code>gjavah</code> is a new program
     with similar functionality but different command line options.
     </li>

     <li> <code>grmic</code> and <code>grmiregistry</code> have been
     rewritten.  <code>grmid</code> has been added.  </li>

     <li> <code>gjar</code> replaces the old <code>fastjar</code>.  </li>

     <li> <code>gjarsigner</code> (used for signing jars),
     <code>gkeytool</code> (used for key management),
     <code>gorbd</code> (for CORBA), <code>gserialver</code> (computes
     serialization UIDs), and <code>gtnameserv</code> (also for CORBA)
     are now installed. </li>
     </ul>
     </li>

     <li> The ability to dump the contents of the java run time heap to
     a file for off-line analysis has been added.  The heap dumps may
     be analyzed with the new <code>gc-analyze</code> tool.  They may
     be generated on out-of-memory conditions or on demand and are
     controlled by the new run time class
     <code>gnu.gcj.util.GCInfo</code>.  </li>

     <li> <code>java.util.TimeZone</code> can now read files from
     <code>/usr/share/zoneinfo</code> to provide correct, updated,
     timezone information.  This means that packagers no longer have
     to update libgcj when a time zone change is published. </li>

  </ul>

<h2>New Targets and Target Specific Improvements</h2>

<h3>IA-32/x86-64</h3>
  <ul>
    <li>Tuning for Intel Core 2 processors is available via
        <code>-mtune=core2</code> and <code>-march=core2</code>.</li>
    <li>Tuning for AMD Geode processors is available via
        <code>-mtune=geode</code> and <code>-march=geode</code>.</li>
    <li>Code generation of block move (<code>memcpy</code>) and block set
	(<code>memset</code>) was rewritten.  GCC can now pick the best
        algorithm (loop, unrolled loop, instruction with <code>rep</code>
        prefix or a library call) based on the size of the block being
        copied and the CPU being optimized for.  A new option
        <code>-minline-stringops-dynamically</code> has been added.  With
        this option string operations of unknown size are expanded such
        that small blocks are copied by in-line code, while for
	large blocks a library call is used.  This results in faster code than
	<code>-minline-all-stringops</code> when the library implementation is
	capable of using cache hierarchy hints.  The heuristic choosing
	the particular algorithm can be overwritten via
	<code>-mstringop-strategy</code>.  Newly also <code>memset</code> of
	values different from 0 is inlined.</li>
    <li>GCC no longer places the <code>cld</code> instruction before string
	operations.  Both i386 and x86-64 ABI documents mandate the direction
	flag to be clear at the entry of a function.  It is now invalid to
	set the flag in <code>asm</code> statement without reseting it
	afterward.</li>
    <li>Support for SSSE3 built-in functions and code generation are
	available via <code>-mssse3</code>.</li>
  </ul>

<h3>ARM</h3>
  <ul>
    <li>Compiler and Library support for Thumb-2 and the ARMv7
        architecture has been added.</li>
  </ul>

<h3 id="m68k">m68k and ColdFire</h3>
  <h4>New features</h4>
    <ul>
      <li>Support for several new ColdFire processors has been added.
	  You can generate code for them using the new <code>-mcpu</code>
	  option.</li>
      <li>All targets now support ColdFire processors.</li>
      <li><code>m68k-uclinux</code> targets have improved support for
	  C++ constructors and destructors, and for shared libraries.</li>
      <li>It is now possible to set breakpoints on the first or last line
	  of a function, even if there are no statements on that line.</li>
    </ul>
  <h4>Optimizations</h4>
    <ul>
      <li>Support for sibling calls has been added.</li>
      <li>More use is now made of the ColdFire <code>mov3q</code>
	  instruction.</li>
      <li><code>__builtin_clz</code> is now implemented using the
	  <code>ff1</code> ColdFire instruction, when available.</li>
      <li>GCC now honors the <code>-m68010</code> option.  68010 code
	  now uses <code>clr</code> rather than <code>move</code> to
	  zero volatile memory.</li>
      <li>68020 targets and above can now use
	  <code>symbol(index.size*scale)</code> addresses for
	  indexed array accesses.  Earlier compilers would always
	  load the symbol into a base register first.</li>
    </ul>
  <h4>Configuration changes</h4>
    <ul>
      <li>All m68k and ColdFire targets now allow the default processor
	  to be set at configure time using <code>--with-cpu</code>.</li>
      <li>A <code>--with-arch</code> configuration option has been added.
	  This option allows you to restrict a target to ColdFire or
	  non-ColdFire processors.</li>
    </ul>
  <h4>Preprocessor macros</h4>
    <ul>
      <li>An <code>__mcfv*__</code> macro is now defined for all ColdFire
	  targets.  (Earlier versions of GCC only defined
	  <code>__mcfv4e__</code>.)</li>
      <li><code>__mcf_cpu_*</code>, <code>__mcf_family_*</code> and
	  <code>__mcffpu__</code> macros have been added.</li>
      <li>All targets now define <code>__mc68010</code> and
	  <code>__mc68010__</code> when generating 68010 code.</li>
    </ul>
  <h4>Command-line changes</h4>
    <ul>
      <li>New command-line options <code>-march</code>, <code>-mcpu</code>,
	  <code>-mtune</code> and <code>-mhard-float</code> have been added.
	  These options apply to both m68k and ColdFire targets.</li>
      <li><code>-mno-short</code>, <code>-mno-bitfield</code> and
	  <code>-mno-rtd</code> are now accepted as negative versions
	  of <code>-mshort</code>, etc.</li>
    </ul>
  <h4>Other improvements</h4>
    <ul>
      <li>ColdFire targets now try to maintain a 4-byte-aligned
	  stack where possible.</li>
      <li><code>m68k-uclinux</code> targets now try to avoid
	  situations that lead to the load-time error:
	  <code>BINFMT_FLAT: reloc outside program</code>.</li>
    </ul>

<h3>SPU (Synergistic Processor Unit) of the Cell Broadband Engine
    Architecture (BEA)</h3>
  <ul>
    <li>Support has been added for this new architecture.</li>
  </ul>


<h2>Documentation improvements</h2>

<h2>Other significant improvements</h2>

  <ul>
    <li><p>The compiler's <code>--help</code> command line option has
    been extended so that it now takes an optional set of arguments.
    These arguments restrict the information displayed to specific
    classes of command line options, and possibly only a subset of
    those options.  It is also now possible to replace the descriptive
    text associated with each displayed option with an indication of
    its current value, or for binary options, whether it has been
    enabled or disabled.</p>

    <p>Here are some examples.  The following will display all the
    options controlling warning messages:</p>
    <pre>
      --help=warnings
    </pre>

    <p>Whereas this will display all the undocumented, target specific
    options:</p>
    <pre>
      --help=target,undocumented
    </pre>

    <p>This sequence of commands will display the binary
    optimizations that are enabled by <code>-O3</code>:</p>
    <pre>
      gcc -c -Q -O3 --help=optimizers &gt; /tmp/O3-opts
      gcc -c -Q -O2 --help=optimizers &gt; /tmp/O2-opts
      diff /tmp/O2-opts /tmp/O3-opts | grep enabled
    </pre>
    </li>
  </ul>

</body>
</html>
