<html>

<head>
<title>GCC 4.8 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.8 Release Series<br />Changes, New Features, and Fixes</h1>


<h2>Caveats</h2>
<p>GCC now uses C++ as its implementation language.  This means that
to build GCC from sources, you will need a C++ compiler that
understands C++ 2003. For more details on the rationale and specific
changes, please refer to the <a
href="http://gcc.gnu.org/wiki/cxx-conversion">C++ conversion</a>
page.</p>

<p>To enable the Graphite framework for loop optimizations you now
need CLooG version 0.17.0 and ISL version 0.10.  Both can be obtained
from the
<a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">GCC infrastructure</a>
directory.  The installation manual contains
more information about requirements to build GCC.</p>

<p>The G++ namespace association extension, <code>__attribute ((strong))</code>,
has been deprecated. Inline namespaces should be used instead.</p>

<p>On ARM, a bug has been fixed in GCC's implementation of the AAPCS
rules for the layout of vectors that could lead to wrong code being
generated.  Vectors larger than 8 bytes in size are now by default
aligned to an 8-byte boundary.  This is an ABI change: code that makes
explicit use of vector types may be incompatible with binary objects
built with older versions of GCC.  Auto-vectorized code is not affected
by this change.</p>

<h2>General Optimizer Improvements (and Changes)</h2>

  <ul>
    <li>A new option <code>-ftree-partial-pre</code> was added to control
      the partial redundancy elimination (PRE) optimization.
      This option is enabled by default at the <code>-O3</code> optimization
      level, and it makes PRE more aggressive.
    </li>
    <li>The struct reorg and matrix reorg optimizations (command-line
    options <code>-fipa-struct-reorg</code> and 
    <code>-fipa-matrix-reorg</code>) have been removed.  They did not
    work correctly nor with link-time optimization (LTO), hence were only
    applicable to programs consisting of a single translation unit.</li>
  </ul>


<h2>New Languages and Language specific improvements</h2>

<!--
<h3>Ada</h3>
-->


<h3>C family</h3>

  <ul>
    <li>The option <code>-ftrack-macro-expansion=2</code> is now
    enabled by default. This allows the compiler to display the
    macro expansion stack in diagnostics.</li>
  </ul>

<!--
<h3>C</h3>
-->


<!--
<a name="cxx" />
<h3>C++</h3>
-->

<h3 id="fortran">Fortran</h3>
  <ul>
    <li>The <code><a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    -Wc-binding-type</a></code> warning flag has been added (by default
    disabled), which warns if the a variable might not be C interoperable. In
    particular, if the variable has been declared using an intrinsic type with
    default kind instead of using a kind parameter defined for C
    interoperability in the intrinsic <code>ISO_C_Binding</code> module. Before,
    the warning was always printed.</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wrealloc-lhs</code></a> and <code>-Wrealloc-lhs-all</code> warning
    flags have been added, which diagnose when code to is inserted for automatic
    (re)allocation of a variable during assignment. The flag can be used to
    decide whether it is safe to use <code><a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html">
    -fno-realloc-lhs</a></code>. Additionally, it can be used to find automatic
    (re)allocation in hot loops. (For arrays, replacing <q><code>var=</code></q>
    by <q><code>var(:)=</code></q> disables the automatic reallocation.)</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wcompare-reals</code></a> flag has been added. When this flag is set,
    warnings are issued when comparing <code>REAL</code> or
    <code>COMPLEX</code> types for equality and inequality; consider replacing
    <code>a == b</code> by <code>abs(a&minus;b) &lt; eps</code> with a suitable
    <code>eps</code>. The -Wcompare-reals flag is enabled by
    <code>-Wall</code>.</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wtarget-lifetime</code></a> flag has been added (enabled with
    <code>-Wall</code>), which warns if the pointer in a pointer assignment
    might outlive its target.</li>

    <li><p>Reading floating point numbers which use <q><code>q</code></q> for
    the exponential (such as <code>4.0q0</code>) is now supported as vendor
    extension for better compatibility with old data files. It is strongly
    recommended to use for I/O the equivalent but standard conforming
    <q><code>e</code></q> (such as <code>4.0e0</code>).</p>

    <p>(For Fortran
    source code, consider replacing the <q><code>q</code></q> in
    floating-point literals by a kind parameter (e.g. <code>4.0e0_qp</code>
    with a suitable <code>qp</code>). Note that &ndash; in Fortran
    source code &ndash; replacing <q><code>q</code></q> by a simple
    <q><code>e</code></q> is <em>not</em> equivalent.)</p></li>

    <li>The <code>GFORTRAN_TMPDIR</code> environment variable for specifying
    a non-default directory for files opened with <code>STATUS="SCRATCH"</code>,
    is not used anymore. Instead gfortran checks the POSIX/GNU standard
    <code>TMPDIR</code> environment variable. If <code>TMPDIR</code> is not
    defined, gfortran falls back to other methods to determine the directory
    for temporary files as documented in the
    <a href="http://gcc.gnu.org/onlinedocs/gfortran/TMPDIR.html">user
    manual</a>.</li>

    <li><a href="http://gcc.gnu.org/wiki/TS29113Status">TS 29113</a>:
    <ul>
      <li>Assumed types (<code>TYPE(*)</code>) are now supported.</li>

      <li>Experimental support for assumed-rank arrays
      (<code>dimension(..)</code>) has been added. Note that currently
      gfortran's own array descriptor is used, which is different from the
      one defined in TS29113, see <a
      href="http://gcc.gnu.org/viewcvs/trunk/libgfortran/libgfortran.h?content-type=text%2Fplain&amp;view=co">
      gfortran's header file</a> or use the <a
      href="http://chasm-interop.sourceforge.net/">Chasm Language
      Interoperability Tools</a>.</li>
    </ul></li>
  </ul>

<!--
<h3>Java (GCJ)</h3>
-->

<h2 id="targets">New Targets and Target Specific Improvements</h2>

<h3>IA-32/x86-64</h3>
  <ul>
    <li>Allow <code>-mpreferred-stack-boundary=3</code> for the x86-64
    architecture with SSE extensions disabled.  Since the x86-64 ABI
    requires 16 byte stack alignment, this is ABI incompatible and
    intended to be used in controlled environments where stack space
    is an important limitation.
    This option will lead to wrong code when functions compiled with 16 byte
    stack alignment (such as functions from a standard library) are called
    with misaligned stack.  In this case, SSE instructions may lead to
    misaligned memory access traps.  In addition, variable arguments will
    be handled incorrectly for 16 byte aligned objects (including x87
    <code>long double</code> and <code>__int128</code>), leading to
    wrong results.  You must build all
    modules with <code>-mpreferred-stack-boundary=3</code>, including any
    libraries.  This includes the system libraries and startup modules.</li>
    <li> New built-in functions to detect run-time CPU type and ISA:
    <ul>
      <li>A built-in function <code>__builtin_cpu_is</code> has been added to
      detect if the run-time CPU is of a particular type.  It returns a
      positive integer on a match and zero otherwise.  It accepts one string
      literal argument, the CPU name.  For example,
      <code>__builtin_cpu_is("westmere")</code> returns a positive integer if
      the run-time CPU is an Intel Core i7 Westmere processor.  Please refer
      to the <a
      href="http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html#X86-Built_002din-Functions">
      user manual</a> for the list of valid CPU names recognized.</li>
      <li>A built-in function <code>__builtin_cpu_supports</code> has been
      added to detect if the run-time CPU supports a particular ISA feature.
      It returns a positive integer on a match and zero otherwise.  It accepts
      one string literal argument, the ISA feature.  For example,
      <code>__builtin_cpu_supports("ssse3")</code> returns a positive integer
      if the run-time CPU supports SSSE3 instructions.  Please refer to the <a
      href="http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html#X86-Built_002din-Functions">
      user manual</a> for the list of valid ISA names recognized.</li>
    </ul>
    <p>Caveat: If these built-in functions are called before any static
    constructors are invoked, like during IFUNC initialization, then the CPU
    detection initialization must be explicitly run using this newly provided
    built-in function,  <code>__builtin_cpu_init</code>.  The initialization
    needs to be done only once.  For example, this is how the invocation would
    look like inside an IFUNC initializer:</p>
    <pre>
    static void (*some_ifunc_resolver(void))(void)
    {
      __builtin_cpu_init();
      if (__builtin_cpu_is("amdfam10h") ...
      if (__builtin_cpu_supports("popcnt") ...
    }
    </pre>
    </li>
  </ul>

<h3 id="frv">FRV</h3>

  <ul>
    <li>This target now supports the <code>-fstack-usage</code> 
    command-line option.</li>
  </ul>

<h3 id="mips">MIPS</h3>
  <ul>
    <li>GCC now passes the <code>-mmcu</code> and <code>-mno-mcu</code>
    options to the assembler.</li>
    <li>Support for the R4700 has been added.</li>
  </ul>

<h3 id="sh">SH</h3>
  <ul>
    <li>The default alignment settings have been reduced to be less aggressive.
    This results in more compact code for optimization levels other than
    <code>-Os</code>.</li>

    <li>Improved support for the <code>__atomic</code> built-in functions:
    <ul>
      <li>Minor improvements to code generated for software atomic sequences
      that are enabled by <code>-msoft-atomic</code>.</li>

      <li>A new option <code>-mtas</code> makes the compiler generate
      the <code>tas.b</code> instruction for the
      <code>__atomic_test_and_set</code> built-in function.</li>

      <li>The SH4A instructions <code>movco.l</code> and
      <code>movli.l</code> are now supported.  They are used to implement some
      software atomic sequences that are enabled by <code>-msoft-atomic</code>.
      In addition to that, pure <code>movco.l</code> / <code>movli.l</code>
      atomic sequences can be enabled with the new option
      <code>-mhard-atomic</code>.</li>
    </ul></li>

    <li>Added support for the <code>mov.b</code> and <code>mov.w</code>
    instructions with displacement addressing.</li>

    <li>Added support for the SH2A instructions <code>movu.b</code> and
    <code>movu.w</code>.</li>

    <li>Various improvements to code generated for integer arithmetic.</li>

    <li>Improvements to conditional branches and code that involves the T bit.
    A new option <code>-mzdcbranch</code> tells the compiler to favor
    zero-displacement branches.  This is enabled by default for SH4 and
    SH4A.</li>

    <li>The <code>pref</code> instruction will now be emitted by the
    <code>__builtin_prefetch</code> built-in function for SH3.</li>

    <li>The <code>fmac</code> instruction will now be emitted by the
    <code>fmaf</code> standard function and the <code>__builtin_fmaf</code>
    built-in function.</li>

    <li>The <code>-mfused-madd</code> option has been deprecated in favor of
    the machine-independent <code>-ffp-contract</code> option.  Notice that the
    <code>fmac</code> instruction will now be generated by default for
    expressions like <code>a * b + c</code>.  This is due to the compiler
    default setting <code>-ffp-contract=fast</code>.</li>

    <li>Added new options <code>-mfsrra</code> and <code>-mfsca</code> to allow
    the compiler using the <code>fsrra</code> and <code>fsca</code>
    instructions on CPUs other than SH4A (where they are already enabled by
    default).</li>

    <li>Added support for the <code>__builtin_bswap32</code> built-in function.
    It is now expanded as a sequence of <code>swap.b</code> and
    <code>swap.w</code> instructions instead of a library function call.</li>

    <li>The behavior of the <code>-mieee</code> option has been fixed and the
    negative form <code>-mno-ieee</code> has been added to control the IEEE
    conformance of floating point comparisons.  By default <code>-mieee</code>
    is now enabled and the option <code>-ffinite-math-only</code> implicitly
    sets <code>-mno-ieee</code>.</li>

  </ul>

<h3 id="sparc">SPARC</h3>

  <ul>
    <li>Added optimized instruction scheduling for Niagara4.</li>
  </ul>

<h3 id="stormy">XStormy16</h3>

  <ul>
    <li>This target now supports the <code>-fstack-usage</code> 
    command-line option.</li>
  </ul>

<!--
<h2>Documentation improvements</h2>
-->


<!--
<h2>Other significant improvements</h2>

-->

</body>
</html>
