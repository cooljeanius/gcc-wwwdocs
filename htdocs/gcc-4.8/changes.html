<html>

<head>
<title>GCC 4.8 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.8 Release Series<br />Changes, New Features, and Fixes</h1>


<h2>Caveats</h2>
<p>GCC now uses C++ as its implementation language.  This means that
to build GCC from sources, you will need a C++ compiler that
understands C++ 2003. For more details on the rationale and specific
changes, please refer to the <a
href="http://gcc.gnu.org/wiki/cxx-conversion">C++ conversion</a>
page.</p>

<p>To enable the Graphite framework for loop optimizations you now
need CLooG version 0.17.0 and ISL version 0.10.  Both can be obtained
from the
<a href="ftp://gcc.gnu.org/pub/gcc/infrastructure/">GCC infrastructure</a>
directory.  The installation manual contains
more information about requirements to build GCC.</p>

<p>The G++ namespace association extension, <code>__attribute ((strong))</code>,
has been deprecated. Inline namespaces should be used instead.</p>

<p>On ARM, a bug has been fixed in GCC's implementation of the AAPCS
rules for the layout of vectors that could lead to wrong code being
generated.  Vectors larger than 8 bytes in size are now by default
aligned to an 8-byte boundary.  This is an ABI change: code that makes
explicit use of vector types may be incompatible with binary objects
built with older versions of GCC.  Auto-vectorized code is not affected
by this change.</p>

<p>On AVR, support has been removed for the command-line
  option <code>-mshort-calls</code> deprecated in GCC 4.7.</p>

<p>On AVR, the configure option <code>--with-avrlibc</code> supported since
  GCC 4.7.2 is turned on per default for all non-RTEMS configurations.
  This option arranges for a better integration of
  <a href="http://www.nongnu.org/avr-libc/">AVR Libc</a> with avr-gcc.
  For technical details, see <a href="http://gcc.gnu.org/PR54461">PR54461</a>.
  To turn off the option in non-RTEMS configurations, use
  <code>--with-avrlibc=no</code>.  If the compiler is configured for
  RTEMS, the option is always turned off.</p>

<h2>General Optimizer Improvements (and Changes)</h2>

  <ul>
    <li>DWARF4 is now the default when generating DWARF debug information.
      When -g is used on a platform that uses DWARF debugging information,
      GCC will now default to -gdwarf-4 -fno-debug-types-section.
      GDB 7.5, Valgrind 3.8.0 and elfutils 0.154 debug information consumers
      support DWARF4 by default. Before GCC 4.8 the default version used
      was DWARF2. To make GCC 4.8 generate an older DWARF version use -g
      together with -gdwarf-2 or -gdwarf-3. The default for Darwin and
      VxWorks is still -g-dwarf2 -gstrict-dwarf.
    </li>
    <li>A new general optimization level, <code>-Og</code>, has been
      introduced.  It addresses the need for fast compilation and a
      superior debugging experience while providing a reasonable level
      of runtime performance.  Overall experience for development should
      be better than the default optimization level <code>-O0</code>.
    </li>
    <li>A new option <code>-ftree-partial-pre</code> was added to control
      the partial redundancy elimination (PRE) optimization.
      This option is enabled by default at the <code>-O3</code> optimization
      level, and it makes PRE more aggressive.
    </li>
    <li>The option <code>-fconserve-space</code> has been removed; it
      was no longer useful on most targets since GCC supports putting
      variables into BSS without making them common.</li>
    <li>The struct reorg and matrix reorg optimizations (command-line
     options <code>-fipa-struct-reorg</code> and 
     <code>-fipa-matrix-reorg</code>) have been removed.  They did not
     work correctly nor with link-time optimization (LTO), hence were only
     applicable to programs consisting of a single translation unit.
    </li>
    <li>Several scalability bottle-necks have been removed from GCC's
     optimization passes.  Compilation of extremely large functions,
     e.g. due to the use of the <code>flatten</code> attribute in the
     "Eigen" C++ linear algebra templates library, is significantly
     faster than previous releases of GCC.
    </li>
    <li>Link-time optimization (LTO) improvements:
    <ul>
     <li>LTO partitioning has been rewritten for better reliability
	 and maintanibility. Several important bugs leading to link
	 failures have been fixed.</li>
    </ul></li>
    <li>Interprocedural optimization improvements:
    <ul>
     <li>A new symbol table has been implemented. It
	 builds on existing callgraph and varpool modules and 
	 provide a new API. Unusual symbol visibilities and aliases
	 are handled more consistently leading to, for example,
	 more aggressive unreachable code removal with LTO.</li>
     <li>The inline heuristic can now bypass limits on the size of
	 of inlined functions when the inlining is particularly profitable.
	 This happens, for example, when loop bounds or array strides
	 get propagated.</li>
     <li>Values passed through aggregates (either by value or reference)
	 are now propagated at the inter-procedural level leading to better
	 inlining decisions (for example in the case of Fortran
	 array descriptors) and devirtualization.</li>
    </ul></li>
  </ul>


<h2>New Languages and Language specific improvements</h2>

<!--
<h3>Ada</h3>
-->


<h3>C family</h3>

  <ul>
    <li>The option <code>-ftrack-macro-expansion=2</code> is now
    enabled by default. This allows the compiler to display the
    macro expansion stack in diagnostics.</li>
  </ul>

<!--
<h3>C</h3>
-->


<a name="cxx" />
<h3>C++</h3>
<ul>
  <li>G++ now implements the <a href="cxx0x_status.html">C++11</a> 
    <code>thread_local</code> keyword; this differs from the
    GNU <code>__thread</code> keyword primarily in that it allows dynamic
    initialization and destruction semantics.  Unfortunately, this support
    requires a run-time penalty for references to non-function-local
    <code>thread_local</code> variables even if they don't need dynamic
    initialization, so users may want to continue to
    use <code>__thread</code> for TLS variables with static initialization
    semantics.

    OpenMP <code>threadprivate</code> variables now also support dynamic
    initialization and destruction by the same mechanism.</li>

  <li>G++ now implements the <a href="cxx0x_status.html">C++11</a> 
    attribute syntax, e.g.
<blockquote><pre>
[[noreturn]] void f();
</pre></blockquote>
and also the alignment specifier, e.g.
<blockquote><pre>
alignas(double) int i;
</pre></blockquote></li>

  <li>G++ now implements <a href="cxx0x_status.html">C++11</a> inheriting constructors, e.g.
<blockquote><pre>
struct A { A(int); };
struct B: A { using A::A; }; // defines B::B(int)
B b(42); // OK
</pre></blockquote>
  </li>

  <li>G++ now supports a <code>-std=c++1y</code> option for experimentation
    with features proposed for the next revision of the standard, expected
    around 2017.  Currently the only difference from <code>-std=c++11</code>
    is support for return type deduction in normal functions, as proposed in 
    <a href="http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2012/n3386.html">N3386</a>.</li>

  <li>G++ now supports a <code>-fext-numeric-literal</code> option to control
    whether GNU numeric literal suffixes are accepted as extensions or processed
    as C++11 user-defined numeric literal suffixes.  The flag is on
    (use suffixes for GNU  literals) by default for <code>-std=gnu++*</code>,
    and <code>-std=c++98</code>.  The flag is off (use suffixes for user-defined
    literals) by default for <code>-std=c++11</code> and later.</li>
</ul>

<h3 id="fortran">Fortran</h3>
  <ul>
    <li>The <code><a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    -Wc-binding-type</a></code> warning option has been added (disabled
    by default), which warns if the a variable might not be C interoperable. In
    particular, if the variable has been declared using an intrinsic type with
    default kind instead of using a kind parameter defined for C
    interoperability in the intrinsic <code>ISO_C_Binding</code> module. Before,
    the warning was always printed. The <code>-Wc-binding-type</code> option
    is enabled by <code>-Wall</code>.</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wrealloc-lhs</code></a> and <code>-Wrealloc-lhs-all</code> warning
    command-line options have been added, which diagnose when code to is
    inserted for automatic (re)allocation of a variable during assignment.
    This option can be used to decide whether it is safe to use <code><a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html">
    -fno-realloc-lhs</a></code>. Additionally, it can be used to find automatic
    (re)allocation in hot loops. (For arrays, replacing <q><code>var=</code></q>
    by <q><code>var(:)=</code></q> disables the automatic reallocation.)</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wcompare-reals</code></a> command-line option has been added. When
    this is set, warnings are issued when comparing <code>REAL</code> or
    <code>COMPLEX</code> types for equality and inequality; consider replacing
    <code>a == b</code> by <code>abs(a&minus;b) &lt; eps</code> with a suitable
    <code>eps</code>. <code>-Wcompare-reals</code> is enabled by
    <code>-Wextra</code>.</li>

    <li>The <a
    href="http://gcc.gnu.org/onlinedocs/gfortran/Error-and-Warning-Options.html">
    <code>-Wtarget-lifetime</code></a> command-line option has been added
    (enabled with <code>-Wall</code>), which warns if the pointer in a
    pointer assignment might outlive its target.</li>

    <li><p>Reading floating point numbers which use <q><code>q</code></q> for
    the exponential (such as <code>4.0q0</code>) is now supported as vendor
    extension for better compatibility with old data files. It is strongly
    recommended to use for I/O the equivalent but standard conforming
    <q><code>e</code></q> (such as <code>4.0e0</code>).</p>

    <p>(For Fortran
    source code, consider replacing the <q><code>q</code></q> in
    floating-point literals by a kind parameter (e.g. <code>4.0e0_qp</code>
    with a suitable <code>qp</code>). Note that &ndash; in Fortran
    source code &ndash; replacing <q><code>q</code></q> by a simple
    <q><code>e</code></q> is <em>not</em> equivalent.)</p></li>

    <li>The <code>GFORTRAN_TMPDIR</code> environment variable for specifying
    a non-default directory for files opened with <code>STATUS="SCRATCH"</code>,
    is not used anymore. Instead gfortran checks the POSIX/GNU standard
    <code>TMPDIR</code> environment variable. If <code>TMPDIR</code> is not
    defined, gfortran falls back to other methods to determine the directory
    for temporary files as documented in the
    <a href="http://gcc.gnu.org/onlinedocs/gfortran/TMPDIR.html">user
    manual</a>.</li>

    <li><a href="http://gcc.gnu.org/wiki/TS29113Status">TS 29113</a>:
    <ul>
      <li>Assumed types (<code>TYPE(*)</code>) are now supported.</li>

      <li>Experimental support for assumed-rank arrays
      (<code>dimension(..)</code>) has been added. Note that currently
      gfortran's own array descriptor is used, which is different from the
      one defined in TS29113, see <a
      href="http://gcc.gnu.org/viewcvs/trunk/libgfortran/libgfortran.h?content-type=text%2Fplain&amp;view=co">
      gfortran's header file</a> or use the <a
      href="http://chasm-interop.sourceforge.net/">Chasm Language
      Interoperability Tools</a>.</li>
    </ul></li>
  </ul>

<!--
<h3>Java (GCJ)</h3>
-->

<h2 id="targets">New Targets and Target Specific Improvements</h2>

<h3>IA-32/x86-64</h3>
  <ul>
    <li>Allow <code>-mpreferred-stack-boundary=3</code> for the x86-64
    architecture with SSE extensions disabled.  Since the x86-64 ABI
    requires 16 byte stack alignment, this is ABI incompatible and
    intended to be used in controlled environments where stack space
    is an important limitation.
    This option will lead to wrong code when functions compiled with 16 byte
    stack alignment (such as functions from a standard library) are called
    with misaligned stack.  In this case, SSE instructions may lead to
    misaligned memory access traps.  In addition, variable arguments will
    be handled incorrectly for 16 byte aligned objects (including x87
    <code>long double</code> and <code>__int128</code>), leading to
    wrong results.  You must build all
    modules with <code>-mpreferred-stack-boundary=3</code>, including any
    libraries.  This includes the system libraries and startup modules.</li>
    <li> New built-in functions to detect run-time CPU type and ISA:
    <ul>
      <li>A built-in function <code>__builtin_cpu_is</code> has been added to
      detect if the run-time CPU is of a particular type.  It returns a
      positive integer on a match and zero otherwise.  It accepts one string
      literal argument, the CPU name.  For example,
      <code>__builtin_cpu_is("westmere")</code> returns a positive integer if
      the run-time CPU is an Intel Core i7 Westmere processor.  Please refer
      to the <a
      href="http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html#X86-Built_002din-Functions">
      user manual</a> for the list of valid CPU names recognized.</li>
      <li>A built-in function <code>__builtin_cpu_supports</code> has been
      added to detect if the run-time CPU supports a particular ISA feature.
      It returns a positive integer on a match and zero otherwise.  It accepts
      one string literal argument, the ISA feature.  For example,
      <code>__builtin_cpu_supports("ssse3")</code> returns a positive integer
      if the run-time CPU supports SSSE3 instructions.  Please refer to the <a
      href="http://gcc.gnu.org/onlinedocs/gcc/X86-Built_002din-Functions.html#X86-Built_002din-Functions">
      user manual</a> for the list of valid ISA names recognized.</li>
    </ul>
    <p>Caveat: If these built-in functions are called before any static
    constructors are invoked, like during IFUNC initialization, then the CPU
    detection initialization must be explicitly run using this newly provided
    built-in function,  <code>__builtin_cpu_init</code>.  The initialization
    needs to be done only once.  For example, this is how the invocation would
    look like inside an IFUNC initializer:</p>
    <pre>
    static void (*some_ifunc_resolver(void))(void)
    {
      __builtin_cpu_init();
      if (__builtin_cpu_is("amdfam10h") ...
      if (__builtin_cpu_supports("popcnt") ...
    }
    </pre>
    </li>
    <li> Function Multiversioning Support with G++:
    <p>It is now possible to create multiple function versions each targeting a
    specific processor and/or ISA.  Function versions have the same signature
    but different target attributes.  For example, here is a program with
    function versions:</p>
    <pre>
    int foo(void)
    {
      return 1;
    }

    __attribute__ ((target ("sse4.2")))
    int foo(void)
    {
      return 2;
    }

    int main (void)
    {
      int (*p) = &amp;foo;
      assert ((*p)() == foo());
      return 0;
    }
    </pre>
    Please refer to this
    <a href="http://gcc.gnu.org/wiki/FunctionMultiVersioning">wiki</a> for more
    information.
    </li>
  </ul>

<h3 id="frv">FRV</h3>

  <ul>
    <li>This target now supports the <code>-fstack-usage</code> 
    command-line option.</li>
  </ul>

<h3 id="mips">MIPS</h3>
  <ul>
    <li>GCC now passes the <code>-mmcu</code> and <code>-mno-mcu</code>
    options to the assembler.</li>
    <li>Support for the R4700 has been added.</li>
  </ul>

<h3 id="powerpc">PowerPC / PowerPC64 / RS6000</h3>
  <ul>
    <li>SVR4 configurations (GNU/Linux, FreeBSD, NetBSD) no longer save,
    restore or update the VRSAVE register by default.  The respective
    operating systems manage the VRSAVE register directly.</li>
  </ul>

<h3 id="rx">RX</h3>
  <ul>
    <li>This target will now issue a warning message whenever multiple fast
    interrupt handlers are found in the same cpmpilation unit.  This feature can
    be turned off by the new <code>-mno-warn-multiple-fast-interrupts</code>
    command-line option.</li>
  </ul>

<h3>S/390, System z</h3>
  <ul>
    <li>Support for the IBM zEnterprise zEC12 processor has been
      added.  When using the <code>-march=zEC12</code> option, the
      compiler will generate code making use of the following new
      instructions:
      <ul>
	<li>load and trap instructions</li>
	<li>2 new compare and trap instructions</li>
	<li>rotate and insert selected bits - without CC clobber</li>
      </ul>
      The <code>-mtune=zEC12</code> option enables zEC12 specific
      instruction scheduling without making use of new
      instructions.</li>
    <li>Register pressure sensitive instruction scheduling is enabled
      by default.</li>
    <li>The <code>ifunc</code> function attribute is enabled by default.</li>
    <li><code>memcpy</code> and <code>memcmp</code> invokations on big
      memory chunks or with run time lengths are not generated inline
      anymore when tuning for z10 or higher.  The purpose is to make
      use of the IFUNC optimized versions in Glibc.</li>
  </ul>

<h3 id="sh">SH</h3>
  <ul>
    <li>The default alignment settings have been reduced to be less aggressive.
    This results in more compact code for optimization levels other than
    <code>-Os</code>.</li>

    <li>Improved support for the <code>__atomic</code> built-in functions:
    <ul>
      <li>A new option <code>-matomic-model=<i>model</i></code> selects the
      model for the generated atomic sequences.  The following models are
      supported:
      <dl>
        <dt><code>soft-gusa</code></dt><dd>
        Software gUSA sequences (SH3* and SH4* only).  On SH4A targets this
        will now also partially utilize the <code>movco.l</code> and
        <code>movli.l</code> instructions.  This is the default when the target
        is <code>sh3*-*-linux*</code> or <code>sh4*-*-linux*</code>.</dd>

        <dt><code>hard-llcs</code></dt><dd>
        Hardware <code>movco.l</code> / <code>movli.l</code> sequences
        (SH4A only).</dd>

        <dt><code>soft-tcb</code></dt><dd>
        Software thread control block sequences.</dd>

        <dt><code>soft-imask</code></dt><dd>
        Software interrupt flipping sequences (privileged mode only).  This
        is the default when the target is <code>sh1*-*-linux*</code> or
        <code>sh2*-*-linux*</code>.</dd>

        <dt><code>none</code></dt><dd>
        Generates function calls to the respective <code>__atomic</code>
        built-in functions.  This is the default for SH64 targets or when
        the target is not <code>sh*-*-linux*</code>.</dd>
      </dl></li>

      <li>The option <code>-msoft-atomic</code> has been deprecated.  It is
      now an alias for <code>-matomic-model=soft-gusa</code>.</li>

      <li>A new option <code>-mtas</code> makes the compiler generate
      the <code>tas.b</code> instruction for the
      <code>__atomic_test_and_set</code> built-in function regardless of the
      selected atomic model.</li>

      <li>The <code>__sync</code> functions in <code>libgcc</code> now reflect
      the selected atomic model when building the toolchain.</li>

    </ul></li>

    <li>Added support for the <code>mov.b</code> and <code>mov.w</code>
    instructions with displacement addressing.</li>

    <li>Added support for the SH2A instructions <code>movu.b</code> and
    <code>movu.w</code>.</li>

    <li>Various improvements to code generated for integer arithmetic.</li>

    <li>Improvements to conditional branches and code that involves the T bit.
    A new option <code>-mzdcbranch</code> tells the compiler to favor
    zero-displacement branches.  This is enabled by default for SH4* targets.
    </li>

    <li>The <code>pref</code> instruction will now be emitted by the
    <code>__builtin_prefetch</code> built-in function for SH3* targets.</li>

    <li>The <code>fmac</code> instruction will now be emitted by the
    <code>fmaf</code> standard function and the <code>__builtin_fmaf</code>
    built-in function.</li>

    <li>The <code>-mfused-madd</code> option has been deprecated in favor of
    the machine-independent <code>-ffp-contract</code> option.  Notice that the
    <code>fmac</code> instruction will now be generated by default for
    expressions like <code>a * b + c</code>.  This is due to the compiler
    default setting <code>-ffp-contract=fast</code>.</li>

    <li>Added new options <code>-mfsrra</code> and <code>-mfsca</code> to allow
    the compiler using the <code>fsrra</code> and <code>fsca</code>
    instructions on targets other than SH4A (where they are already enabled by
    default).</li>

    <li>Added support for the <code>__builtin_bswap32</code> built-in function.
    It is now expanded as a sequence of <code>swap.b</code> and
    <code>swap.w</code> instructions instead of a library function call.</li>

    <li>The behavior of the <code>-mieee</code> option has been fixed and the
    negative form <code>-mno-ieee</code> has been added to control the IEEE
    conformance of floating point comparisons.  By default <code>-mieee</code>
    is now enabled and the option <code>-ffinite-math-only</code> implicitly
    sets <code>-mno-ieee</code>.</li>

    <li>Added support for the built-in functions
    <code>__builtin_thread_pointer</code> and
    <code>__builtin_set_thread_pointer</code>.  This assumes that
    <code>GBR</code> is used to hold the thread pointer of the current thread,
    which has been the case for a while already.  Memory loads and stores
    relative to the address returned by <code>__builtin_thread_pointer</code>
    will now also utilize <code>GBR</code> based displacement address modes.
    </li>

  </ul>

<h3 id="sparc">SPARC</h3>

  <ul>
    <li>Added optimized instruction scheduling for Niagara4.</li>
  </ul>

<h3 id="tilegx">TILE-Gx</h3>

  <ul>
    <li>Added support for the <code>-mcmodel=<i>MODEL</i></code>
    command-line option.  The models supported are <code>small</code>
    and <code>large</code>.</li>
  </ul>

<h3 id="xstormy16">XStormy16</h3>

  <ul>
    <li>This target now supports the <code>-fstack-usage</code> 
    command-line option.</li>
  </ul>

<!--
<h2>Documentation improvements</h2>
-->


<!--
<h2>Other significant improvements</h2>

-->

</body>
</html>
