<html>
  <head>
    <title>How to test GCC on a simulator</title>
  </head>

  <body>
    <h1>How to test GCC on a simulator</h1>

    <p>Suppose you want to test GCC on some strange target, for which you
    don't have hardware.  Let's pick ARM as an example.  You can do it
    like this:</p>

    <h2>Create a combined tree.</h2>

    <p>I'm assuming you're starting from scratch, so you don't have an
    installed binutils or newlib for the strange target.  So you'll need
    to build these.  You can't easily build newlib outside a combined
    tree.  Start in an empty directory, then do this:</p>
<pre>
mkdir gcc src combined
cd gcc
cvs -d :pserver:anoncvs@gcc.gnu.org:/cvs/gcc co gcc-full
cd ../src
cvs -d :pserver:anoncvs@anoncvs.cygnus.com:/cvs/src co binutils newlib dejagnu gdb
cd src
find . -print | cpio -pdlm ../../combined
cd ../../gcc/gcc
find . -print | cpio -pdlmu ../../combined
cd ../..
</pre>

    <p>This will create, in `combined', a tree which consists of all the
    files from the gcc and binutils/gdb/newlib source trees, with the gcc
    files overriding the binutils/gdb/newlib files when there's a
    conflict.  (It's done this way because the gcc files are the master
    copy.)  To save on disk space, the commands above actually make a tree
    of hard links, rather than duplicating all the files.</p>

    <h2>Build it.</h2>

    <p>The target name suitable for the simulator is usually `*-elf' for a
    target `*'.  There are some exceptions, for instance on powerpc
    it's powerpc-eabi or powerpc-eabisim, and for i960 there isn't an elf
    target yet so i960-coff is probably your best choice.</p>

<pre>
mkdir build install
cd build
../combined/configure --target=arm-elf --prefix=`pwd`/../install
make
</pre>

    <h2>Test it.</h2>

    <p>The only trick here is that you want dejagnu to use the simulator,
    not try running the output on the build system.  For example:</p>
<pre>
make check-gcc RUNTESTFLAGS=--target_board=arm-sim
</pre>
    <p>The only reliable way (apart from guessing that it's probably
    `*-sim') to find out the name of the target board is to look in the
    dejagnu sources, in dejagnu/baseboards, for something that looks
    right.  Or you can use this table of combinations that at one time
    compiled, usable as test-targets with the instructions above:</p>

<table border="0" cellspacing="5" cellpadding="5" align="left">
<tr valign="top" align="left">
 <th>Target</th><th>Simulator</th><th>Verified</th><th>Comment</th>
</tr>

<tr valign="top">
 <td>arm-elf</td>
 <td>arm-sim</td>
 <td>2001-07-30</td>
 <td>Many unexpected failures for C++: 420 and Fortran: 400.</td>
</tr>

<tr valign="top">
 <td>mips-elf</td>
 <td>mips-sim</td>
 <td>2001-07-31</td>
 <td>Many unexpected failures for C++: 119 and Fortran: 398.</td>
</tr>

<tr valign="top">
 <td>mn10300-elf</td>
 <td>mn10300-sim</td>
 <td>2001-07-30</td>
 <td>CC0 target.  Many unexpected failures for Fortran: 40 and ObjC: 72.</td>
</tr>

<tr valign="top">
 <td>powerpc-eabisim</td>
 <td>powerpc-sim</td>
 <td>Daily build</td>
 <td>This target is used by <a
 href="http://www.cygnus.com/~geoffk/gcc-regression/">an automatic
 regression tester</a>.  It'll complain to you by email if you break it.
 Many unexpected Fortran failures on 2001-07-30: 60.</td>
</tr>

</table>
  </body>
</html>
