<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>The Cygnus Native Interface for C++/Java Integration</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet version 1.13"><LINK
REL="NEXT"
TITLE="Packages"
HREF="t134.html"></HEAD
><BODY
><DIV
CLASS="ARTICLE"
><H1
CLASS="TITLE"
>The Cygnus Native Interface for C++/Java Integration</H1
><H2
CLASS="SUBTITLE"
>Writing native Java methods in natural C++</H2
><P
CLASS="CORPAUTHOR"
><I
>Cygnus Solutions</I
></P
><HR><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="t1.html#AEN10"
>Basic Concepts</A
></DT
><DT
><A
HREF="t134.html"
>Packages</A
></DT
><DT
><A
HREF="t187.html"
>Primitive types</A
></DT
><DT
><A
HREF="t1178.html"
>Objects and Classes</A
></DT
><DT
><A
HREF="t1215.html"
>Arrays</A
></DT
><DT
><A
HREF="t1262.html"
>Methods</A
></DT
><DT
><A
HREF="t1308.html"
>Object allocation</A
></DT
><DT
><A
HREF="t1324.html"
>Interfaces</A
></DT
><DT
><A
HREF="t1331.html"
>Strings</A
></DT
><DT
><A
HREF="t1405.html"
>Class Initialization</A
></DT
><DT
><A
HREF="t1421.html"
>Exception Handling</A
></DT
><DT
><A
HREF="t1442.html"
>Synchronization</A
></DT
><DT
><A
HREF="t1468.html"
>Reflection</A
></DT
><DT
><A
HREF="t1478.html"
>Using gcjh</A
></DT
></DL
></DIV
><BLOCKQUOTE
CLASS="ABSTRACT"
><P
>This documents CNI, the Cygnus Native Interface,
which is is a convenient way to write Java native methods using C++.
This is a more efficient, more convenient, but less portable
alternative to the standard JNI (Java Native Interface).</P
></BLOCKQUOTE
><H1
><A
NAME="AEN10"
>Basic Concepts</A
></H1
><P
>In terms of languages features, Java is mostly a subset
of C++.  Java has a few important extensions, plus a powerful standard
class library, but on the whole that does not change the basic similarity.
Java is a hybrid object-oriented language, with a few native types,
in addition to class types.  It is class-based, where a class may have
static as well as per-object fields, and static as well as instance methods.
Non-static methods may be virtual, and may be overloaded.  Overloading is
resolved at compile time by matching the actual argument types against
the parameter types.  Virtual methods are implemented using indirect calls
through a dispatch table (virtual function table).  Objects are
allocated on the heap, and initialized using a constructor method.
Classes are organized in a package hierarchy.</P
><P
>All of the listed attributes are also true of C++, though C++ has
extra features (for example in C++ objects may be allocated not just
on the heap, but also statically or in a local stack frame).  Because
<SPAN
CLASS="ACRONYM"
>gcj</SPAN
> uses the same compiler technology as
<SPAN
CLASS="ACRONYM"
>g++</SPAN
> (the GNU C++ compiler), it is possible
to make the intersection of the two languages use the same
<SPAN
CLASS="ACRONYM"
>ABI</SPAN
> (object representation and calling conventions).
The key idea in <SPAN
CLASS="ACRONYM"
>CNI</SPAN
> is that Java objects are C++ objects,
and all Java classes are C++ classes (but not the other way around).
So the most important task in integrating Java and C++ is to
remove gratuitous incompatibilities.</P
><P
>You write CNI code as a regular C++ source file.  (You do have to use
a Java/CNI-aware C++ compiler, specifically a recent version of G++.)</P
><P
>You start with:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &#60;cni.h&#62;</PRE
></TD
></TR
></TABLE
></P
><P
>You then include header files for the various Java classes you need
to use:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>#include &#60;java/lang/Character.h&#62;
#include &#60;java/util/Date.h&#62;
#include &#60;java/lang/IndexOutOfBoundsException.h&#62;</PRE
></TD
></TR
></TABLE
></P
><P
>In general, <SPAN
CLASS="ACRONYM"
>CNI</SPAN
> functions and macros start with the
`<TT
CLASS="LITERAL"
>Jv</TT
>' prefix, for example the function
`<TT
CLASS="LITERAL"
>JvNewObjectArray</TT
>'.  This convention is used to
avoid conflicts with other libraries.
Internal functions in <SPAN
CLASS="ACRONYM"
>CNI</SPAN
> start with the prefix
`<TT
CLASS="LITERAL"
>_Jv_</TT
>'.  You should not call these;
if you find a need to, let us know and we will try to come up with an
alternate solution.  (This manual lists <TT
CLASS="LITERAL"
>_Jv_AllocBytes</TT
>
as an example;  <SPAN
CLASS="ACRONYM"
>CNI</SPAN
> should instead provide
a <TT
CLASS="LITERAL"
>JvAllocBytes</TT
> function.)</P
><P
>These header files are automatically generated by <B
CLASS="COMMAND"
>gcjh</B
>.</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="t134.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>