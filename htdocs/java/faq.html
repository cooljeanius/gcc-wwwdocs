<html>
<head>
<title>The GCJ FAQ</title>
</head>

<body bgcolor="#FFFFFF">

<GCJNAV>

 <br>
      <br>
      <h1>The GCJ FAQ</h1>
      <p>The latest version of this document is always available at <a href="faq.html">http://gcc.gnu.org/java/faq.html</a>.</p>
      <p>This FAQ is also available in <a href="faq-portugese.html">Brazilian Portugese</a>.</p>
      <ol>
        <li><a href="#1_0">General Questions</a> 
          <ol>
            <li><a href="#1_1">What license is used for libgcj?</a> 
            <li><a href="#1_2">How can I report a bug in libgcj?</a> 
            <li><a href="#1_3">How can I contribute to libgcj?</a> 
            <li><a href="#1_4">Is libgcj part of GCC?</a> 
            <li><a href="#1_5">Will gcj and libgcj work on my machine?</a> 
            <li><a href="#1_6">How can I debug my Java program?</a> 
            <li><a href="#1_7">Can I interface byte-compiled and native java code?</a>
          </ol>
        <li><a href="#2_0">Java Feature Support</a> 
          <ol>
            <li><a href="#2_1">What Java API's are supported? How complete is 
              the support? </a></li>
            <li><a href="#2_2">Does GCJ support using straight C native methods 
              ala JNI? </a></li>
            <li><a href="#2_3">Why does GCJ use CNI? </a></li>
            <li><a href="#2_4">What is the state of AWT support?</a></li>
            <li><a href="#2_5">How about support for Swing ?</a></li>
            <li><a href="#2_6">What support is there for RMI ?</a></li>
            <li><a href="#2_7">Can I use any code from other OpenSource projects 
              to supplement libgcj's current features ?</a></li>
            <li><a href="#2_8">What features of the Java language are/arn't supported</a></li>
          </ol>
        <li><a href="#3_0">Build Issues</a> 
          <ol>
            <li><a href="#3_1">I need something more recent than the last release; how
                  should I build it?</a>
            <li><a href="#3_2">Linker bug on Solaris</a> 
            <li><a href="#3_3">Can I configure/build in the source tree?</a> 
	    <li><a href="#3_4">My libgcj build fails with "invalid use of undefined type struct sigcontext_struct"</a>
          </ol>
        <li><a href="#4_0">Gcj Compile/Link Questions</a> 
          <ol>
            <li><a href="#4_1">Why do I get <tt>undefined reference to `main'</tt> 
              errors?</a> 
            <li><a href="#4_2">Can GCJ only handle source code? </a> 
            <li><a href="#4_3">&quot;gcj -C" Doesnt seem to work like javac/jikes. 
              Whats going on? </a> 
            <li><a href="#4_4">Where does GCJ look for files? </a> 
            <li><a href="#4_5">How does gcj resolve wether to compile .class or 
              .java files? </a> 
            <li><a href="#4_6">I'm getting link errors!</a> 
	    <li><a href="#4_7">I'm getting 'undefined symbol: __dso_handle'</a>
          </ol>
        <li><a href="#5_0">Runtime Questions</a> 
          <ol>
            <li><a href="#5_1">My program is dumping core! What's going on?</a> 
            <li><a href="#5_2">When I run the debugger I get a SEGV in the GC! 
              What's going on?</a> 
            <li><a href="#5_3">I have just compiled and benchmarked my Java application 
            and it seems to be running slower than than XXX JIT JVM. Is there 
            anything I can do to make it go faster?</a>
            <li><a href="#5_4">Can I profile Garbage Collection? </a> 
            <li><a href="#5_5">How do I increase the runtime's initial and maximum 
              heap sizes?</a> 
            <li><a href="#5_6">How can I profile my application?</a> 
	    <li><a href="#5_7">My program seems to hang and doesn't produce any output</a>
          </ol>
        <li><a href="#6_0">Programing Issues</a> 
          <ol>
            <li><a href="#6_1">Are there any examples of how to use CNI?</a></li>
	    <li><a href="#6_2">Is it possible to invoke GCJ compiled Java code from a C++ application?</a></li>
          </ol>
        </li>
      </ol>
      <table border="0" cellpadding="4" width="95%">
        <tr bgcolor="#b0d0ff"> 
          <th align="left"> 
            <h2><a name="1_0">General Questions</a></h2>
          </th>
        </tr>
      </table>
      <br>
      <dl> 
        <dt> 
          <h3><a name="1_1">1.1 What license is used for libgcj?</a></h3>
        </dt>
        <p> 
        <dd>
          libgcj is distributed under the GPL, with the 'libgcc exception'.
          This means that linking with libgcj does not by itself cause
          your program to fall under the GPL.  See LIBGCJ_LICENSE in
          the source tree for more details.
        </dd>
        <p></p>
        <dt> 
          <hr>
          <h3><a name="1_2">1.2 How can I report a bug in libgcj?</a></h3>
        </dt>
        <p> 
        <dd>libgcj has a corresponding <a
      href="http://gcc.gnu.org/cgi-bin/gnatsweb.pl?user=guest&amp;password=guest&amp;database=gcc&amp;cmd=login">Gnats 
          bug database</a> which you can browse. You can also submit new bug reports 
          from the Gnats page.</dd>
        <p></p>
        <dt> 
          <hr>
          <h3><a name="1_3">1.3 How can I contribute to libgcj?</a></h3>
        </dt>
        <p> 
        <dd>You can send simple bug fixes in as patches. Please follow the <a href="http://gcc.gnu.org/contribute.html">GCC 
          guidelines for submitting patches</a>. For more complex changes, you 
          must sign copyright over to the Free Software Foundation. See the <a href="contrib.html">contribution</a> 
          page for details.</dd>
        <p></p>
        <dt> 
          <hr>
          <h3><a name="1_4">1.4 Is libgcj part of GCC?</a></h3>
        </dt>
        <p> 
        <dd>Yes, libgcj is now part of GCC. It can be downloaded,
        configured and built as one single tree.</dd>
        <p></p>
        <dt> 
          <hr>
          <h3><a name="1_5">1.5 Will gcj and libgcj work on my machine?</a></h3>
        </dt>
        <p> 
        <dd>Gcj and libgcj are known to work more or less with IA-32 and 
          Sparc Solaris, as well as IA-32, Alpha, and PowerPC Linux. 
	  They might work on other systems, but we don't know. 
          Generally speaking, porting to a new system should not be hard. This 
          would be a good way to volunteer.</dd>
        <p></p>
        <dt> 
          <hr>
          <h3><a name="1_6">1.6 How can I debug my Java program?</a></h3>
        </dt>
        <p> 
        <dd><a href="ftp://ftp.gnu.org/pub/gnu/gdb/gdb-4.18.tar.gz">gdb 4.18</a> 
          includes support for debugging gcj-compiled Java programs. For linux, 
          you will need to use a recent development snapshot of gdb from 
	  <a href="ftp://sources.redhat.com/pub/gdb/snapshots/">ftp://sources.redhat.com/pub/gdb/snapshots/</a> 
	  , or the gdb included with Redhat 6.1 and newwer. 
	  The standard 4.18 does not have support for linux threads. 
	  For more information please read 
	  <a href="gdb.html">Java Debugging with gdb</a>.</dd>
        <dt>&nbsp; </dt>

        <dt> 
          <hr>
          <h3><a name="1_7">1.7 Can I interface byte-compiled and native java code</a></h3>
        </dt>
        <p> 
        <dd>
	libgcj has a bytecode interpreter that allows you to mix .class files with
	compiled code. It works pretty transparently: if a compiled version of a class is
	not found in the application binary or linked shared libraries, the class loader
	will search for a bytecode version in your classpath, much like a VM would. Be
	sure to build libgcj with the --enable-interpreter option to enable this
	functionality. Currently this only works on x86 linux. 
        <p>
	<p>The program "gij" provides a front end to the interpreter that behaves
	much like a traditional virtual machine. You can even use "gij" to run a shared library 
	which is compiled from java code and contains a main method:
<pre>
$ gcj -shared -o HelloWorld.so HelloWorld.java
$ gij HelloWorld
</pre>
          This works because gij uses Class.forName, which now knows how to load shared objects.
        </dd>
        <dt>&nbsp; </dt>	
      </dl>
      <table border="0" cellpadding="4" width="95%">
        <tr bgcolor="#B0D0FF"> 
          <th align="left"> 
            <h2><a name="2_0">Java Feature Support</a></h2>
          </th>
        </tr>
      </table>
      <dl> 
      </dl>
      <h3><a name="2_1">2.1 What Java API's are supported?</a> How complete is 
        the support?</h3>
      <dl> 
        <dd> <a href="mailto:mdw@cs.berkeley.edu">Matt Welsh</a> writes:</dd>
        <dl> 
          <dd>Just look in the 'libjava' directory of libgcj and see what classes 
            are there. Most GUI stuff isn't there yet, that's true, but many of 
            the other classes are easy to add if they don't yet exist. </dd>
          <dt>&nbsp;</dt>
          <dd>I think it's important to stress that there is a big difference 
            between Java and the many libraries which Java supports. Unfortunately, 
            Sun's promise of &quot;write once, run everywhere&quot; assumes much 
            more than a JVM: you also need the full set of JDK libraries. Considering 
            that new Java APIs come out every week, it's going to be impossible 
            to track everything. </dd>
          <dt>&nbsp;</dt>
          <dd>To make things worse, you can't simply run Sun's JDK classes on 
            any old JVM -- they assume that a bunch of native methods are also 
            defined. Since this native method requirement isn't defined by the 
            JDK specs, you're effectively constrained to using Sun's JVMs if you 
            want to use Sun's JDK libraries. Oh yes -- you could also reimplement 
            all of those native methods yourself, and make sure they behave exactly 
            as Sun's do. Note that they're undocumented! </dd>
        </dl>
        <dt>&nbsp;</dt>
       </dl>
        </dl>
        <hr>
        <h3><a name="2_2">2.2 </a>Does GCJ support using straight C native methods 
          ala JNI? </h3>
        <blockquote> 
	  <p>Yes. libgcj now has experimental support for JNI, in addition to
	  its native Compiled Native Interface (CNI). gcjh will generate JNI 
	  stubs and headers using the "-jni" option. However, we do 
	  prefer CNI: it is more efficient, easier to write, and (at least 
	  potentially) easier to debug.
        </blockquote>
        <hr>
        <h3><a name="2_3">2.3 </a>Why does GCJ use CNI? </h3>
        <blockquote> 
          <p><a href="mailto:per@bothner.com">Per Bothner</a> explains </p>
          <blockquote> 
            <p>We use CNI because we think it is a better solution, especially 
              for a Java implementation that is based on the idea that Java is 
              just another programming language that can be implemented using 
              standard compilation techniques. Given that, and the idea that languages 
              implemented using Gcc should be compatible where it makes sense, 
              it follows that the Java calling convention should be as similar 
              as practical to that used for other languages, especially C++, since 
              we can think of Java as a subset of C++. CNI is just a set of helper 
              functions and conventions built on the idea that C++ and Java have 
              the *same* calling convention and object layout; they are binary 
              compatible. (This is a simplification, but close enough.)</p>
          </blockquote>
        </blockquote>
        <hr>
      </dl>
      <h3><a name="2_4">2.4 What is the state of AWT support</a>?</h3>
      <dl> 
        <dd> Work is in progress to implement AWT and Java2D. We 
	intend to support both GTK and xlib peers written using CNI. Some
	components are already working atop the 
	<A HREF="http://www.ii.uib.no/~rolfwr/jcnix/">xlib peers</A>.
      </dl>
      <hr>
      <h3><a name="2_5">2.5 How about support for Swing</a>?</h3>
      <dl> 
        <dl> 
          <dt>Considering that AWT support isnt here yet there is no chance of 
            getting Swing running. Once we have AWT support the Swing 1.1.1 may 
            be useable and even redistributable, but JFC will be another issue, 
            as <a href="mailto:moroz@metahood.ru">Oleg Moroz</a> summarises: 
            <blockquote> 
              <p>1) Swing 1.1.1 for JDK 1.1.x with license that allows to redistribute 
                it as part of the value-added applet or application. This needs 
                some research, however I feel that the term "value-added application" 
                might include e.g. gcj-based development system; if it is not 
                by itself, a simple Swing-based application might be added to 
                the distribution). This version depends on AWT 1.1 only (well, 
                1.1.x, x >=7) and it seems that the Sun's version could be used 
                for most purposes people would like to use it. </p>
            </blockquote>
          </dt>
          <blockquote> 
            <p>2) Swing (JFC) that is part of Java2. This is AFAIK not available 
              as separate product and is covered by more restrictive (in this 
              case at least) JDK license; it is also dependent on AWT 1.2 features. 
              We'd want to develop a replacement only when we move to the 1.2 
              codebase and then we'll also need to develop AWT 1.2 replacement 
              w/o regard to Swing.</p>
          </blockquote>
        </dl>
        <dl> 
          <dt><a href="mailto:per@bothner.com">Per Bothner</a> expands:</dt>
          <dd>&nbsp;</dd>
          <dd>One possibility worth considering is developing Swing components 
            in conjunction with AWT. We can implement JTextArea and TextArea at 
            the same time. We could also implement both on top of (say) some Gtk 
            widget; we don't necessarily *have* to go the "peerless" route. Instead, 
            we can base the "plugable look-and-feel" on the "themebility" of (say) 
            Gtk. </dd>
          <dt>&nbsp;</dt>
          <dd>A bigger potential issue is Swing's separation between &quot;model&quot; 
            (e.g. Document) and &quot;view&quot; (e.g. JTextPane). It may be difficult 
            to make use of the functionality of an existing toolkit such as Gtk 
            unless we can use Gtk widgets with separate &quot;model&quot; objects.</dd>
        </dl>
        <dt>&nbsp; </dt>
        <hr>
      </dl>
      <h3><a name="2_6">2.6 </a>What support is there for RMI?</h3>
      <dl> 
        <dd> RMI code exists on the CVS trunk (aka gcc 3.1), but it
	      has not been heavily tested.  This code was donated by
	      Transvirtual Technologies.
	</dd>
      </dl>
      <p></p>
      <dl> 
        <dt>&nbsp; </dt>
        <hr>
      </dl>
      <dl> 
        <dt> 
          <h3><a name="2_7">2.7 Can I use any code from other OpenSource
            projects to supplement libgcj's current features?</a></h3>
        </dt>
	<dd>
	<p> Certainly. However, in many cases, if you wanted to contribute the 
	code back into the official libgcj distribution, we would require that the 
	original author(s) assign copyright to the Free Software Foundation.  
	<p> As of March 6, 2000, libgcj has been relicenced, and copyright has
	been assigned to the <A HREF="http://www.gnu.org/">FSF</A>. This allows 
	us to share and merge much of the libgcj codebase with the 
	<A HREF="http://www.classpath.org">Classpath</A> project. Our eventual goal 
	is for Classpath to be an upstream source provider for libgcj, however it 
	will be some time before this becomes reality: libgcj and Classpath have different 
	implementations of
	many core java classes. In order to merge them, we need to select the 
	best (most efficient, cleanest) implementation of each method/class/package,
	resolve any conflicts created by the merge, and test the final result. 
	Needless to say, this is a lot of work. If you can help out, please
	<A HREF="mailto:java@gcc.gnu.org">let us know</A>!
      </dl>

      <hr>

      <dl> 
        <dt> 
          <h3><a name="2_8">2.8 What features of the Java language are/aren't supported.</a></h3>
        </dt>
        <dd>GCJ supports all Java language constructs as per the 
          <a href="http://java.sun.com/docs/books/jls/">Java language Specification 
          v1.0</a>. Recent GCJ snapshots have added support for most JDK1.1 
	  language features, including inner classes.
      </dl>
      <dl> 
        <p></p>
      </dl>
      <table border="0" cellpadding="4" width="95%">
        <tr bgcolor="#b0d0ff"> 
          <th align="left"> 
            <h2><a name="3_0">Build Issues</a></h2>
          </th>
        </tr>
      </table>

      <dl> 
        <dt> 
          <h3><a name="3_1">3.1 I need something more recent than the last release; how should I build it?</a></h3>
        </dt>
        <p> 
        <dd>Please read <a href="build-snapshot.html">here</a>.
        </dd>
        <p></p>
      </dl>

      <hr>

      <dl> 
        <dt> 
          <h3><a name="3_2">3.2 Linker bug on Solaris</a></h3>
        </dt>
        <p> 
        <dd>There is a known problem with the <a href="http://gcc.gnu.org/ml/gcc-bugs/1999-10/msg00159.html"> 
          native Solaris linker</a> when using gcc/gcj. A good indication you've 
          run into this problem is if you get an error that looks like the following 
          when building libgcj: 
          <pre>
ld: warning: option -o appears more than once, first setting taken
ld: fatal: file libfoo.so: cannot open file: No such file or directory
ld: fatal: File processing errors. No output written to .libs/libfoo.so
collect2: ld returned 1 exit status
	</pre>
          A known workaround for this and other reported link problems on the 
          various releases of Solaris is to build gcc/gcj with the <a href="ftp://sources.redhat.com/pub/binutils/snapshots"> 
          latest GNU binutils</a> instead of the native Solaris <tt>ld</tt>. The 
          most straightforward way to do this is to build and install binutils, 
          and then reference it in the configure for gcc via <tt>--with-ld=/path_to_binutils_install/bin/ld</tt> 
          (<tt>--with-as</tt> may also be similarly specified but is not believed 
          to be required). 
          <p> Please note, gcc/gcj must be built using GNU ld prior to doing a 
            clean build of libgcj! 
        </dd>
        <p></p>
      </dl>

      <hr>

      <dl> 
        <dt> 
          <h3><a name="3_3">3.3 Can I configure/build in the source tree?</a></h3>
        </dt>
        <p> 
        <dd>No.  You cannot configure/build in the source tree.  If you try,
	you'll see something like:
	<pre>
$ ./configure [...]
Configuring for a i686-pc-linux-gnu host.
*** Cannot currently configure in source tree.
	</pre>
	Instead, you must build in another directory.  E.g.:
	<pre>
$ mkdir build
$ cd build
$ ../configure [...]
	</pre>
        </dd>
        <p></p>
      </dl>
      
      <hr>

      <dl> 
        <dt> 
          <h3><a name="3_4">3.4 My libgcj build fails with "invalid use of undefined type struct sigcontext_struct"</a></h3>
        </dt>
        <p> 
	<dd>If you're using Linux, this probibly means you need to upgrade to
	a newwer, glibc (libc6) based Linux distribution. libgcj does not 
	support the older linux libc5.
	<p>It might be possible to get a working libgcj by changing occurances
	of "sigcontext_struct" to "sigcontext", however this has not been tested.
	Even if it works, it is likely that there are other issues with older
	libc versions that would prevent libgcj from working correctly (threads
	bugs, for example).
        </dd>
      </dl>


      <table border="0" cellpadding="4" width="95%">
        <tr bgcolor="#b0d0ff"> 
          <th align="left"> 
            <h2><a name="4_0">Gcj Compile/Link Questions</a></h2>
          </th>
        </tr>
      </table>
      <dl> 
        <dt> 
          <h3><a name="4_1">4.1 Why do I get <tt>undefined reference to `main'</tt> 
            errors?</a></h3>
        </dt>
      </dl>
      <p> 
      <dl> 
        <dd>When using <tt>gcj</tt> to link a Java program, you must use the <tt>--main=</tt> 
          option to indicate the class that has the desired <tt>main</tt> method. 
          This is because every Java class can have a <tt>main</tt> method, thus 
          you have to tell gcj which one to use.</dd>
        <dt>&nbsp;</dt>
        <hr>
      </dl>
      <dl> 
        <dt> 
          <h3><a name="4_2">4.2 Can GCJ only handle source code?</a></h3>
        </dt>
      </dl>
      <p> 
      <dl> 
        <dd>The GCJ compiler will compile both java source and bytecode .class 
          files. For the moment support for compiling bytecodes will support more 
          applications than compiling from source, as the source code compiler 
          has some bugs in its support for inner classes, which are used heavily 
	  in programs written for the JDK 1.1 (AWT in particular). 
          <p>In many cases the native code produced by compiling from source is 
            better optimised than that compiled from .class files. Per Bothner 
            explains:</p>
        </dd>
        <dt> 
          <dl> 
            <dd>The reason is that when you compile to bytecode you lose a lot 
              of information about program structure etc. That information helps 
              in generating better code. We can in theory recover the information 
              we need by analysing the structure of the bytecodes, but it is sometimes 
              difficult - or sometimes it just that no-one has gotten around to 
              it. 
              <p>Specific examples include loop structure (gcc generates better 
                code with explicit loops rather than with the equivalent spaghetti 
                code), array initializers, and the JDK 1.1 `CLASS.class' syntax, 
                all of which are represented using more low-level constructs in 
                bytecode.</p>
            </dd>
          </dl>
        </dt>
        <hr>
        <dt><font color="#FF3300"></font></dt>
        <dt> 
          <h3><a name="4_3">4.3 &quot;gcj -C"</a> Doesnt seem to work like javac/jikes. 
            Whats going on?</h3>
        </dt>
        <blockquote> 
          <p>The behavior of "gcj -C" is not at all like javac or jikes, which 
            will compile (not just scan) all .java's which are out of date with 
            regard to their .class's.</p>
        </blockquote>
      </dl>
      <hr>

      <dl> 
        <dt> 
          <h3><a name="4_4">4.4 Where does GCJ look for files?</a></h3>
        </dt>
        <blockquote> 
          <p>GCJ looks for classes to compile based on the CLASSPATH environment 
            variable. An important limitation presently is that gcj doesn't handle 
            compressed jar files in your classpath. </p>
        </blockquote>
      </dl>
      <hr>

      <dl> 
        <dt> 
          <h3><a name="4_5">4.5 How does gcj resolve whether to compile .class 
            or .java files?</a></h3>
        </dt>
        <blockquote> 
          <p>GCJ seems to favor .class files in the CLASSPATH, if any, otherwise 
            it will use the source (.java), also in the CLASSPATH. It also checks 
            to see if the class is newer than the .java file. If it can't find 
            either it throws an error.</p>
        </blockquote>
      </dl>
      
      <hr>
      
      <dl>
        <dt>
          <h3><a name="4_6">4.6 I'm getting link errors</a></h3>
        </dt>
        <blockquote>
        <p>If you get errors at link time that refer to
          'undefined reference to `java::lang::Object type_info function',
          verify that you have compiled any CNI C++ files with the
          -fno_rtti option.
        </blockquote>
      </dl>

      <hr>

      <dl>
	<dt>
          <h3><a name="4_7">4.7 I'm getting 'undefined symbol: __dso_handle'</a></h3>
	</dt>
	<dd>
	Some versions of the GNU linker have broken support for the '.hidden'
	directive, which results in problems with shared libraries built with
	recent versions of gcc.	
	<p>
	There are three solutions:
	<ul>
	  <li>downgrade to binutils that don't support .hidden at all,
	  <li>upgrade to a recent CVS binutils, or
	  <li>undef the HAVE_GAS_HIDDEN definition in gcc's auto-host.h
	  (and rebuild gcc).
	</ul>
	</dd>
      </dl>
      
      <dl> 
        <dt>&nbsp; </dt>
      </dl>
      <dl> 
        <p></p>
      </dl>
      <table border="0" cellpadding="4" width="95%">
        <tr bgcolor="#B0D0FF"> 
          <th align="left"> 
            <h2><a name="5_0">Runtime Questions</a></h2>
          </th>
        </tr>
      </table>
      <dl> 
        <dt> 
          <h3><a name="5_1">5.1 My program is dumping core! What's going on?</a></h3>
        </dt>
        <p> 
        <dd>
	  It could be any number of things. One common mistake is
          having your <tt>CLASSPATH</tt> environment variable pointing
          at a third party's java.lang and friends. Either unset
          <tt>CLASSPATH</tt>, or make sure it does not refer to core
          libraries other than those found in
          <tt>libgcj.jar</tt>.</dd>

	  <p> An other symptom covered by this fix is a running
          "<tt>Hello World</tt>" type program, with a lot of non printable
	  ASCII garbage before and/or after the output.

	  <p> But note that if this still happens to you, you should
          definitively update to a newer front-end that will reject
          <tt>libgcj.jar</tt>s that weren't <A
          HREF="http://gcc.gnu.org/ml/java/2001-03/msg00383.html">generated</A>
          by gcj.

        <dd></dd>
      </dl>
      <p></p>
      <dl> 
        <dt> 
          <hr>
          <h3><a name="5_2">5.2 When I run the debugger I get a SEGV in the GC! 
            What's going on?</a></h3>
        </dt>
      </dl>
      <p> 
      <dl> 
        <dd>This is "normal"; the Garbage Collector (GC) uses it to determine 
          stack boundaries. It is ordinarily caught and handled by the GC -- you 
          can see this in the debugger by using <tt>cont</tt> to continue to the 
          "real" segv. 
          <p>This shouln't happen anymore, as we dont define MPROTECT_VDB in the 
            GC, at least for Linux/386.</p>
        </dd>
      </dl>
      <p></p>
      <dl> 
        <dt> 
          <hr>
          <h3><a name="5_3">5.3 I have just compiled and benchmarked my Java application 
            and it seems to be running slower than than XXX JIT JVM. Is there 
            anything I can do to make it go faster?</a></h3>
        </dt>
      </dl>
      <p> 
      <dl> 
        <dd>A few things: 
          <ul>
            <li>If your programs allocate many small, short lived objects, the 
              heap could be filling and triggering GC too regularly. Try increasing 
              the initial and maximum heap sizes as per <i>5.5 How do I increase 
              the runtime's initial and maximum heap size?</i></li>
            <li>RE - array accesses. We have sub-optimal runtime checking code, 
              and the compiler is still not so smart about automatically removing 
              array checks. If your code is ready, and it doesn't rely on them, 
              try compiling with --no-bounds-check. </li>
            <li>Try static linking. The interaction with boehm-gc seems to incur 
              extra overhead when shared libraries are used. On one program that 
              makes heavy use of the allocator I achieved over 30% runtime performance 
              gain with static linking. This shouldn't be an issue
              with the current CVS gcj, as it handles GC marking
              differently in most cases.</li>
            <li>If your Java application doesn't need threads, try building libgcj 
              using --enable-threads=none. Portions of the libgcj runtime are 
              still more efficient when single-threaded.</li>
          </ul>
        </dd>
      </dl>
      <p></p>
      <p> 
      <dl> 
      <hr>
        <dt> 
          <h3><a name="5_4">5.4 Can I profile Garbage Collection?</a></h3>
        </dt>
        <dd>It is possible to turn on verbose GC output by supressing the -DSILENT 
          flag during build. One way to do this is to comment out the line with 
          #define SILENT 1 from boehm-gc/configure before configuring libgcj. 
        </dd>
        <dt>&nbsp;</dt>
        <dd>The GC will print collection statistics to stdout. (Rebuilding boehm-gc 
          alone without this flag doesn't seem to work.)</dd>
        <dt>&nbsp;</dt>
        <hr>
        <dt> 
          <h3><a name="5_5">5.5 How do I increase the runtime's initial and maximum 
            heap sizes?</a></h3>
        </dt>
        <dd>Some programs that allocate many small, short-lived objects can cause 
          the default-sized heap to fill quickly and GC often. With the 2.95.1 
          release there is no means to adjust the heap at runtime. Recent snapshots 
          provide the -ms and -mx arguments to gij to specify the initial and 
          maximum heap sizes, respectively.</dd>
      </dl>
      <hr>
      <dl> 
        <dt> 
          <h3><a name="5_6">5.6 How can I profile my application?</a></h3>
        </dt>
        <dd>Support for this is currently lagging. Only single threaded Java code 
          may be used by the profiler (gprof). POSIX threads seem to be incompatible 
          with the gmon stuff.</dd>
        <dt>&nbsp;</dt>
      </dl>
      
    <hr>  
    <dl>
	<dt>
      <h3><a name="5_7">5.7 My program seems to hang and doesn't produce any output</a></h3>
	</dt>
    <dd>
    There seems to be a bug in the current iconv support. You can work around
    it for now by setting <tt>LANG=en_US.UTF-8</tt> at runtime. Or give the
    following option during compile time
    <tt>-Dfile.encoding=UTF-8</tt>.  This problem should no longer
    occur as of November 1, 2000.
    </dd>
    </dl>

      <p> 
      <table width="100%" border="0">
        <tr bgcolor="#B0D0FF" align="left"> 
          <th> 
            <h2><a name="6_0"></a>Programing Issues </h2>
          </th>
        </tr>
      </table>
      <h3><a name="6_1"></a>6.1 Are there any examples of how to use CNI?</h3>
      <blockquote> 
        <p>Glenn Chambers has created a couple 
          of trivial examples <a href="cni-1.txt">here</a> and <a href="cni-2.txt">here</a>. 
        As a comparision, <a href="jni-kaffe.txt">here</a>
        is the same example as a JNI application.
        </p>
        <p>
        Note that you must compile the C++ files used for CNI with the
        -fno-rtti option.
        </p>
        <p>The primary source of documentation for CNI is at <a href="papers/cni/t1.html">http://gcc.gnu.org/java/papers/cni/t1.html</a></p>
      </blockquote>

      <hr>

      <dl> 
        <dt> 
          <h3><a name="6_2">6.2 Is it possible to invoke GCJ compiled Java code from a C++ application?</a></h3>
        </dt>
        <blockquote> 
          <p>At this time, no.  Parts of the libgcj runtime, particularly the
	  threads environment, need to be initialized before Java code can
	  run correctly.  There is currently no way to perform this initialization
	  apart from having it done automatically when your Java main class is
	  started.  The work that needs to be done includes defining the API
	  (invocation interface) through which the Java runtime can be invoked 
	  via CNI, and implementing the mechanism to allow Java thread objects
	  to be attached to an existing native thread. </p>
	  <p>
	  Of course, it is possible to instantiate Java classes
	  and call back into them from C++ code: the only requirement is that
	  your application must have been started from Java "main" method.	  
	  </p>
        </blockquote>
      </dl>


</GCJNAV>

</body>
</html>
