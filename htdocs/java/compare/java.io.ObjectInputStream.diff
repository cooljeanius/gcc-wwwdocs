--- /home/tromey/gnu/Nightly/classpath/classpath/java/io/ObjectInputStream.java	2004-06-08 02:25:02.000000000 -0600
+++ java/io/ObjectInputStream.java	2004-04-21 02:18:08.000000000 -0600
@@ -1303,10 +1303,10 @@
 
 	  int off = field.getOffset();
 
-	  return (long)(((prim_field_data[off++] & 0xFFL) << 56)
-			| ((prim_field_data[off++] & 0xFFL) << 48)
-			| ((prim_field_data[off++] & 0xFFL) << 40)
-			| ((prim_field_data[off++] & 0xFFL) << 32)
+	  return (long)(((prim_field_data[off++] & 0xFF) << 56)
+			| ((prim_field_data[off++] & 0xFF) << 48)
+			| ((prim_field_data[off++] & 0xFF) << 40)
+			| ((prim_field_data[off++] & 0xFF) << 32)
 			| ((prim_field_data[off++] & 0xFF) << 24)
 			| ((prim_field_data[off++] & 0xFF) << 16)
 			| ((prim_field_data[off++] & 0xFF) << 8)
@@ -1340,10 +1340,10 @@
 	  int off = field.getOffset();
 
 	  return Double.longBitsToDouble
-	    ( (long) (((prim_field_data[off++] & 0xFFL) << 56)
-		      | ((prim_field_data[off++] & 0xFFL) << 48)
-		      | ((prim_field_data[off++] & 0xFFL) << 40)
-		      | ((prim_field_data[off++] & 0xFFL) << 32)
+	    ( (long) (((prim_field_data[off++] & 0xFF) << 56)
+		      | ((prim_field_data[off++] & 0xFF) << 48)
+		      | ((prim_field_data[off++] & 0xFF) << 40)
+		      | ((prim_field_data[off++] & 0xFF) << 32)
 		      | ((prim_field_data[off++] & 0xFF) << 24)
 		      | ((prim_field_data[off++] & 0xFF) << 16)
 		      | ((prim_field_data[off++] & 0xFF) << 8)
@@ -1802,7 +1802,11 @@
    * @param sm SecurityManager instance which should be called.
    * @return The current class loader in the calling stack.
    */
-  private static native ClassLoader currentClassLoader (SecurityManager sm);
+  private static ClassLoader currentClassLoader (SecurityManager sm)
+  {
+    // FIXME: This is too simple.
+    return ClassLoader.getSystemClassLoader ();
+  }
 
   private void callReadMethod (Method readObject, Class klass, Object obj) throws IOException
   {
