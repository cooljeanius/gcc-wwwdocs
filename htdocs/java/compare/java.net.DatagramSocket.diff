--- /home/tromey/gnu/Nightly/classpath/classpath/java/net/DatagramSocket.java	2003-09-20 02:19:42.000000000 -0600
+++ java/net/DatagramSocket.java	2003-09-19 02:17:51.000000000 -0600
@@ -153,8 +153,21 @@
     if (s != null)
       s.checkListen(port);
 
-    // Why is there no factory for this?
-    impl = new PlainDatagramSocketImpl();
+    String propVal = System.getProperty("impl.prefix");
+    if (propVal == null || propVal.equals(""))
+      impl = new PlainDatagramSocketImpl();
+    else
+      try
+	{
+          impl = (DatagramSocketImpl) Class.forName
+            ("java.net." + propVal + "DatagramSocketImpl").newInstance();
+	}
+      catch (Exception e)
+	{
+	  System.err.println("Could not instantiate class: java.net." +
+	    propVal + "DatagramSocketImpl");
+	  impl = new PlainDatagramSocketImpl();
+	}
     impl.create();
 
     if (laddr == null)
