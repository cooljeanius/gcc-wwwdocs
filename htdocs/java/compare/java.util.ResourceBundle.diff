--- /home/tromey/gnu/Nightly/classpath/classpath/java/util/ResourceBundle.java	2003-01-10 15:35:17.000000000 -0700
+++ java/util/ResourceBundle.java	2002-12-10 19:20:36.000000000 -0700
@@ -1,5 +1,5 @@
 /* ResourceBundle -- aids in loading resource bundles
-   Copyright (C) 1998, 1999, 2001, 2002, 2003 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2001, 2002 Free Software Foundation, Inc.
 
 This file is part of GNU Classpath.
 
@@ -42,8 +42,6 @@
 import java.lang.ref.SoftReference;
 import java.io.InputStream;
 import java.io.IOException;
-import java.security.AccessController;
-import java.security.PrivilegedAction;
 import gnu.classpath.Configuration;
 
 /**
@@ -105,62 +103,7 @@
    */
   private Locale locale;
 
-  private static Class resourceBundleClass;
-  private static Class securityClass;
-
-  static
-  {
-    try
-      {
-	resourceBundleClass = Class.forName("java.util.ResourceBundle");
-	securityClass = Class.forName("java.util.ResourceBundle$Security");
-      }
-    catch (ClassNotFoundException e)
-      {
-      }
-  }
-      
-  /**
-   * We override SecurityManager in order to access getClassContext().
-   */
-  private static final class Security extends SecurityManager
-  {
-    /**
-     * Avoid accessor method of private constructor.
-     */
-    Security()
-    {
-    }
-
-    /**
-     * Return the ClassLoader of the class which called into this
-     * ResourceBundle, or null if it cannot be determined.
-     */
-    ClassLoader getCallingClassLoader()
-    {
-      Class[] stack = getClassContext();
-      for (int i = 0; i < stack.length; i++)
-	{
-	  if (stack[i] != securityClass && stack[i] != resourceBundleClass)
-	    return stack[i].getClassLoader();
-	}
-
-      return null;
-    }
-  }
-
-  /** A security context for grabbing the correct class loader. */
-  private static final Security security
-    = (Security) AccessController.doPrivileged(new PrivilegedAction()
-      {
-        // This will always work since java.util classes have (all) system
-        // permissions.
-        public Object run()
-        {
-          return new Security();
-        }
-      }
-    );
+  private static native ClassLoader getCallingClassLoader();
 
   /**
    * The resource bundle cache. This is a two-level hash map: The key
@@ -239,9 +182,8 @@
       catch (MissingResourceException ex)
         {
         }
- 
-    throw new MissingResourceException("Key not found", getClass().getName(),
-				       key);
+    throw new MissingResourceException("Key not found",
+                                       getClass().getName(), key);
   }
 
   /**
@@ -281,7 +223,7 @@
   public static final ResourceBundle getBundle(String baseName)
   {
     return getBundle(baseName, Locale.getDefault(),
-                     security.getCallingClassLoader());
+                     getCallingClassLoader());
   }
 
   /**
@@ -299,7 +241,7 @@
   public static final ResourceBundle getBundle(String baseName,
                                                Locale locale)
   {
-    return getBundle(baseName, locale, security.getCallingClassLoader());
+    return getBundle(baseName, locale, getCallingClassLoader());
   }
 
   /**
@@ -528,7 +470,6 @@
     catch (Exception ex)
       {
         // ignore them all
-	foundBundle = null;
       }
     if (foundBundle == null)
       {
