--- /home/tromey/gnu/Nightly/classpath/classpath/java/nio/ByteBuffer.java	2004-04-30 02:23:42.000000000 -0600
+++ java/nio/ByteBuffer.java	2004-02-17 02:18:13.000000000 -0700
@@ -293,27 +293,32 @@
    */
   public int compareTo (Object obj)
   {
-    ByteBuffer other = (ByteBuffer) obj;
+    ByteBuffer a = (ByteBuffer) obj;
 
-    int num = Math.min(remaining(), other.remaining());
-    int pos_this = position();
-    int pos_other = other.position();
-    
-    for (int count = 0; count < num; count++)
+    if (a.remaining () != remaining ())
+      return 1;
+
+    if (! hasArray () ||
+        ! a.hasArray ())
       {
-        byte a = get(pos_this++);
-	byte b = other.get(pos_other++);
-      	 
-	if (a == b)
-	  continue;
-      	   
-	if (a < b)
-	  return -1;
-      	   
-	return 1;
+        return 1;
       }
-      
-    return remaining() - other.remaining();
+
+    int r = remaining ();
+    int i1 = position ();
+    int i2 = a.position ();
+
+    for (int i = 0; i < r; i++)
+      {
+        int t = (int) (get (i1) - a.get (i2));
+
+        if (t != 0)
+          {
+            return (int) t;
+          }
+      }
+
+    return 0;
   }
 
   /**
