--- /home/tromey/gnu/Nightly/classpath/classpath/java/net/JarURLConnection.java	2004-01-07 02:20:41.000000000 -0700
+++ java/net/JarURLConnection.java	2003-12-21 02:18:14.000000000 -0700
@@ -42,7 +42,9 @@
 import java.util.jar.Attributes;
 import java.util.jar.JarEntry;
 import java.util.jar.JarFile;
+import java.util.jar.JarInputStream;
 import java.util.jar.Manifest;
+import java.util.zip.ZipEntry;
 import java.security.cert.Certificate;
 
 /**
@@ -152,9 +154,46 @@
    */
   public JarEntry getJarEntry () throws IOException
   {
-    JarFile jarFile = getJarFile();
+    JarFile jarfile = null;
 
-    return jarFile != null ? jarFile.getJarEntry (entryName) : null;
+    if (entryName == null)
+      return null;
+
+    if (! doInput)
+      throw new ProtocolException("Can't open JarEntry if doInput is false");
+
+    try
+      {
+	jarfile = getJarFile ();
+      }
+    catch (IOException x)
+      {
+	/* ignore */
+      }
+    
+    if (jarfile == null)
+      {
+	JarInputStream zis = new JarInputStream(
+			jarFileURLConnection.getInputStream ());
+
+	// This is hideous, we're doing a linear search for the thing...
+	for (ZipEntry ent = zis.getNextEntry (); 
+	     ent != null; 
+	     ent = zis.getNextEntry ())
+	  {
+	    if (entryName.equals (ent.getName()))
+	      {
+		return new JarEntry (ent);
+	      }
+	  }
+      }
+
+    else
+      {
+	return jarfile.getJarEntry (entryName);
+      }
+
+    return null;
   }
 
   /**
