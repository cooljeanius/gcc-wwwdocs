<html>

<head>
<title>GCC 4.6 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.6 Release Series<br />Changes, New Features, and Fixes</h1>

<h2>Caveats</h2>
  <ul>

    <li>The options <code>-b &lt;<em>machine</em>&gt;</code> and
    <code>-V &lt;<em>version</em>&gt;</code> have been removed because
    they were unreliable. Instead, users should directly run
    <code>&lt;<em>machine</em>&gt;-gcc</code> when cross-compiling, or
    <code>&lt;<em>machine</em>&gt;-gcc-&lt;<em>version</em>&gt;</code>
    to run a different version of <code>gcc</code>. </li>

    <li>Versions of the GNU C library up to and including 2.11.1
    included an <a
    href="http://sourceware.org/bugzilla/show_bug.cgi?id=10401">incorrect
    implementation of the <code>cproj</code> function</a>.  GCC
    optimizes its builtin <code>cproj</code> according to the behavior
    specified and allowed by the ISO C99 standard.  If you want to
    avoid discrepancies between the C library and GCC's builtin
    transformations when using <code>cproj</code> in your code, use
    GLIBC 2.12 or later.  If you are using an older GLIBC and actually
    rely on the incorrect behavior of cproj, then you can disable
    GCC's transformations using <code>-fno-builtin-cproj</code>. </li>

    <li>The C-only intermodule optimization framework (IMA, enabled by
    <code>-combine</code>) has been removed in favor of the new
    generic link-time optimization framework (LTO) introduced
    in <a href="../gcc-4.5/changes.html">GCC 4.5.0</a>.</li>

</ul>

<h2>General Optimizer Improvements</h2>

  <ul>
      <li>A new general optimization level, <code>-Ofast</code> has been
      introduced.  It combines the existing optimization level <code>-O3</code>
      with options that can affect standards compliance but result in
      better optimized code.  For example <code>-Ofast</code> enables
      <code>-ffast-math</code>.</li>
      <li>Interprocedural optimimization improvements
      <ul>
	  <li>The interprocedural framework was re-tuned for link time
	      optimization.</li>
	  <li>Improved auto-detection of <code>const</code> and <code>pure</code>
	      functions.  Newly, <code>noreturn</code> functions are auto-detected.
	      <p>The <a href="http://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#Warning-Options"><code>-Wsuggest-attribute=[const|pure|noreturn]</code></a>
	      flag is available that informs users when adding
	      attributes to headers might improve code generation.</p></li>
	  <li>Inlining heuristics were improved:
	      <ul>
		 <li>Partial inlining is now supported and enabled by default
		     at <code>-O2</code> and greater.  The feature can be
		     controlled via <code>-fpartial-inlining</code>.
		     <p>
		     Partial inlining splits functions with short hot path
		     to return.  This allows more aggressive inlining of the
		     hot path leading to better performance and often to
		     code size reductions (because cold parts of functions
		     are not duplicated).
		     </p>
		 </li>
		 <li>Scalability for large compilation units was improved
		 significantly.</li>
		 <li>Inlining of callbacks is now more aggressive.</li>
		 <li>Virtual methods considered for inlining when caller is
		     inlined and devirtualization is possible then.</li>
	      </ul>
	  </li>
      </ul>
      </li>
      <li>A new switch <code>-fstack-usage</code> has been added.  It makes
      the compiler output stack usage information for the program, on a
      per-function basis, in an auxiliary file.</li>
  </ul>

<h2>Compile time and memory usage improvements</h2>
  <ul>
      <li>Datastructures used by the dataflow framework in GCC were reorganized
	  for better memory usage and more cache locality.  Compile
	  time is improved especially on units with large functions (possibly
	  resulting from a lot of inlining) not fitting in processor cache.
	  The compile time of the GCC C compiler binary with link-time
	  optimization went down by over 10% (benchmarked on x86-64 target).</li>
  </ul>

<h2>New Languages and Language specific improvements</h2>

<h3>Ada</h3>

  <ul>
    <li>Stack checking has been improved on selected architectures (Alpha,
    IA-32/x86-64, RS/6000 and SPARC): it now will detect stack overflows
    in all cases on these architectures.</li>
  </ul>

<h3>C family</h3>

<h3 id="Cxx">C++</h3>

  <ul>
    <li>Improved <a href="cxx0x_status.html">experimental support for the
    upcoming C++0x</a> ISO C++ standard, including support for
    <code>nullptr</code> (thanks to Magnus Fromreide), <code>noexcept</code>,
    unrestricted unions, range-based <code>for</code> loops (thanks to Rodrigo Rivas Costa),
    implicitly deleted functions and implicit move constructors.</li>

    <li>When an extern declaration within a function does not match a
    declaration in the enclosing context, G++ now properly declares the
    name within the namespace of the function rather than the namespace
    which was open just before the function definition
    (<a href="http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43145">c++/43145</a>).</li>

    <li>GCC now warns by default when casting integers to larger
    pointer types.  These warnings can be disabled with the option
    <code>-Wno-int-to-pointer-cast</code>, which is now also available
    in C++.</li>

    <li>G++ no longer optimizes using the assumption that a value of
    enumeration type will fall within the range specified by the standard,
    since that assumption is easily violated with a conversion from integer
    type (<a href="http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43680">c++/43680</a>).
    The old behavior can be restored with <code>-fstrict-enums</code>.</li>

    <li>The new <code>-fnothrow-opt</code> flag changes the semantics of
    a <code>throw()</code> exception specification to match the proposed
    semantics of the <code>noexcept</code> specification: just call
    <code>terminate</code> if an exception tries to propagate out of a
    function with such an exception specification.  This dramatically
    reduces or eliminates the code size overhead from adding the exception
    specification.</li>

    <li>The new <code>-Wnoexcept</code> flag will suggest adding
    a <code>noexcept</code> qualifier to a function that the compiler can
    tell doesn't throw if it would change the value of
    a <code>noexcept</code> expression.</li>

    <li>The <code>-Wshadow</code> option now warns if a local variable or
    type declaration shadows another type in C++. Note that the compiler will
    not warn if a local variable shadows a struct/class/enum, but will warn
    if it shadows an explicit typedef. </li>
  </ul>

  <h4>Runtime Library (libstdc++)</h4>

<h3 id="Fortran">Fortran</h3>
  <ul>
    <li>Much improved compile time for large array constructors.</li>
    <li>Improved diagnostics, especially with
      <code>-fwhole-file</code>.</li>
    <li>The <code>-fwhole-file</code> flag is now enabled by default. This
    improves code generation and diagnostics. It can be
    disabled using the deprecated <code>-fno-whole-file</code> flag.</li>
    <li>Support the generation of Makefile dependencies via the <a
    href="http://gcc.gnu.org/onlinedocs/gcc/Preprocessor-Options.html">
    <code>-M</code>...</a> flags of GCC; you may need to specify the
    <code>-cpp</code> option in addition. The dependencies take
    modules, Fortran's <code>include</code>, and CPP's <code>#include</code>
    into account. Note: Using <code>-M</code> for the module path is no
    longer supported, use <code>-J</code> instead.</li>
    <li>The flag <code>-Wconversion</code> has been modified to issue only
    warnings if the conversion leads to information loss, which drastically
    reduces the number of warnings; <code>-Wconversion</code> is thus now
    enabled with <code>-Wall</code>. The flag <code>-Wconversion-extra</code>
    has been added and warns also about other conversion;
    <code>-Wconversion-extra</code> typically shows a huge number warnings,
    most of which can be ignored.</li>
    <li>A new command-line option <code>-Wunused-dummy-argument</code> warns
	about unused dummy arguments and is included in <code>-Wall</code>.
	Before <code>-Wunused-variable</code> also warned about unused dummy
	arguments.</li>
    <li>Fortran 2003 support has been extended:
      <ul>
	<li>Improved support for polymorphism between libraries and
	programs and for complicated inheritance patterns (cf. <a
	href="http://gcc.gnu.org/wiki/OOP">object-oriented programming</a>).
	</li>
	<li>Experimental support of the <code>ASSOCIATE</code> construct.</li>
	<li>In pointer assignments it is now possible to specify the lower
	bounds of the pointer and, for a rank-1 or a simply contiguous
	data-target, to remap the bounds.</li>
      </ul>
    </li>
    <li>Fortran 2008 support has been extended:
      <ul>
	<li>Experimental <a href="http://gcc.gnu.org/wiki/Coarray">
	coarray support</a> (for one image only, i.e. <code>num_images() ==
	1</code>); use the <a
	href="http://gcc.gnu.org/onlinedocs/gfortran/Code-Gen-Options.html#index-g_t_0040code_007bfcoarray_007d-233">
	<code>-fcoarray=single</code></a> flag to enable it.</li>
	<li>The <code>STOP</code> and the new <code>ERROR STOP</code>
	statements now support all constant expressions.</li>
	<li>Support for the <code>CONTIGUOUS</code> attribute.</li>
	<li>Support for <code>ALLOCATE</code> with <code>MOLD</code>.</li>
	<li>Support for the <code>STORAGE_SIZE</code> intrinsic inquiry
	function.</li>
	<li>Support of the <code>NORM2</code> and <code>PARITY</code>
	intrinsic functions.</li>
	<li>The following bit intrinsics were added: <code>POPCNT</code>
	and <code>POPPAR</code> for counting the number of one bits and
	returning the parity; <code>BGE</code>, <code>BGT</code>,
	<code>BLE</code>, and <code>BLT</code> for bitwise comparisons;
	<code>DSHIFTL</code> and <code>DSHIFTR</code> for combined left
	and right shifts, <code>MASKL</code> and <code>MASKR</code> for
	simple left and right justified masks, <code>MERGE_BITS</code>
	for a bitwise merge using a mask, <code>SHIFTA</code>,
	<code>SHIFTL</code> and <code>SHIFTR</code> for shift operations,
	and the transformational bit intrinsics <code>IALL</code>,
	<code>IANY</code> and <code>IPARITY</code>.</li>
	<li>Support of the <code>EXECUTE_COMMAND_LINE</code> intrinsic
	subroutine.</li>
	<li>Support for the <code>IMPURE</code> attribute for procedures,
	which allows for <code>ELEMENTAL</code> procedures without the
	restrictions of <code>PURE</code>.</li>
	<li>Null pointers (including <code>NULL()</code>) and not
	allocated variables can be used as actual argument to optional
	non-pointer, non-allocatable dummy arguments, denoting an absent
	argument.</li>
	<li>Non-pointer variables with <code>TARGET</code> attribute can
	be used as actual argument to <code>POINTER</code> dummies with
	<code>INTENT(IN)</code></li>
	<li>Pointers including procedure pointers and those in a derived
	type (pointer components) can now be initialized by a target
	instead of only by <code>NULL</code>.</li>
	<li>The <code>EXIT</code> statement (with construct-name) can be
	now be used to leave not only the <code>DO</code> but also the
	<code>ASSOCIATE</code>, <code>BLOCK</code>, <code>IF</code>,
	<code>SELECT CASE</code> and <code>SELECT TYPE</code> constructs.</li>
	<li>Internal procedures can now be used as actual argument.</li>
	<li>The named constants <code>INTEGER_KINDS</code>,
	<code>LOGICAL_KINDS</code>, <code>REAL_KINDS</code> and
	<code>CHARACTER_KINDS</code> of the intrinsic module
	<code>ISO_FORTRAN_ENV</code> have been added; those arrays contain
	the supported kind values for the respective types.</li>
	<li>The module procedures <code>C_SIZEOF</code> of the intrinsic
	module <code>ISO_C_BINDINGS</code> and <code>COMPILER_VERSION</code>
	and <code>COMPILER_OPTIONS</code> of <code>ISO_FORTRAN_ENV</code>
	have been implemented.</li> 
	<li>Minor changes: obsolesce diagnostics for <code>ENTRY</code>
	was added for <code>-std=f2008</code>;
	a line may start with a semicolon;
	for internal and module procedures <code>END</code> can be used
	instead of <code>END SUBROUTINE</code> and <code>END
	FUNCTION</code>; <code>SELECTED_REAL_KIND</code> now also takes a
	<code>RADIX</code> argument; intrinsic types are supported for
	<code>TYPE(<i>intrinsic-type-spec</i>)</code>; multiple type-bound
	procedures can be declared in a single <code>PROCEDURE</code>
	statement; implied-shape arrays are supported for named constants
	(<code>PARAMETER</code>). The transformational, three argument
	versions of <code>BESSEL_JN</code> and <code>BESSEL_YN</code>
	were added &ndash; the elemental, two-argument version had been
	added in GCC 4.4; note that the transformational functions use
	a recurrence algorithm.</li>
      </ul>
    </li>
  </ul>

<h3>Java (GCJ)</h3>

<h2 id="targets">New Targets and Target Specific Improvements</h2>

<h3>IA-32/x86-64</h3>
  <ul>
	<li>Support for emitting profiler counter calls before function
	prologues.  This is enabled via a new command-line option
	<code>-mfentry</code>.</li>
    <li>The default setting (when not optimizing for size) for 32-bit
      Linux and Darwin x86 targets has been changed to
      <code>-fomit-frame-pointer</code>.  The default can be reverted
      to <code>-fno-omit-frame-pointer</code> by configuring GCC with
      the <code>--enable-frame-pointer</code> configure option.</li>
  </ul>

<h3 id="microblaze">MicroBlaze</h3>

<p>Support has been added for the Xilinx MicroBlaze softcore Processor 
(microblaze-elf) embedded target.  This configurable processor is 
supported on several Xilinx Spartan and Virtex FPGAs. </p>

<h3>MIPS</h3>

<h3 id="picochip">picochip</h3>

<h3>PowerPC64</h3>
  <ul>
	<li>PowerPC64 Linux support for applications requiring a large
	TOC section has been improved.  A new command-line option,
	<code>-mcmodel=[small,medium,large]</code>, controls this
	feature.</li>
  </ul>

<h2 id="os">Operating Systems</h2>

<h3 id="Linux">Linux</h3>
  <ul>
    <li>GCC now supports Bionic C library and provides convenient way of
      building native libraries and applications for Android platform.
      Refer to documentation of <code>-mandroid</code>
      and <code>-mbionic</code> options for details on building native code
      for Android platform.
      At the moment, Android support is enabled only for ARM Linux target.</li>
  </ul>

<h2>Documentation improvements</h2>

<h2>Other significant improvements</h2>

</body>
</html>
