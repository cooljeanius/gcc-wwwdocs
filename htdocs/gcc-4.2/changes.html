<html>

<head>
<title>GCC 4.2 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 4.2 Release Series<br />Changes, New Features, and Fixes</h1>

<h2>Caveats</h2>

<ul>
  <li>GCC no longer accepts the <code>-fshared-data</code> option.
      This option has had no effect in any GCC 4 release; the targets
      to which the option used to apply had been removed before GCC 4.0.</li>
</ul>

<h2>General Optimizer Improvements</h2>

<h2>New Languages and Language specific improvements</h2>

<h3>C family</h3>

  <ul>
    <li>The pragma <code>redefine_extname</code> will now 
        macro expand its tokens for compatibility with 
        SunPRO.</li>
  </ul>

<h3>C++</h3>

  <ul>
    <li>
     The (undocumented) extension which permitted templates with
     default arguments to be bound to template template parameters with
     fewer parameters has been removed.  For example:

      <pre>
	template &lt;template &lt;typename&gt; class C&gt;
	void f(C&lt;double&gt;) {}

	template &lt;typename T, typename U = int&gt;
	struct S {};

	template void f(S&lt;double&gt;);
      </pre>      

     is no longer accepted by G++.  The reason this code is not
     accepted is that <code>S</code> is a template with two parameters;
     therefore, it cannot be bound to <code>C</code> which has only
     one parameter.
    </li>

    <li>
     The <code>&lt?</code>, <code>&gt?</code>, <code>&lt?=</code>,
     and <code>&gt?=</code> operators,
     deprecated in previous GCC releases, have been removed.
    </li>

    <li>
     The command line option <code>-fconst-strings</code>, deprecated in
     previous GCC releases, has been removed.
    </li>

    <li>
     The configure variable <code>enable-__cxa_atexit</code> is now enabled by
     default for more targets.  Enabling this variable is necessary in order for
     static destructors to be executed in the correct order, but it depends upon
     the presence of a non-standard C library in the target library in order to
     work.  The variable is now enabled for more targets which are known to have
     suitable C libraries.
    </li>
  </ul> 

<h3>Java (GCJ)</h3>

  <ul>
    <li>
     A new command line option <code>-static-libgcj</code> has been
     added for targets that use a linker compatible with GNU Binutils.
     As its name implies, this causes libgcj to be linked statically.
     In some cases this causes the resulting executable to start
     faster and use less memory than if the shared version of libgcj
     were used.  However caution should be used as it can also cause
     essential parts of the library to be omitted.  Some of these issues are
     discussed in:
      <a href="http://gcc.gnu.org/wiki/Statically%20linking%20libgcj">
	   http://gcc.gnu.org/wiki/Statically%20linking%20libgcj
      </a>
    </li>

    <li><code>fastjar</code> is no longer bundled with GCC.  To build
        libgcj, you will need either InfoZIP (both <code>zip</code>
        and <code>unzip</code>) or an external <code>jar</code> program.
        In the former case, the GCC build will install a <code>jar</code>
        shell script that is based on InfoZIP and provides the same
	functionality as <code>fastjar</code>.</li>
  </ul>

<h2>New Targets and Target Specific Improvements</h2>

<h3>SPARC</h3>
  <ul>
    <li>The default CPU setting has been changed from V7 to V9 in 32-bit
	mode on Solaris 7 and above.  This is already the case in 64-bit
	mode.  It can be overridden by specifying <code>--with-cpu</code>
	at configure time.</li>
  </ul>

<h3>M32C</h3>
  <ul>
    <li>Various bugfixes have made some functions (notably, functions
        returning structures) incompatible with previous releases.
        Recompiling all libraries is recommended.  Note that code
        quality has considerably improved since 4.1, making a
        recompile even more beneficial.</li>
  </ul>

<h3>MIPS</h3>
  <ul>
    <li>Added support for the Broadcom SB-1A core.</li>
  </ul>

<h2><a name="obsolete_systems">Obsolete Systems</a></h2>

<h2>Documentation improvements</h2>

<h3>PDF Documentation</h3>
  <ul>
    <li><p>A <code>make pdf</code> target has been added to the 
        top-level makefile, enabling automated production of PDF
        documentation files.  (Front-ends external to GCC should modify
        their <code>Make-lang.in</code> file to add a <code>lang.pdf:</code>
        target.)</p></li>
  </ul>

<h2>Other significant improvements</h2>

<h3>Build system improvements</h3>
  <ul>
    <li><p>All the components of the compiler are now bootstrapped by
        default.  This improves the resilience to bugs in the system
        compiler or binary compatibility problems, as well as providing
        better testing of GCC 4.2 itself.  In addition, if you build
	the compiler from a combined tree, the assembler, linker, etc.
	will also be bootstrapped (i.e. built with themselves).</p>

        <p>You can disable this behavior, and go back to
	the pre-GCC 4.2 set up, by configuring GCC with
	<code>--disable-bootstrap</code>.</p></li>

    <li><p>The rules that <code>configure</code> follows to find target tools
        resemble more closely the locations that the built compiler
        will search.  In addition, you can use the new configure option
        <code>--with-target-tools</code> to specify where to find the
        target tools used during the build, without affecting what the
        built compiler will use.</p>

        <p>This can be especially useful when building packages of
        GCC.  For example, you may want to build GCC with
        GNU <code>as</code> or <code>ld</code>, even if the resulting compiler
        to work with the native assembler and linker.  To do so, you
        can use <code>--with-target-tools</code> to point to the native
        tools.</p></li>
  </ul>

<h3>Incompatible changes to the build system</h3>
  <ul>
    <li>Front-ends external to GCC should modify their
	<code>Make-lang.in</code> file to replace double-colon rules (e.g.
	<code>dvi::</code>) with normal rules (like <code>lang.dvi:</code>).
	Front-end makefile hooks do not use double-colon rules anymore.</li>

    <li>Up to GCC 4.1, a popular way to specify the target tools used
        during the build was to create directories named <code>gas</code>,
	<code>binutils</code>, etc. in the build tree, and create
	links to the tools from there.	This does not work anymore
	when the compiler is bootstrapped.  The new configure option
	<code>--with-target-tools</code> provides a better way to achieve
	the same effect, and works for all native and cross settings.</li>
  </ul>
</body>
</html>
