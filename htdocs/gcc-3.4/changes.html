<html>

<head>
<title>GCC 3.4 Release Series &mdash; Changes, New Features, and Fixes</title>
</head>

<!-- GCC maintainers, please do not hesitate to update/contribute entries
     concerning those part of GCC you maintain!  2002-03-23, Gerald.
-->

<body>
<h1>GCC 3.4 Release Series<br />Changes, New Features, and Fixes</h1>

<h2>Caveats</h2>

  <ul>
    <li>GNU Make is now required to build GCC.</li>
    <li>With <code>-nostdinc</code> the preprocessor used to ignore
        both standard include paths <strong>and</strong> include paths
        contained in environment variables.  It was neither documented
        nor intended that environment variable paths be ignored, so
        this has been corrected.</li>
    <li>GCC no longer accepts the options <code>-fvolatile</code>,
	<code>-fvolatile-global</code> and <code>-fvolatile-static</code>.
	It is unlikely that they worked correctly in any 3.x release.</li>
    <li>GCC no longer ships <code>&lt;varargs.h&gt;</code>.  Use
        <code>&lt;stdarg.h&gt;</code> instead.</li>
    <li>Support for all the systems <a
        href="../gcc-3.3/changes.html#obsolete_systems">obsoleted in
        GCC 3.3</a> has been removed from GCC 3.4.  See below for a
        <a href="#obsolete_systems">list of systems which are obsoleted
        in this release</a>.</li>
    <li>GCC now requires an ISO C90 (ANSI C89) C compiler to build.
        K&amp;R C compilers will not work.</li>
    <li>On some MIPS targets, the code generated by this release
	will not be binary compatible with previous releases.
	See <a href="#mips_abi">below</a> for details.</li>
    <li>The configure option <code>--enable-threads=pthreads</code> has
        been removed; use <code>--enable-threads=posix</code> instead,
        which should have the same effect.</li>
  </ul>

<h2>General Optimizer Improvements</h2>

  <ul>
    <li>Usability of the profile feedback and coverage testing has been improved.
    <ul>
      <li>Performance of profiled programs has been improved by faster profile
          merging code.</li>
      <li>Better use of the profile feedback for optimization (loop unrolling
          and loop peeling).</li>
      <li>File locking support allowing <code>fork()</code> calls and parallel
          runs of profiled programs.</li>
      <li>Coverage file format has been redesigned.</li>
      <li><code>gcov</code> coverage tool has been improved.</li>
      <li><code>make profiledbootstrap</code> available to build a faster
          compiler.</li>
    </ul>
    </li>
    <li>Inlining heuristics for C, Objective-C, C++ and Java have been
        improved significantly.  Call graph based out-of-order inlining
        is now enabled by default at <code>-O2</code>.</li>
  </ul>

  
<h2>New Languages and Language specific improvements</h2>

<h3>Ada</h3>
  <ul>
    <li>The Ada front end has been updated to include numerous
        bug fixes and enhancements.  These include:
    <ul>
       <li>Improved project file support </li>
       <li>Additional set of warnings about potential wrong code </li>
       <li>Improved error messages </li>
       <li>Improved code generation </li>
       <li>Improved cross reference information </li>
       <li>Improved inlining </li>
       <li>Better run-time check elimination </li>
       <li>Better error recovery </li>
       <li>More efficient implementation of unbounded strings </li>
       <li>Added features in GNAT.Sockets, GNAT.OS_Lib,
           GNAT.Debug_Pools, ... </li>
       <li>New GNAT.xxxx packages (e.g. GNAT.Strings,
           GNAT.Exception_Action) </li>
       <li>New pragmas </li>
     </ul>
     </li>
  </ul>

<h3>C/Objective-C/C++</h3>

  <ul>
    <li>Precompiled headers are now supported.  Precompiled headers
        can dramatically speed up compilation of some projects.  There
        are some restrictions; read the manual for the details.</li>
    <li>File handling in the preprocessor has been rewritten.  GCC no
        longer gets confused by symlinks and hardlinks, and now has
	a correct implementation of <code>#import</code> and
        <code>#pragma once</code>.
	These two directives have therefore been un-deprecated.</li>
    <li>The cast-as-lvalue extension has been removed for C++ and
        deprecated for C and Objective-C.  In particular,
        code like this:
        <pre>
        int i;
        (char) i = 5;
        </pre>
        <p>or this:</p>
        <pre>
        char *p;
        ((int *) p)++;
        </pre>
        <p>is no longer accepted for C++ and will not be accepted for
        C and Objective-C in a future version.</p></li>
    <li>The conditional-expression-as-lvalue extension has been
        deprecated for C and Objective-C.  In particular, code like
        this:
        <pre>
        int a, b, c;
        (a ? b : c) = 2;
        </pre>
        <p>will not be accepted for C and Objective-C in a future
        version.</p></li>
    <li>The compound-expression-as-lvalue extension has been
        deprecated for C and Objective-C.  In particular, code like
        this:
        <pre>
        int a, b;
        (a, b) = 2;
        </pre>
        <p>will not be accepted for C and Objective-C in a future
        version.</p></li>

  </ul>

<h3>C++</h3>

  <ul>
    <li>A hand-written recursive-descent C++ parser has replaced the
        YACC-derived C++ parser from previous GCC releases.  The new
        parser contains much improved infrastructure needed for better
        parsing of C++ source codes, handling of extensions, and clean
        separation (where possible) between proper semantics analysis
        and parsing.  The new parser fixes many bugs that were found
        in the old parser.</li>

    <li>You must now use the <code>typename</code> and
	<code>template</code> keywords to disambiguate dependent names,
	as required by the C++ standard.</li>

    <li>In a template definition, unqualified names will no longer
        find members of a dependent base. For example,
	<pre>
        template &lt;typename T&gt;struct B {
	  int m;
	  int n;
	  int f ();
	  int g ();
	};
	int n;
	int g ();
	template &lt;typename T&gt; struct C : B&lt;T&gt; {
	  void g ()
	  {
	    m = 0; // error
	    f ();  // error
	    n = 0; // ::n is modified
	    g ();  // ::g is called
	  }
	};</pre>
        <p>You must make the names dependent by prefixing them with
	<code>this-&gt;</code>. Here is the corrected definition of
	<code>C&lt;T&gt;::g</code>,</p>
	<pre>
	template &lt;typename T&gt; void C&lt;T&gt;::g ()
	{
	  this-&gt;m = 0;
	  this-&gt;f ();
	  this-&gt;n = 0
	  this-&gt;g ();
	}</pre></li>

    <li>The "named return value" and "implicit typename"
	extensions have been removed.</li>
	    
    <li>Default arguments in function types have been deprecated and
        will be removed.</li>

    <li>Covariant returns are implemented for all but varadic
        functions that require an adjustment.</li>
		
    <li>When -pedantic is used, G++ now issues errors about spurious
	semicolons. For example,
        <pre>
        namespace N {}; // Invalid semicolon.
        void f() {}; // Invalid semicolon.</pre></li>
		
    <li>G++ no longer accepts attributes for a declarator after the
        initializer associated with that declarator.  For example,
        <pre>
        X x(1) __attribute__((...));</pre>
        is no longer accepted.  Instead, use:
        <pre>
        X x __attribute__((...)) (1);</pre></li>

    <li>Inside the scope of a template class, the name of the class
        itself can be treated as either a class or a template.  So
        GCC used to accept the class name as argument of type template,
        and template template parameter.  However this is not C++ standard
        compliant.  Now the name is not treated as a valid template template
        argument unless you qualify the name by its scope.  For example,
        the code below no longer compiles.
        <pre>
        template &lt;template &lt;class&gt; class TT&gt; class X {};
        template &lt;class T&gt; class Y {
          X&lt;Y&gt; x; // Invalid, Y is always a type template parameter.
        };</pre>
        <p>The valid code for the above example is</p>
        <pre>
          X&lt; ::Y&gt; x; // Valid.</pre>
        <p>(Notice the space between <code>&lt;</code> and <code>:</code> to
        prevent GCC to interpret this as a digraph for
	<code>[</code>.)</p></li>

    <li>Friend declarations that refer to template specializations are
	rejected if the template has not already been declared. For example,
	<pre>
	template &lt;typename T&gt;
	class C {
	  friend void f&lt;&gt; (C&amp;);
	};</pre>
	<p>is rejected. You must first declare <code>f</code> as a
	template,</p>
	<pre>
	template &lt;typename T&gt;
	void f(T);</pre></li>

    <li>In case of friend declarations, every name used in the friend
        declaration must be accessible at the point of that declaration.
        Previous versions of G++ used to be less strict about this and
        allowed friend declarations for <code>private</code> class members,
        for example.  See the ISO C++ Standard Committee's <a
        href="http://anubis.dkuug.dk/jtc1/sc22/wg21/docs/cwg_closed.html#209">defect
        report #209.</a> for details.</li>
 
    <li>You must use <code>template &lt;&gt;</code> to introduce template
	specializations, as required by the standard.  For example,
	<pre>
	template &lt;typename T&gt;
	struct S;
    
	struct S&lt;int&gt; { };</pre>
	<p>is rejected. You must write,</p>
	<pre>
	template &lt;&gt; struct S&lt;int&gt; {};</pre></li>
			  
    <li>G++ used to accept code like this,
	<pre>
	struct S {
	  int h();
	  void f(int i = g());
	  int g(int i = h());
	};</pre>
	<p>This behavior is not mandated by the standard. Now G++ issues
        an error about this code.  To avoid the error, you must move
        the declaration of <code>g</code> before the declaration of
	<code>f</code>.  The default arguments for <code>g</code> must
	be visible at the point where it is called.</p></li>

    <li>The C++ ABI Section 3.3.3 specifications for the array
        construction routines <code>__cxa_vec_new2</code> and
        <code>__cxa_vec_new3</code> were changed to return
        <code>NULL</code> when the allocator argument returns
        <code>NULL</code>.  These changes are incorporated into the
        libstdc++ runtime library.</li>

  </ul>

<h3>Objective-C</h3>

  <ul>
    <li>The Objective-C front end has been updated to include the numerous
        bug fixes and enhancements previously available only in Apple's
        version of GCC.  These include:
    <ul>
       <li>Structured exception (<code>@try</code>... <code>@catch</code>...
           <code>@finally</code>, <code>@throw</code>) and synchronization
           (<code>@synchronized</code>) support.  These are accessible via
           the <code>-fobjc-exceptions</code> switch; as of this writing,
           they may only be used in conjunction with <code>-fnext-runtime
           </code> on Mac OS X 10.3 and later. See <a href=
           "http://gcc.gnu.org/onlinedocs/gcc/Objective-C-Dialect-Options.html"
           >Options Controlling Objective-C Dialect</a> for more
           information.</li>
       <li>An overhaul of <code>@encode</code> logic.  The C99 <code>_Bool
           </code> and C++ <code>bool</code> type may now be encoded as 
           '<code>B</code>'. In addition, the back-end/codegen dependencies
           have been removed.</li>
       <li>An overhaul of message dispatch construction, ensuring that the
           various receiver types (and casts thereof) are handled properly,
           and that correct diagnostics are issued.</li>
       <li>Support for "Zero-Link" (<code>-fzero-link</code>) and
           "Fix-and-Continue" (<code>-freplace-objc-classes</code>) debugging
           modes, currently available on Mac OS X 10.3 and later. See <a href=
           "http://gcc.gnu.org/onlinedocs/gcc/Objective-C-Dialect-Options.html"
           >Options Controlling Objective-C Dialect</a> for more
           information.</li>
       <li>Access to optimized runtime entry points (<code>-fno-nil-receivers
           </code>) on the assumption that message receivers are never <code>
           nil</code>.  This is currently available on Mac OS X 10.3 and
           later. See <a href=
           "http://gcc.gnu.org/onlinedocs/gcc/Objective-C-Dialect-Options.html"
           >Options Controlling Objective-C Dialect</a> for more
           information.</li>
    </ul></li>
  </ul>

<h3>Java</h3>

  <ul>
    <li></li>
  </ul>

<h3>Fortran</h3>

  <ul>
    <li>Fortran improvements are listed in              
    <a href="http://gcc.gnu.org/onlinedocs/g77/News.html">
    the Fortran documentation</a>.</li>
  </ul>

<h2>New Targets and Target Specific Improvements</h2>

  <ul>
    <li>Bernardo Innocenti (Develer&nbsp;S.r.l.) has contributed
    the <code>m68k-uclinux</code> target, based on former work done
    by Paul Dale (SnapGear&nbsp;Inc.).  Code generation for the
    <code>ColdFire</code> processors family has been enhanced and extended
    to support the MCF&nbsp;53xx and MCF&nbsp;54xx cores, integrating
    former work done by Peter Barada (Motorola).</li>

    <li>Support for the Mitsubishi V850E1 processor has been added.
    This is a variant of the V850E processor with some additional
    debugging instructions.</li>
    
    <li>Nicolas Pitre has contributed his hand-coded floating-point support
    code for ARM.  It is both significantly smaller and faster than the 
    existing C-based implementation, even when building applications for 
    Thumb.  The <code>arm-elf</code> configuration has been converted to use
    the new code.</li>

    <li>Support for the Intel's iWMMXt architecture, a second
    generation XScale processor, has been addded to the ARM port.
    Enabled at run time with the <code>-mcpu=iwmmxt</code> command
    line switch.</li>
    
    <li>A new ARM target has been added: <code>arm-wince-pe</code>.  This is
    similar to the <code>arm-pe</code> target, but it defaults to using the
    APCS32 ABI.</li>

    <li>The existing ARM pipeline description has been converted to
    the use the <a
    href="http://gcc.gnu.org/onlinedocs/gccint/Processor-pipeline-description.html">DFA
    processor pipeline model</a>. There is not much change in code
    performance, but the description is now <a
    href="http://gcc.gnu.org/onlinedocs/gccint/Comparison-of-the-two-descriptions.html">easier
    to understand</a>.</li>
    
    <li>The x86 back end has had some noticeable work done to it.
    <ul>
      <li>Tuning for K8 core is available via <code>-march=k8</code> and <code>-mcpu=k8</code></li>
      <li>Scalar SSE code generation carefully avoids reformatting penalties,
          hidden dependencies and minimizes the number of uops generated on
          both Intel and AMD CPUs.</li>
      <li>Conditional jump elimination is now more aggressive on modern CPUs.</li>
      <li>The Athlon and K8 ports have been converted to use the DFA
          processor pipeline description.</li>
      <li>Optimization of indirect tail calls is now possible in a similar
        fashion as direct sibcall optimization.</li>
      <li>Further small performance improvements.</li>
    </ul></li>
    <li>Support for the SH2E processor has been added to the SH port.
    Enabled at run time with the <code>-m2e</code> command line
    switch, or at configure time by specifying sh2e as the machine
    part of the target triple.</li>
    
    <li>Support for the Cirrus EP9312 Maverick floating point
    co-processor added to the ARM port.  Enabled at run time with the
    <code>-mcpu=ep9312</code> command line switch.  Note however that
    the multilibs to support this chip are currently disabled in
    <code>gcc/config/arm/t-arm-elf</code>, so if you want to enable their
    production you will have to uncomment the entries in that
    file.</li>
    
    <li>Support for <code>long long</code> has been added to the
    H8/300 port.</li>

    <li>Support for <code>saveall</code> attribute has been added to
    the H8/300 port.</li>

    <li>Support for the RM7000 and RM9000 processors has been added to the
    MIPS port.  It is activated by the <code>-march</code> compiler option
    and should work with any MIPS I (<code>mips-*</code>) or MIPS III
    (<code>mips64-*</code>) configuration.</li>

    <li><a name="mips_abi">n32 and n64 MIPS targets now pass all
    structures by value.</a>  While this change brings GCC closer
    to ABI compliance, it will unfortunately break binary compatibility
    with earlier releases.  A structure used to be passed by reference if:
    <ul>
      <li>the target was big-endian;</li>
      <li>the structure was bigger than 8 bytes;</li>
      <li>the structure's size was not a multiple of 8 bytes; and</li>
      <li>the first word of the structure would have been passed in
	  a register.</li>
    </ul>
    Note that only big-endian n32 &amp; n64 targets (such as IRIX 6) are
    affected.</li>

    <li>More processor configuration options for Xtensa processors are
    supported:
    <ul>
      <li>the <code>ABS</code> instruction is now optional;</li>
      <li>the <code>ADDX*</code> and <code>SUBX*</code> instructions are
      now optional;</li>
      <li>an experimental <code>CONST16</code> instruction can be used to
      synthesize constants instead of loading them from constant pools.</li>
    </ul>
    These and other Xtensa processor configuration options can no longer
    be enabled or disabled by command-line options; the processor
    configuration must be specified by the <code>xtensa-config.h</code>
    header file when building GCC.  Additionally, the
    <code>-mno-serialize-volatile</code> option is no longer supported.</li>
  </ul>

<h2><a name="obsolete_systems">Obsolete Systems</a></h2>

  <p>Support for a number of older systems has been declared obsolete in
  GCC 3.4.  Unless there is activity to revive them, the next release of
  GCC will have their sources permanently <strong>removed</strong>.</p>

  <p>All configurations of the following processor architectures have
  been declared obsolete:</p>

  <ul>
    <li></li>
  </ul>

  <p>Also, some individual systems have been obsoleted:</p>

  <ul>
    <li>
      <ul>
	<li>target <code>target-triple</code></li>
      </ul></li>
  </ul>


<h2>Documentation improvements</h2>


<h2>Other significant improvements</h2>

  <ul>
    <li>The build system has undergone several significant cleanups.
        Subdirectories will only be configured if they are being built, 
        and all subdirectory configures are run from the <code>make</code>
        command.  The top level has been autoconfiscated.</li>
    <li>The <code>-W</code> warning option has been renamed to
        <code>-Wextra</code>, which is more easily understood.  The older
        spelling will be retained for backwards compatibility.</li>
    <li>Substantial improvements in compile time have been made, particularly
        for non-optimizing compilations.</li>
  </ul>

</body>
</html>
